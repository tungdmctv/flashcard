import{f as fe,r as o,g as S,B as ge,h as we,c as m,a as t,j as J,l as y,b as p,d as M,F as Q,k as X,p as U,t as c,w as _e,C as Y,m as D,D as xe,q as Z,v as E,n as he,e as ye,o as r,i as ke}from"./BOeNQzT5.js";import{P as Ce}from"./BYoDscgR.js";import{p as Se}from"./C9ZjJIze.js";import{u as Me}from"./BOpmqxdM.js";const Ie={class:"text-lg"},Ae={class:"flex justify-end items-center mb-6"},Te={class:"flex flex-wrap justify-end gap-4 items-center"},Le={class:"dropdown dropdown-sm"},Ve={tabindex:"0",class:"btn m-1"},je={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},Be={class:"label cursor-pointer justify-start gap-2"},He=["value"],Ue={class:"label-text"},De={class:"w-full flex items-center justify-center"},Ne={class:"stats shadow mb-6 w-full lg:w-1/2"},$e={class:"stat"},ze={class:"stat-value"},Fe={class:"stat"},Ee={class:"stat-value text-success"},Oe={class:"stat"},Pe={class:"stat-value text-error"},qe={class:"flex w-20 h-full w-full items-center justify-center text-center"},Ke={class:"flex items-center gap-2 ml-4"},Re=["disabled"],We=["disabled"],Ge={class:"card-body items-center text-center"},Je={class:"card-title text-6xl mb-4 py-6"},Qe=["innerHTML"],Xe={class:"flex gap-4"},Ye={key:1,class:"text-center py-12"},Ze={key:2,class:"text-center py-12"},et={key:3,class:"flex justify-center gap-2 my-4"},tt={class:"dropdown"},st=["value"],at={class:"modal"},nt={class:"modal-box relative"},lt={class:"mb-2"},ot={class:"mb-2 text-success"},it={class:"mb-4 text-error"},ut={class:"modal-box relative max-w-2xl"},rt={key:0,role:"alert",class:"alert alert-info shadow-lg mb-6"},dt={class:"text-xl font-bold mb-6"},ct={class:"form-control"},vt={class:"form-control"},mt={class:"label flex justify-between items-center"},pt=["disabled"],bt={class:"form-control"},ft={class:"modal-action mt-2"},gt={type:"submit",class:"btn btn-primary"},kt=fe({__name:"practice",setup(wt){const x=new Ce("flashcards"),ee=o(Se.languages),j=o("th-TH"),te=o({pronunciationLanguage:"th-TH"}),k=o([]),b=o(0),v=o(!1),f=o(!0),T=o([]),C=o(!1),g=o([]),I=o(0),N=o(!1),O=o(""),w=o(null),$=o(!1),A=o(!1),i=o({word:"",meaning:"",tagsInput:""}),z=S(()=>k.value.reduce((s,e)=>{var a;return s+(((a=e.stats)==null?void 0:a.correct)||0)},0)),F=S(()=>k.value.reduce((s,e)=>{var a;return s+(((a=e.stats)==null?void 0:a.incorrect)||0)},0)),P=S(()=>z.value+F.value),se=S(()=>[...new Set(k.value.flatMap(s=>s.tags))]),B=S(()=>k.value.filter(s=>T.value.length===0||T.value.some(e=>s.tags.includes(e)))),u=S(()=>B.value[b.value]||null),ae=S(()=>{var s;return((s=u.value)==null?void 0:s.meaning.replace(/\n/g,"<br>"))||""});async function ne(){const e=(await x.allDocs({include_docs:!0})).rows.map(a=>a.doc).filter(a=>{var l;return a.word&&!((l=a._id)!=null&&l.startsWith("_design"))});k.value=e.map(a=>{var l,n,d;return{...a,tags:a.tags||[],stats:{correct:((l=a.stats)==null?void 0:l.correct)||0,incorrect:((n=a.stats)==null?void 0:n.incorrect)||0,lastSeen:((d=a.stats)==null?void 0:d.lastSeen)||Date.now()}}}),f.value&&L()}function L(){b.value=0,v.value=!1,k.value=[...B.value].sort(()=>Math.random()-.5)}function le(){f.value=!f.value,v.value=!1,f.value?L():b.value=0}function oe(){v.value||(v.value=!0)}async function q(s){var n,d,_,V;if(!((n=u.value)!=null&&n._id))return;const e=await x.get(u.value._id),a={correct:((d=e.stats)==null?void 0:d.correct)||0,incorrect:((_=e.stats)==null?void 0:_.incorrect)||0,lastSeen:((V=e.stats)==null?void 0:V.lastSeen)||Date.now()},l=s?"correct":"incorrect";a[l]=(Number(a[l])||0)+1,a.lastSeen=Date.now(),await x.put({...e,stats:a}),u.value.stats&&(u.value.stats[s?"correct":"incorrect"]++,u.value.stats.lastSeen=a.lastSeen),u.value._id&&!g.value.includes(u.value._id)&&g.value.push(u.value._id),v.value=!1,ie()}function ie(){b.value<B.value.length-1?b.value++:f.value?L():b.value=0,v.value=!1,I.value=-1}function ue(s){var d;if(typeof window>"u"||!window.speechSynthesis)return;const e=new SpeechSynthesisUtterance(((d=u.value)==null?void 0:d.word)||""),a={th:"th-TH",en:"en-US",zh:"zh-CN"};e.lang=a[s]??"en-US";const l=window.speechSynthesis.getVoices(),n=l.find(_=>_.lang===e.lang)||l.find(_=>_.lang.startsWith(e.lang.slice(0,2)));n&&(e.voice=n),window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}function re(){C.value=!0}function K(){C.value=!1,v.value=!1,g.value=[],I.value=-1,f.value?L():b.value=0}function R(s){if(g.value.length===0)return;let e=I.value+s;if(e<0?e=g.value.length-1:e>=g.value.length&&(e=0),I.value=e,I.value>=0){const a=g.value[I.value],l=B.value.findIndex(n=>n._id===a);l>=0&&(b.value=l,v.value=!0)}}ge(T,()=>{b.value=0,v.value=!1,f.value&&L()});async function de(){try{const s=await x.get("app_settings");te.value={pronunciationLanguage:s.pronunciationLanguage||"th-TH"},j.value=s.pronunciationLanguage||"th-TH"}catch(s){console.error("Failed to load settings:",s)}}async function ce(){var _,V;const s=i.value.word.trim(),e=i.value.meaning.trim();if(!s||!e)return;if(k.value.find(h=>{var W,G;return((W=h==null?void 0:h.word)==null?void 0:W.toLowerCase())===(s==null?void 0:s.toLowerCase())&&h._id!==((G=w.value)==null?void 0:G._id)})){alert(`‡∏°‡∏µ‡∏Ñ‡∏≥ "${s}" ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);return}const l=i.value.tagsInput.split(",").map(h=>h.trim()).filter(Boolean),n=Date.now(),d={word:s,meaning:e,tags:l,createdAt:((_=w.value)==null?void 0:_.createdAt)||n,updatedAt:n};if((V=w.value)!=null&&V._id){const h=await x.get(w.value._id);await x.put({...d,_id:w.value._id,_rev:h._rev})}else await x.post(d);H()}const{getMeaning:ve}=Me();async function me(){try{const s=await x.get("app_settings");if(!(s!=null&&s.openaiApiKey))throw new Error("OpenAI API Key is not set");if(!i.value.word||A.value)throw new Error("Please enter a word");A.value=!0,i.value.meaning=await ve(i.value.word)}catch(s){pe("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î : "+s),console.error(s);return}finally{A.value=!1}}function pe(s){O.value=s,N.value=!0,setTimeout(()=>N.value=!1,5e3)}function be(s){s?(w.value=s,i.value={word:s.word,meaning:s.meaning,tagsInput:s.tags.join(", ")}):(w.value=null,i.value={word:"",meaning:"",tagsInput:""}),$.value=!0}function H(){$.value=!1,w.value=null}return we(()=>{ne(),de()}),(s,e)=>{const a=ke,l=ye;return r(),m("div",Ie,[t("div",Ae,[t("div",Te,[t("div",Le,[t("label",Ve,[p(a,{name:"material-symbols:label-important-rounded"}),e[12]||(e[12]=M(" Tags "))]),t("ul",je,[(r(!0),m(Q,null,X(se.value,n=>(r(),m("li",{key:n},[t("label",Be,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=d=>T.value=d),value:n,class:"checkbox"},null,8,He),[[Z,T.value]]),t("span",Ue,c(n),1)])]))),128))])]),t("button",{class:"btn btn-sm",onClick:le},[f.value?(r(),U(a,{key:1,name:"lineicons:sort-amount-asc"})):(r(),U(a,{key:0,name:"fe:random"})),M(" "+c(f.value?"A->B":"Random"),1)]),t("button",{class:"btn btn-error btn-sm",onClick:re},[p(a,{name:"ic:baseline-stop-circle"}),e[13]||(e[13]=M(" End "))])])]),t("div",De,[t("div",Ne,[t("div",$e,[e[14]||(e[14]=t("div",{class:"stat-title"},"Played",-1)),t("div",ze,c(P.value),1)]),t("div",Fe,[e[15]||(e[15]=t("div",{class:"stat-title"},"OK",-1)),t("div",Ee,c(z.value),1)]),t("div",Oe,[e[16]||(e[16]=t("div",{class:"stat-title"},"Wrong",-1)),t("div",Pe,c(F.value),1)]),t("div",qe,[p(l,{to:"/stat"},{default:_e(()=>[p(a,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto"})]),_:1})])]),t("div",Ke,[t("button",{class:"btn btn-sm",disabled:g.value.length===0,onClick:e[1]||(e[1]=n=>R(-1))},[p(a,{name:"material-symbols:arrow-back"})],8,Re),t("button",{class:"btn btn-sm",disabled:g.value.length===0,onClick:e[2]||(e[2]=n=>R(1))},[p(a,{name:"material-symbols:arrow-forward"})],8,We)])]),u.value&&!C.value?(r(),m("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:oe},[t("div",{onClick:e[3]||(e[3]=n=>be(u.value)),class:"absolute top-2 right-2"},[p(a,{name:"material-symbols:edit-square-outline"})]),t("div",Ge,[t("h2",Je,c(u.value.word),1),y(t("p",{class:"text-xl mb-4",innerHTML:ae.value},null,8,Qe),[[Y,v.value]]),y(t("div",Xe,[t("button",{class:"btn btn-success",onClick:e[4]||(e[4]=D(n=>q(!0),["stop"]))},"OK"),t("button",{class:"btn btn-error",onClick:e[5]||(e[5]=D(n=>q(!1),["stop"]))},"Again")],512),[[Y,v.value]])])])):C.value?(r(),m("div",Ze,e[18]||(e[18]=[t("p",null,"No cards available.",-1)]))):(r(),m("div",Ye,[e[17]||(e[17]=t("p",{class:"text-xl mb-4"},"No Words Selected",-1)),t("button",{class:"btn btn-primary",onClick:K},"Start")])),u.value&&!C.value?(r(),m("div",et,[t("div",tt,[y(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>j.value=n),class:"select select-bordered w-full"},[(r(!0),m(Q,null,X(ee.value,n=>(r(),m("option",{key:n.code,value:n.code},c(n.name),9,st))),128))],512),[[xe,j.value]])]),t("button",{class:"btn",onClick:e[7]||(e[7]=D(n=>ue(j.value),["stop"]))},[p(a,{name:"material-symbols:volume-up"}),e[19]||(e[19]=M(" ‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á "))])])):J("",!0),y(t("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":e[8]||(e[8]=n=>C.value=n)},null,512),[[Z,C.value]]),t("div",at,[t("div",nt,[e[20]||(e[20]=t("h3",{class:"text-lg font-bold mb-4"},"‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß üéâ",-1)),t("p",lt,"‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: "+c(P.value),1),t("p",ot,"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: "+c(z.value),1),t("p",it,"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+c(F.value),1),t("div",{class:"modal-action"},[t("button",{class:"btn btn-primary",onClick:K},"‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà")])])]),t("div",{class:he(["modal",{"modal-open":$.value}])},[t("div",ut,[t("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:H},"‚úï"),N.value?(r(),m("div",rt,[e[21]||(e[21]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",null,c(O.value),1)])):J("",!0),t("h3",dt,c(w.value?"‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå":"‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå"),1),t("form",{onSubmit:D(ce,["prevent"]),class:"space-y-6"},[t("div",ct,[e[22]||(e[22]=t("label",{class:"label"},[t("span",{class:"label-text font-medium"},"‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå")],-1)),y(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>i.value.word=n),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[E,i.value.word]])]),t("div",vt,[t("label",mt,[e[23]||(e[23]=t("span",{class:"label-text font-medium"},"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢",-1)),t("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!i.value.word||A.value,onClick:me},[A.value?(r(),U(a,{key:1,name:"svg-spinners:pulse-rings-3"})):(r(),U(a,{key:0,name:"material-symbols:magic-button"})),M(" "+c(A.value?"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...":"‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏≤‡∏Å AI"),1)],8,pt)]),y(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=n=>i.value.meaning=n),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[E,i.value.meaning]])]),t("div",bt,[e[24]||(e[24]=t("label",{class:"label"},[t("span",{class:"label-text font-medium"},"‡πÅ‡∏ó‡πá‡∏Å (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ,)")],-1)),y(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>i.value.tagsInput=n),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[E,i.value.tagsInput]])]),t("div",ft,[t("button",gt,[p(a,{name:"ri:save-3-line"}),e[25]||(e[25]=M(" ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å "))]),t("button",{type:"button",class:"btn",onClick:H},[p(a,{name:"bitcoin-icons:cross-filled"}),e[26]||(e[26]=M(" ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å "))])])],32)]),t("div",{class:"modal-backdrop",onClick:H})],2)])}}});export{kt as default};
