import{f as ae,r as l,g as w,z as ne,h as le,c as f,a as t,i as oe,l as C,b,d as I,F as E,j as z,A as F,t as r,w as ie,B as R,C as B,D as ue,m as W,e as ce,o as d,k as de}from"./DYqbC8ci.js";import{_ as re}from"./DqEtVgm4.js";import{P as ve}from"./BYoDscgR.js";import{p as me}from"./C9ZjJIze.js";const pe={class:"text-lg"},fe={class:"flex justify-end items-center mb-6"},be={class:"flex flex-wrap justify-end gap-4 items-center"},ge={class:"dropdown dropdown-sm"},_e={tabindex:"0",class:"btn m-1"},we={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},he={class:"label cursor-pointer justify-start gap-2"},xe=["value"],ye={class:"label-text"},ke={class:"w-full flex items-center justify-center"},Ce={class:"stats shadow mb-6 w-full lg:w-1/2"},Se={class:"stat"},Me={class:"stat-value"},Te={class:"stat"},Ie={class:"stat-value text-success"},Le={class:"stat"},He={class:"stat-value text-error"},je={class:"w-full flex justify-end pb-4"},Be={class:"flex items-center gap-2 ml-4"},De=["disabled"],Ne=["disabled"],Ve={class:"card-body items-center text-center"},$e={class:"card-title text-6xl mb-4 py-6"},Ue=["innerHTML"],Ae={class:"flex gap-4"},Ee={key:1,class:"text-center py-12"},ze={key:2,class:"text-center py-12"},Fe={key:3,class:"flex justify-center gap-2 my-4"},Re={class:"dropdown"},We=["value"],Ge={class:"modal"},Oe={class:"modal-box relative"},Pe={class:"mb-2"},Ke={class:"mb-2 text-success"},qe={class:"mb-4 text-error"},et=ae({__name:"practice",setup(Je){const S=new ve("flashcards"),G=l(me.languages),M=l("th-TH"),O=l({pronunciationLanguage:"th-TH"}),h=l([]),v=l(0),c=l(!1),m=l(!0),y=l([]),_=l(!1),p=l([]),x=l(0);l(!1),l("");const L=l(null);l(!1),l(!1);const D=l({word:"",meaning:"",tagsInput:""}),H=w(()=>h.value.reduce((a,e)=>{var s;return a+(((s=e.stats)==null?void 0:s.correct)||0)},0)),j=w(()=>h.value.reduce((a,e)=>{var s;return a+(((s=e.stats)==null?void 0:s.incorrect)||0)},0)),N=w(()=>H.value+j.value),P=w(()=>[...new Set(h.value.flatMap(a=>a.tags))]),T=w(()=>h.value.filter(a=>y.value.length===0||y.value.some(e=>a.tags.includes(e)))),i=w(()=>T.value[v.value]||null),K=w(()=>{var a;return((a=i.value)==null?void 0:a.meaning.replace(/\n/g,"<br>"))||""});async function q(){const e=(await S.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var o;return s.word&&!((o=s._id)!=null&&o.startsWith("_design"))});h.value=e.map(s=>{var o,u,n;return{...s,tags:s.tags||[],stats:{correct:((o=s.stats)==null?void 0:o.correct)||0,incorrect:((u=s.stats)==null?void 0:u.incorrect)||0,lastSeen:((n=s.stats)==null?void 0:n.lastSeen)||Date.now()}}}),m.value&&k()}function k(){v.value=0,c.value=!1,h.value=[...T.value].sort(()=>Math.random()-.5)}function J(){m.value=!m.value,c.value=!1,m.value?k():v.value=0}function Q(){c.value||(c.value=!0)}async function V(a){var u,n,g,A;if(!((u=i.value)!=null&&u._id))return;const e=await S.get(i.value._id),s={correct:((n=e.stats)==null?void 0:n.correct)||0,incorrect:((g=e.stats)==null?void 0:g.incorrect)||0,lastSeen:((A=e.stats)==null?void 0:A.lastSeen)||Date.now()},o=a?"correct":"incorrect";s[o]=(Number(s[o])||0)+1,s.lastSeen=Date.now(),await S.put({...e,stats:s}),i.value.stats&&(i.value.stats[a?"correct":"incorrect"]++,i.value.stats.lastSeen=s.lastSeen),i.value._id&&!p.value.includes(i.value._id)&&p.value.push(i.value._id),c.value=!1,X()}function X(){v.value<T.value.length-1?v.value++:m.value?k():v.value=0,c.value=!1,x.value=-1}function Y(a){var n;if(typeof window>"u"||!window.speechSynthesis)return;const e=new SpeechSynthesisUtterance(((n=i.value)==null?void 0:n.word)||""),s={th:"th-TH",en:"en-US",zh:"zh-CN"};e.lang=s[a]??"en-US";const o=window.speechSynthesis.getVoices(),u=o.find(g=>g.lang===e.lang)||o.find(g=>g.lang.startsWith(e.lang.slice(0,2)));u&&(e.voice=u),window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}function Z(){_.value=!0}function $(){_.value=!1,c.value=!1,p.value=[],x.value=-1,m.value?k():v.value=0}function U(a){if(p.value.length===0)return;let e=x.value+a;if(e<0?e=p.value.length-1:e>=p.value.length&&(e=0),x.value=e,x.value>=0){const s=p.value[x.value],o=T.value.findIndex(u=>u._id===s);o>=0&&(v.value=o,c.value=!0)}}ne(y,()=>{v.value=0,c.value=!1,m.value&&k()});async function ee(){try{const a=await S.get("app_settings");O.value={pronunciationLanguage:a.pronunciationLanguage||"th-TH"},M.value=a.pronunciationLanguage||"th-TH"}catch(a){console.error("Failed to load settings:",a)}}function te(a){a?(L.value=a,D.value={word:a.word,meaning:a.meaning,tagsInput:a.tags.join(", ")}):(L.value=null,D.value={word:"",meaning:"",tagsInput:""}),setTimeout(()=>{se("edit-modal")},40)}function se(a=""){const e=document.getElementById(a);e==null||e.classList.add("modal-open")}return le(()=>{q(),ee()}),(a,e)=>{const s=de,o=ce,u=re;return d(),f("div",pe,[t("div",fe,[t("div",be,[t("div",ge,[t("label",_e,[b(s,{name:"material-symbols:label-important-rounded"}),e[9]||(e[9]=I(" Tags "))]),t("ul",we,[(d(!0),f(E,null,z(P.value,n=>(d(),f("li",{key:n},[t("label",he,[C(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=g=>y.value=g),value:n,class:"checkbox"},null,8,xe),[[W,y.value]]),t("span",ye,r(n),1)])]))),128))])]),t("button",{class:"btn btn-sm",onClick:J},[m.value?(d(),F(s,{key:1,name:"lineicons:sort-amount-asc"})):(d(),F(s,{key:0,name:"fe:random"})),I(" "+r(m.value?"A->B":"Random"),1)]),b(o,{to:"/stat"},{default:ie(()=>[b(s,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto mb-1"})]),_:1}),t("button",{class:"btn btn-error btn-xs",onClick:Z},[b(s,{name:"ic:baseline-stop-circle"}),e[10]||(e[10]=I(" End "))])])]),t("div",ke,[t("div",Ce,[t("div",Se,[e[11]||(e[11]=t("div",{class:"stat-title"},"Played",-1)),t("div",Me,r(N.value),1)]),t("div",Te,[e[12]||(e[12]=t("div",{class:"stat-title"},"OK",-1)),t("div",Ie,r(H.value),1)]),t("div",Le,[e[13]||(e[13]=t("div",{class:"stat-title"},"Wrong",-1)),t("div",He,r(j.value),1)])])]),t("div",je,[t("div",Be,[t("button",{class:"btn btn-sm btn-outline",disabled:p.value.length===0,onClick:e[1]||(e[1]=n=>U(-1))},[b(s,{name:"material-symbols:arrow-back"})],8,De),t("button",{class:"btn btn-sm btn-outline",disabled:p.value.length===0,onClick:e[2]||(e[2]=n=>U(1))},[b(s,{name:"material-symbols:arrow-forward"})],8,Ne)])]),i.value&&!_.value?(d(),f("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:Q},[t("div",{onClick:e[3]||(e[3]=n=>te(i.value)),class:"absolute top-2 right-2"},[b(s,{name:"material-symbols:edit-square-outline"})]),t("div",Ve,[t("h2",$e,r(i.value.word),1),C(t("p",{class:"text-xl mb-4",innerHTML:K.value},null,8,Ue),[[R,c.value]]),C(t("div",Ae,[t("button",{class:"btn btn-success",onClick:e[4]||(e[4]=B(n=>V(!0),["stop"]))},"OK"),t("button",{class:"btn btn-error",onClick:e[5]||(e[5]=B(n=>V(!1),["stop"]))},"Again")],512),[[R,c.value]])])])):_.value?(d(),f("div",ze,e[15]||(e[15]=[t("p",null,"No cards available.",-1)]))):(d(),f("div",Ee,[e[14]||(e[14]=t("p",{class:"text-xl mb-4"},"No Words Selected",-1)),t("button",{class:"btn btn-primary",onClick:$},"Start")])),i.value&&!_.value?(d(),f("div",Fe,[t("div",Re,[C(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>M.value=n),class:"select select-bordered w-full"},[(d(!0),f(E,null,z(G.value,n=>(d(),f("option",{key:n.code,value:n.code},r(n.name),9,We))),128))],512),[[ue,M.value]])]),t("button",{class:"btn",onClick:e[7]||(e[7]=B(n=>Y(M.value),["stop"]))},[b(s,{name:"material-symbols:volume-up"}),e[16]||(e[16]=I(" ‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á "))])])):oe("",!0),C(t("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":e[8]||(e[8]=n=>_.value=n)},null,512),[[W,_.value]]),t("div",Ge,[t("div",Oe,[e[17]||(e[17]=t("h3",{class:"text-lg font-bold mb-4"},"‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß üéâ",-1)),t("p",Pe,"‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: "+r(N.value),1),t("p",Ke,"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: "+r(H.value),1),t("p",qe,"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+r(j.value),1),t("div",{class:"modal-action"},[t("button",{class:"btn btn-primary",onClick:$},"‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà")])])]),b(u,{id:"edit-modal",card:L.value},null,8,["card"])])}}});export{et as default};
