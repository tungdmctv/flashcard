import{f as it,D as rt,r as v,g as M,h as dt,c as h,a as e,m as ct,t as m,s as G,i as j,v as Q,u as K,d as L,F as X,k as Y,b as k,o as f,p as ut,j as vt,E as nt,q as _t,l as ot,w as yt,e as xt}from"./D6rAiux6.js";import{P as mt}from"./BYoDscgR.js";import{u as ht}from"./BOpmqxdM.js";import{p as kt}from"./C9ZjJIze.js";const Ct={class:"modal",id:"edit-modal"},St={class:"modal-box relative max-w-2xl"},It={key:0,role:"alert",class:"alert alert-info shadow-lg mb-6"},Mt={class:"text-xl font-bold mb-6"},$t={class:"form-control"},At={class:"form-control"},Tt={class:"label flex justify-between items-center"},Rt=["disabled"],jt={class:"form-control"},Lt={class:"flex flex-wrap gap-2 mb-4"},Et=["onClick"],Vt={class:"modal-action mt-2"},Bt={type:"submit",class:"btn btn-primary"},Dt=it({__name:"addEdit",props:{card:{type:Object,default:()=>({})}},emits:["saveCard"],setup(Z,{emit:V}){var O,H,U,E;const{getMeaning:J}=ht(),B=V,p=Z;rt(()=>p.card,r=>{var n,l,d,x;i.value.word=((n=p.card)==null?void 0:n.word)||"",i.value.meaning=((l=p.card)==null?void 0:l.meaning)||"",i.value.tagsInput=Array.isArray((d=p.card)==null?void 0:d.tags)?p.card.tags.join(", "):((x=p.card)==null?void 0:x.tags)||""});const b=new mt("flashcards"),i=v({word:((O=p.card)==null?void 0:O.word)||"",meaning:((H=p.card)==null?void 0:H.meaning)||"",tagsInput:Array.isArray((U=p.card)==null?void 0:U.tags)?p.card.tags.join(", "):((E=p.card)==null?void 0:E.tags)||""});function w(r){const l=(i.value.tagsInput||"").split(",").map(x=>x.trim()).filter(Boolean),d=l.indexOf(r);d===-1?l.push(r):l.splice(d,1),i.value.tagsInput=l.join(", ")}const g=v(!1),$=v(!1),I=v(""),_=v([]),T=M(()=>{const r=new Set;return _.value.forEach(n=>{var l;(l=n.tags)==null||l.forEach(d=>r.add(d))}),Array.from(r)});async function D(){const n=(await b.allDocs({include_docs:!0})).rows.map(l=>l.doc).filter(l=>{var d;return l.word&&!((d=l._id)!=null&&d.startsWith("_design"))});_.value=n.map(l=>{var d,x,C;return{...l,tags:l.tags||[],stats:{correct:((d=l.stats)==null?void 0:d.correct)||0,incorrect:((x=l.stats)==null?void 0:x.incorrect)||0,lastSeen:((C=l.stats)==null?void 0:C.lastSeen)||Date.now()}}})}async function W(){var N,P;const r=i.value.word.trim(),n=i.value.meaning.trim();if(!r||!n)return;if(_.value.find(S=>{var z,q;return((z=S==null?void 0:S.word)==null?void 0:z.toLowerCase())===(r==null?void 0:r.toLowerCase())&&S._id!==((q=p.card)==null?void 0:q._id)})){alert(`มีคำ "${r}" อยู่แล้วในรายการ`);return}console.log("cardForm",i.value);const d=i.value.tagsInput.split(",").map(S=>S.trim()).filter(Boolean),x=Date.now(),C={word:r,meaning:n,tags:d,createdAt:((N=p.card)==null?void 0:N.createdAt)||x,updatedAt:x};if((P=p.card)!=null&&P._id){const S=await b.get(p.card._id);await b.put({...C,_id:p.card._id,_rev:S._rev})}else await b.post(C);A(),D(),B("saveCard",!0)}async function F(){try{const r=await b.get("app_settings");if(!(r!=null&&r.openaiApiKey))throw new Error("OpenAI API Key is not set");if(!i.value.word||g.value)throw new Error("Please enter a word");g.value=!0,i.value.meaning=await J(i.value.word)}catch(r){y("เกิดข้อผิดพลาด : "+r),console.error(r);return}finally{g.value=!1}}function y(r){I.value=r,$.value=!0,setTimeout(()=>$.value=!1,5e3)}function A(){const r=document.getElementById("edit-modal");r==null||r.classList.remove("modal-open")}return dt(()=>{D()}),(r,n)=>{const l=vt;return f(),h("div",Ct,[e("div",St,[e("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:A},"✕"),$.value?(f(),h("div",It,[n[3]||(n[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,m(I.value),1)])):ct("",!0),e("h3",Mt,m(p.card?"แก้ไขคำศัพท์":"เพิ่มคำศัพท์"),1),e("form",{onSubmit:G(W,["prevent"]),class:"space-y-6"},[e("div",$t,[n[4]||(n[4]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"คำศัพท์")],-1)),j(e("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>i.value.word=d),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[Q,i.value.word]])]),e("div",At,[e("label",Tt,[n[5]||(n[5]=e("span",{class:"label-text font-medium"},"ความหมาย",-1)),e("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!i.value.word||g.value,onClick:F},[g.value?(f(),K(l,{key:1,name:"svg-spinners:pulse-rings-3"})):(f(),K(l,{key:0,name:"material-symbols:magic-button"})),L(" "+m(g.value?"กำลังโหลด...":"ขอความหมายจาก AI"),1)],8,Rt)]),j(e("textarea",{"onUpdate:modelValue":n[1]||(n[1]=d=>i.value.meaning=d),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[Q,i.value.meaning]])]),e("div",jt,[n[6]||(n[6]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"แท็ก (คั่นด้วย ,)")],-1)),j(e("input",{"onUpdate:modelValue":n[2]||(n[2]=d=>i.value.tagsInput=d),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[Q,i.value.tagsInput]])]),e("div",Lt,[(f(!0),h(X,null,Y(T.value,d=>(f(),h("span",{key:d,class:ut(["badge badge-lg cursor-pointer",{"badge-primary":i.value.tagsInput.includes(d)}]),onClick:x=>w(d)},m(d),11,Et))),128))]),e("div",Vt,[e("button",Bt,[k(l,{name:"ri:save-3-line"}),n[7]||(n[7]=L(" บันทึก "))]),e("button",{type:"button",class:"btn",onClick:A},[k(l,{name:"bitcoin-icons:cross-filled"}),n[8]||(n[8]=L(" ยกเลิก "))])])],32)]),e("div",{class:"modal-backdrop",onClick:A})])}}}),Ot={class:"text-lg"},Ht={class:"flex justify-end items-center mb-6"},Ut={class:"flex flex-wrap justify-end gap-4 items-center"},Wt={class:"dropdown dropdown-sm"},Ft={tabindex:"0",class:"btn m-1"},Nt={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},Pt={class:"label cursor-pointer justify-start gap-2"},zt=["value"],qt={class:"label-text"},Gt={class:"w-full flex flex-col items-center justify-center"},Kt={class:"stats shadow mb-2 w-full lg:w-1/2"},Jt={class:"stat"},Qt={class:"stat-value"},Xt={class:"stat"},Yt={class:"stat-value text-success"},Zt={class:"stat"},te={class:"stat-value text-error"},ee={class:"stat"},se={class:"stat-value"},ae={class:"w-full flex justify-end items-center pb-4"},le={class:"flex items-center gap-2 ml-4"},ne=["disabled"],oe=["disabled"],ie={class:"card-body items-center text-center"},re={class:"card-title text-6xl mb-4 py-6"},de=["innerHTML"],ce={class:"flex gap-4"},ue={key:1,class:"text-center py-12"},ve={key:2,class:"text-center py-12"},me={key:3,class:"flex justify-center gap-2 my-4"},pe={class:"dropdown"},fe=["value"],ge={class:"modal"},be={class:"modal-box relative"},we={class:"mb-2"},_e={class:"mb-2 text-success"},ye={class:"mb-4 text-error"},xe={class:"modal-box w-full"},he={class:"w-2/3 mx-center stats stats-vertical shadow"},ke={class:"stat"},Ce={class:"stat-value"},Se={class:"stat"},Ie={class:"stat-value text-success"},Me={class:"stat-desc"},$e={class:"stat"},Ae={class:"stat-value text-error"},Te={class:"stat-desc"},Re={class:"stat"},je={class:"stat-value"},Le={class:"modal-action"},Oe=it({__name:"practice",setup(Z){const V=new mt("flashcards"),J=v(kt.languages),B=v("th-TH"),p=v({pronunciationLanguage:"th-TH"}),b=v([]),i=v(0),w=v(!1),g=v(!0),$=v([]),I=v(!1),_=v([]),T=v(0);v(!1),v("");const D=v(!1),W=v(void 0);v(!1),v(!1);const F=v({word:"",meaning:"",tagsInput:""}),y=v({}),A=M(()=>b.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.correct)||0)},0)),O=M(()=>b.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.incorrect)||0)},0)),H=M(()=>A.value+O.value),U=M(()=>{const a=H.value;return a>0?Math.round(A.value/a*100):0}),E=M(()=>{const a=Object.values(y.value);return{totalPlayed:a.reduce((t,s)=>t+s.played,0),totalCorrect:a.reduce((t,s)=>t+s.correct,0),totalIncorrect:a.reduce((t,s)=>t+s.incorrect,0),avgSuccessRate:a.length>0?Math.round(a.reduce((t,s)=>t+s.successRate,0)/a.length):0}}),r=M(()=>[...new Set(b.value.flatMap(a=>a.tags))]),n=M(()=>b.value.filter(a=>$.value.length===0||$.value.some(t=>a.tags.includes(t)))),l=M(()=>n.value[i.value]||null),d=M(()=>{var a;return((a=l.value)==null?void 0:a.meaning.replace(/\n/g,"<br>"))||""});async function x(){const t=(await V.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var c;return s.word&&!((c=s._id)!=null&&c.startsWith("_design"))});b.value=t.map(s=>{var c,u,o;return{...s,tags:s.tags||[],stats:{correct:((c=s.stats)==null?void 0:c.correct)||0,incorrect:((u=s.stats)==null?void 0:u.incorrect)||0,lastSeen:((o=s.stats)==null?void 0:o.lastSeen)||Date.now()}}}),g.value&&C()}function C(){i.value=0,w.value=!1,b.value=[...n.value].sort(()=>Math.random()-.5)}function N(){g.value=!g.value,w.value=!1,g.value?C():i.value=0}function P(){w.value||(w.value=!0)}async function S(a){var o,R,st,at,lt;if(!((o=l.value)!=null&&o._id))return;const t=await V.get(l.value._id),s={correct:((R=t.stats)==null?void 0:R.correct)||0,incorrect:((st=t.stats)==null?void 0:st.incorrect)||0,lastSeen:((at=t.stats)==null?void 0:at.lastSeen)||Date.now()},c=a?"correct":"incorrect";s[c]=(Number(s[c])||0)+1,s.lastSeen=Date.now(),await V.put({...t,stats:s}),l.value.stats&&(l.value.stats[a?"correct":"incorrect"]++,l.value.stats.lastSeen=s.lastSeen),l.value._id&&!_.value.includes(l.value._id)&&_.value.push(l.value._id);const u=((lt=l.value)==null?void 0:lt._id)||"";y.value[u]||(y.value[u]={played:0,correct:0,incorrect:0,successRate:0}),y.value[u].played++,a?y.value[u].correct++:y.value[u].incorrect++,y.value[u].successRate=y.value[u].played>0?Math.round(y.value[u].correct/y.value[u].played*100):0,w.value=!1,z()}function z(){g.value&&(Math.random()<.75?(console.log("shuffle"),C()):(console.log("getLowestSuccessRateWords"),q())),i.value<n.value.length-1?i.value++:i.value=0,w.value=!1,T.value=-1}function q(a=5){const t=Object.entries(y.value).filter(([s,c])=>c.played>0&&c.successRate<80).sort((s,c)=>s[1].successRate-c[1].successRate).slice(0,a).map(([s,c])=>{var u;return{wordId:s,word:((u=b.value.find(o=>o._id===s))==null?void 0:u.word)||s,successRate:c.successRate}});if(t.length>0){const s=t[0],c=b.value.find(u=>u._id===s.wordId);if(c){const u=n.value.filter(o=>o._id!==s.wordId).toSpliced(i.value,0,c);n.value=[...u]}}return console.log("lowestWords",t),t}function pt(a){var o;if(typeof window>"u"||!window.speechSynthesis)return;const t=new SpeechSynthesisUtterance(((o=l.value)==null?void 0:o.word)||""),s={th:"th-TH",en:"en-US",zh:"zh-CN"};t.lang=s[a]??"en-US";const c=window.speechSynthesis.getVoices(),u=c.find(R=>R.lang===t.lang)||c.find(R=>R.lang.startsWith(t.lang.slice(0,2)));u&&(t.voice=u),window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}function ft(){I.value=!0}function tt(){I.value=!1,w.value=!1,_.value=[],T.value=-1,g.value?C():i.value=0}function et(a){if(_.value.length===0)return;let t=T.value+a;if(t<0?t=_.value.length-1:t>=_.value.length&&(t=0),T.value=t,T.value>=0){const s=_.value[T.value],c=n.value.findIndex(u=>u._id===s);c>=0&&(i.value=c,w.value=!0)}}rt($,()=>{i.value=0,w.value=!1,g.value&&C()});async function gt(){try{const a=await V.get("app_settings");p.value={pronunciationLanguage:a.pronunciationLanguage||"th-TH"},B.value=a.pronunciationLanguage||"th-TH"}catch(a){console.error("Failed to load settings:",a)}}function bt(a){a?(W.value=a,F.value={word:a.word,meaning:a.meaning,tagsInput:a.tags.join(", ")}):(W.value=void 0,F.value={word:"",meaning:"",tagsInput:""}),setTimeout(()=>{wt("edit-modal")},40)}function wt(a=""){const t=document.getElementById(a);t==null||t.classList.add("modal-open")}return dt(()=>{x(),gt()}),(a,t)=>{const s=vt,c=xt,u=Dt;return f(),h("div",Ot,[e("div",Ht,[e("div",Ut,[e("div",Wt,[e("label",Ft,[k(s,{name:"material-symbols:label-important-rounded"}),t[11]||(t[11]=L(" Tags "))]),e("ul",Nt,[(f(!0),h(X,null,Y(r.value,o=>(f(),h("li",{key:o},[e("label",Pt,[j(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=R=>$.value=R),value:o,class:"checkbox"},null,8,zt),[[ot,$.value]]),e("span",qt,m(o),1)])]))),128))])]),e("button",{class:"btn btn-sm",onClick:N},[g.value?(f(),K(s,{key:0,name:"fe:random"})):(f(),K(s,{key:1,name:"lineicons:sort-amount-asc"})),L(" "+m(g.value?"Random":"A->B"),1)]),e("div",{onClick:t[1]||(t[1]=o=>D.value=!0)},[k(s,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto mb-1"})]),e("button",{class:"btn btn-error btn-xs",onClick:ft},[k(s,{name:"ic:baseline-stop-circle"}),t[12]||(t[12]=L(" End "))])])]),e("div",Gt,[e("div",Kt,[e("div",Jt,[t[13]||(t[13]=e("div",{class:"stat-title"},"เล่น",-1)),e("div",Qt,m(E.value.totalPlayed),1)]),e("div",Xt,[t[14]||(t[14]=e("div",{class:"stat-title"},"ถูก",-1)),e("div",Yt,m(E.value.totalCorrect),1)]),e("div",Zt,[t[15]||(t[15]=e("div",{class:"stat-title"},"ผิด",-1)),e("div",te,m(E.value.totalIncorrect),1)]),e("div",ee,[t[16]||(t[16]=e("div",{class:"stat-title"},"อัตราความสำเร็จ",-1)),e("div",se,m(E.value.avgSuccessRate)+"%",1)])])]),e("div",ae,[e("div",le,[e("button",{class:"btn btn-sm btn-outline",disabled:_.value.length===0,onClick:t[2]||(t[2]=o=>et(-1))},[k(s,{name:"material-symbols:arrow-back"})],8,ne),e("button",{class:"btn btn-sm btn-outline",disabled:_.value.length===0,onClick:t[3]||(t[3]=o=>et(1))},[k(s,{name:"material-symbols:arrow-forward"})],8,oe)])]),l.value&&!I.value?(f(),h("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:P},[e("div",{onClick:t[4]||(t[4]=o=>bt(l.value)),class:"absolute top-2 right-2"},[k(s,{name:"material-symbols:edit-square-outline"})]),e("div",ie,[e("h2",re,m(l.value.word),1),j(e("p",{class:"text-xl mb-4",innerHTML:d.value},null,8,de),[[nt,w.value]]),j(e("div",ce,[e("button",{class:"btn btn-success",onClick:t[5]||(t[5]=G(o=>S(!0),["stop"]))},"OK"),e("button",{class:"btn btn-error",onClick:t[6]||(t[6]=G(o=>S(!1),["stop"]))},"Again")],512),[[nt,w.value]])])])):I.value?(f(),h("div",ve,t[18]||(t[18]=[e("p",null,"No cards available.",-1)]))):(f(),h("div",ue,[t[17]||(t[17]=e("p",{class:"text-xl mb-4"},"No Words Selected",-1)),e("button",{class:"btn btn-primary",onClick:tt},"Start")])),l.value&&!I.value?(f(),h("div",me,[e("div",pe,[j(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>B.value=o),class:"select select-bordered w-full"},[(f(!0),h(X,null,Y(J.value,o=>(f(),h("option",{key:o.code,value:o.code},m(o.name),9,fe))),128))],512),[[_t,B.value]])]),e("button",{class:"btn",onClick:t[8]||(t[8]=G(o=>pt(B.value),["stop"]))},[k(s,{name:"material-symbols:volume-up"}),t[19]||(t[19]=L(" อ่านออกเสียง "))])])):ct("",!0),j(e("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":t[9]||(t[9]=o=>I.value=o)},null,512),[[ot,I.value]]),e("div",ge,[e("div",be,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold mb-4"},"จบเกมแล้ว 🎉",-1)),e("p",we,"คำที่ทายไปทั้งหมด: "+m(H.value),1),e("p",_e,"จำนวนคำที่ถูกต้อง: "+m(A.value),1),e("p",ye,"จำนวนคำที่ผิดพลาด: "+m(O.value),1),e("div",{class:"modal-action"},[e("button",{class:"btn btn-primary",onClick:tt},"เล่นใหม่")])])]),e("dialog",{id:"stats_modal",class:ut(["modal",{"modal-open":D.value}])},[e("div",xe,[t[27]||(t[27]=e("h3",{class:"w-full flex justify-center items-center font-bold text-lg mb-4"},"Overall Statistics",-1)),e("div",he,[e("div",ke,[t[21]||(t[21]=e("div",{class:"stat-title"},"Total Plays",-1)),e("div",Ce,m(H.value),1)]),e("div",Se,[t[22]||(t[22]=e("div",{class:"stat-title"},"Correct",-1)),e("div",Ie,m(A.value),1),e("div",Me,m(U.value)+"% ",1)]),e("div",$e,[t[23]||(t[23]=e("div",{class:"stat-title"},"Incorrect",-1)),e("div",Ae,m(O.value),1),e("div",Te,m(100-U.value)+"%",1)]),e("div",Re,[t[24]||(t[24]=e("div",{class:"stat-title"},"Success Rate",-1)),e("div",je,m(U.value)+"%",1),t[25]||(t[25]=e("div",{class:"stat-desc"},"Overall success rate",-1))])]),e("div",Le,[k(c,{to:"/stat",class:"btn btn-secondary"},{default:yt(()=>[k(s,{name:"material-symbols:bar-chart-4-bars"}),t[26]||(t[26]=L(" Stats "))]),_:1,__:[26]}),e("button",{class:"btn",onClick:t[10]||(t[10]=o=>D.value=!1)},"Close")])])],2),k(u,{id:"edit-modal",card:W.value},null,8,["card"])])}}});export{Oe as default};
