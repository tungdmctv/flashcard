import{f as X,r as o,g as A,h as Y,c as b,a as e,l as w,m as M,F as V,j,t as r,p as Z,q as N,d as x,b as I,n as E,o as c,s as ee,k as te}from"./CxFqhSA7.js";import{P as se}from"./BYoDscgR.js";import{u as le}from"./BOpmqxdM.js";const ne={class:"flex gap-4 mb-6 flex-wrap"},ae={class:"dropdown"},oe={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-[1] max-h-96 overflow-y-auto"},ie={class:"cursor-pointer flex gap-2"},de=["value"],ue={class:"flex justify-center my-8"},re={class:"btn-group"},ce=["disabled"],ve={class:"btn"},be=["disabled"],me={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},pe={class:"card-body"},fe={class:"card-title"},ge={class:"flex flex-wrap gap-2 mt-2"},_e={class:"card-actions justify-end mt-4"},we=["onClick"],xe=["onClick"],ye={class:"flex justify-center mt-8"},Ce={class:"btn-group"},ke=["disabled"],he={class:"btn"},Ae=["disabled"],Me={class:"modal-box relative max-w-2xl"},Ie={class:"text-xl font-bold mb-6"},De={class:"form-control"},Le={class:"form-control"},Ve={class:"label flex justify-between items-center"},je=["disabled"],$e={class:"form-control"},Be={class:"modal-action mt-2"},Pe={type:"submit",class:"btn btn-primary"},Te={class:"modal-box"},Ue={class:"modal-action"},$=10,Ne=X({__name:"cards",setup(Fe){const m=new se("flashcards"),y=o([]),_=o(""),C=o([]),i=o(null),p=o(null),D=o(!1),k=o(!1),f=o(!1),n=o({word:"",meaning:"",tagsInput:""}),a=o(1),{getMeaning:O}=le(),Q=A(()=>Array.from(new Set(y.value.flatMap(s=>s.tags)))),B=A(()=>y.value.filter(s=>{const t=_.value?s.word&&s.word.toLowerCase().includes(_.value.toLowerCase())||s.meaning&&s.meaning.toLowerCase().includes(_.value.toLowerCase()):!0,d=!C.value.length||s.tags&&C.value.every(g=>s.tags.includes(g));return t&&d&&s.word}).sort((s,t)=>(t.updatedAt||0)-(s.updatedAt||0))),P=A(()=>Math.ceil(B.value.length/$)),G=A(()=>{const s=(a.value-1)*$,t=s+$;return B.value.slice(s,t)});function H(){T()}function T(s){s?(i.value=s,n.value={word:s.word,meaning:s.meaning,tagsInput:s.tags.join(", ")}):(i.value=null,n.value={word:"",meaning:"",tagsInput:""}),D.value=!0}function h(){D.value=!1,i.value=null}function J(s){p.value=s,k.value=!0}function U(){k.value=!1,p.value=null}async function L(){const s=await m.allDocs({include_docs:!0});y.value=s.rows.map(t=>t.doc)}async function K(){var F,S;const s=n.value.word.trim(),t=n.value.meaning.trim();if(!s||!t)return;if(y.value.find(v=>{var q,z;return((q=v==null?void 0:v.word)==null?void 0:q.toLowerCase())===(s==null?void 0:s.toLowerCase())&&v._id!==((z=i.value)==null?void 0:z._id)})){alert(`มีคำ "${s}" อยู่แล้วในรายการ`);return}const g=n.value.tagsInput.split(",").map(v=>v.trim()).filter(Boolean),l=Date.now(),u={word:s,meaning:t,tags:g,createdAt:((F=i.value)==null?void 0:F.createdAt)||l,updatedAt:l};if((S=i.value)!=null&&S._id){const v=await m.get(i.value._id);await m.put({...u,_id:i.value._id,_rev:v._rev})}else await m.post(u);h(),L()}async function R(){var t;if(!((t=p.value)!=null&&t._id))return;const s=await m.get(p.value._id);await m.remove(s),k.value=!1,p.value=null,L()}async function W(){if(!(!n.value.word||f.value)){f.value=!0;try{n.value.meaning=await O(n.value.word)}catch(s){console.error(s)}finally{f.value=!1}}}return Y(L),(s,t)=>{var g;const d=te;return c(),b("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold"},"จัดการคำศัพท์",-1)),e("button",{class:"btn btn-primary",onClick:H},"เพิ่มคำศัพท์")]),e("div",ne,[w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>_.value=l),type:"text",placeholder:"ค้นหาคำศัพท์...",class:"input input-bordered w-full max-w-xs"},null,512),[[M,_.value]]),e("div",ae,[t[10]||(t[10]=e("label",{tabindex:"0",class:"btn m-1"},"กรองตามแท็ก",-1)),e("ul",oe,[(c(!0),b(V,null,j(Q.value.filter(l=>l),l=>(c(),b("li",{key:l},[e("label",ie,[w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>C.value=u),value:l,type:"checkbox",class:"checkbox"},null,8,de),[[ee,C.value]]),e("span",null,r(l),1)])]))),128))])])]),e("div",ue,[e("div",re,[e("button",{class:"btn",disabled:a.value===1,onClick:t[2]||(t[2]=l=>a.value--)},"«",8,ce),e("button",ve,"หน้า "+r(a.value),1),e("button",{class:"btn",disabled:a.value>=P.value,onClick:t[3]||(t[3]=l=>a.value++)},"»",8,be)])]),e("div",me,[(c(!0),b(V,null,j(G.value,l=>(c(),b("div",{key:l._id,class:"card bg-base-200"},[e("div",pe,[e("h2",fe,r(l.word),1),e("p",null,r(l.meaning),1),e("div",ge,[(c(!0),b(V,null,j(l.tags,u=>(c(),b("span",{key:u,class:"badge badge-primary"},r(u),1))),128))]),e("div",_e,[e("button",{class:"btn btn-sm",onClick:u=>T(l)},"แก้ไข",8,we),e("button",{class:"btn btn-sm btn-error",onClick:u=>J(l)},"ลบ",8,xe)])])]))),128))]),e("div",ye,[e("div",Ce,[e("button",{class:"btn",disabled:a.value===1,onClick:t[4]||(t[4]=l=>a.value--)},"«",8,ke),e("button",he,"หน้า "+r(a.value),1),e("button",{class:"btn",disabled:a.value>=P.value,onClick:t[5]||(t[5]=l=>a.value++)},"»",8,Ae)])]),e("div",{class:E(["modal",{"modal-open":D.value}])},[e("div",Me,[e("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:h},"✕"),e("h3",Ie,r(i.value?"แก้ไขคำศัพท์":"เพิ่มคำศัพท์"),1),e("form",{onSubmit:Z(K,["prevent"]),class:"space-y-6"},[e("div",De,[t[11]||(t[11]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"คำศัพท์")],-1)),w(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.word=l),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[M,n.value.word]])]),e("div",Le,[e("label",Ve,[t[12]||(t[12]=e("span",{class:"label-text font-medium"},"ความหมาย",-1)),e("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!n.value.word||f.value,onClick:W},[f.value?(c(),N(d,{key:1,name:"svg-spinners:pulse-rings-3"})):(c(),N(d,{key:0,name:"material-symbols:magic-button"})),x(" "+r(f.value?"กำลังโหลด...":"ขอความหมายจาก AI"),1)],8,je)]),w(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>n.value.meaning=l),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[M,n.value.meaning]])]),e("div",$e,[t[13]||(t[13]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"แท็ก (คั่นด้วย ,)")],-1)),w(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.tagsInput=l),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[M,n.value.tagsInput]])]),e("div",Be,[e("button",Pe,[I(d,{name:"ri:save-3-line"}),t[14]||(t[14]=x(" บันทึก "))]),e("button",{type:"button",class:"btn",onClick:h},[I(d,{name:"bitcoin-icons:cross-filled"}),t[15]||(t[15]=x(" ยกเลิก "))])])],32)]),e("div",{class:"modal-backdrop",onClick:h})],2),e("div",{class:E(["modal",{"modal-open":k.value}])},[e("div",Te,[t[18]||(t[18]=e("h3",{class:"text-lg font-bold mb-4"},"ยืนยันการลบ",-1)),e("p",null,'คุณต้องการลบคำศัพท์ "'+r((g=p.value)==null?void 0:g.word)+'" ใช่หรือไม่?',1),e("div",Ue,[e("button",{class:"btn btn-error",onClick:R},[I(d,{name:"material-symbols:delete-outline"}),t[16]||(t[16]=x(" ยืนยัน "))]),e("button",{class:"btn",onClick:U},[I(d,{name:"bitcoin-icons:cross-filled"}),t[17]||(t[17]=x(" ยกเลิก "))])])]),e("div",{class:"modal-backdrop",onClick:U})],2)])}}});export{Ne as default};
