import{j as Z,r,k as I,l as ee,c as f,o as c,a as e,m as C,v as P,F as D,n as E,p as te,t as p,q as se,s as F,d as k,b as M,x as ne,y as O}from"./DQGBt3bx.js";import{P as q}from"./BYoDscgR.js";function oe(){const j="app_settings",m=new q("flashcards");async function w(){try{const a=await m.get(j);if(!a.openaiApiKey||!a.customPrompt||!a.responseLanguage)throw new Error("การตั้งค่าไม่ถูกต้อง");return{openaiApiKey:a.openaiApiKey,customPrompt:a.customPrompt,responseLanguage:a.responseLanguage}}catch(a){throw console.error("Error loading settings:",a),new Error("ไม่พบการตั้งค่า API Key")}}async function g(a){try{const o=await w();if(!o.openaiApiKey)throw new Error("กรุณาตั้งค่า OpenAI API Key ก่อนใช้งาน");const v=o.customPrompt.replace("{word}",a),_=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.openaiApiKey}`},body:JSON.stringify({model:"gpt-4.1-nano",messages:[{role:"system",content:`You are a helpful assistant that provides word meanings and examples. Please respond in ${o.responseLanguage==="th"?"Thai":"English"} language.`},{role:"user",content:v}],temperature:.7})});if(!_.ok)throw new Error("เกิดข้อผิดพลาดในการเรียกใช้ API");return(await _.json()).choices[0].message.content.trim()}catch(o){throw console.error("Error getting meaning:",o),new Error(o.message||"เกิดข้อผิดพลาดในการขอความหมายจาก AI")}}return{getMeaning:g}}const ae={class:"flex gap-4 mb-6 flex-wrap"},le={class:"dropdown"},ie={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-[1] max-h-96 overflow-y-auto"},re={class:"cursor-pointer flex gap-2"},ue=["value"],de={class:"flex justify-center my-8"},ce={class:"btn-group"},pe=["disabled"],me={class:"btn"},ve=["disabled"],be={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},ge={class:"card-body"},fe={class:"card-title"},we={class:"flex flex-wrap gap-2 mt-2"},_e={class:"card-actions justify-end mt-4"},ye=["onClick"],he=["onClick"],xe={class:"flex justify-center mt-8"},Ce={class:"btn-group"},ke=["disabled"],Ae={class:"btn"},Ie=["disabled"],Pe={class:"modal-box relative max-w-2xl"},Me={class:"text-xl font-bold mb-6"},Le={class:"form-control"},De={class:"form-control"},Ee={class:"label flex justify-between items-center"},Te=["disabled"],je={class:"form-control"},Se={class:"modal-action mt-2"},$e={type:"submit",class:"btn btn-primary"},Ve={class:"modal-box"},Be={class:"modal-action"},T=10,Ue=Z({__name:"cards",setup(j){const m=new q("flashcards"),w=r([]),g=r(""),a=r([]),o=r(null),v=r(null),_=r(!1),x=r(!1),y=r(!1),l=r({word:"",meaning:"",tagsInput:""}),i=r(1),{getMeaning:G}=oe(),J=I(()=>Array.from(new Set(w.value.flatMap(s=>s.tags)))),S=I(()=>w.value.filter(s=>{const t=g.value?s.word&&s.word.toLowerCase().includes(g.value.toLowerCase())||s.meaning&&s.meaning.toLowerCase().includes(g.value.toLowerCase()):!0,u=!a.value.length||s.tags&&a.value.every(h=>s.tags.includes(h));return t&&u&&s.word}).sort((s,t)=>(t.updatedAt||0)-(s.updatedAt||0))),$=I(()=>Math.ceil(S.value.length/T)),Q=I(()=>{const s=(i.value-1)*T,t=s+T;return S.value.slice(s,t)});function Y(){V()}function V(s){s?(o.value=s,l.value={word:s.word,meaning:s.meaning,tagsInput:s.tags.join(", ")}):(o.value=null,l.value={word:"",meaning:"",tagsInput:""}),_.value=!0}function A(){_.value=!1,o.value=null}function H(s){v.value=s,x.value=!0}function B(){x.value=!1,v.value=null}async function L(){const s=await m.allDocs({include_docs:!0});w.value=s.rows.map(t=>t.doc)}async function R(){var K,N;const s=l.value.word.trim(),t=l.value.meaning.trim();if(!s||!t)return;if(w.value.find(b=>{var U,z;return((U=b==null?void 0:b.word)==null?void 0:U.toLowerCase())===(s==null?void 0:s.toLowerCase())&&b._id!==((z=o.value)==null?void 0:z._id)})){alert(`มีคำ "${s}" อยู่แล้วในรายการ`);return}const h=l.value.tagsInput.split(",").map(b=>b.trim()).filter(Boolean),n=Date.now(),d={word:s,meaning:t,tags:h,createdAt:((K=o.value)==null?void 0:K.createdAt)||n,updatedAt:n};if((N=o.value)!=null&&N._id){const b=await m.get(o.value._id);await m.put({...d,_id:o.value._id,_rev:b._rev})}else await m.post(d);A(),L()}async function W(){var t;if(!((t=v.value)!=null&&t._id))return;const s=await m.get(v.value._id);await m.remove(s),x.value=!1,v.value=null,L()}async function X(){if(!(!l.value.word||y.value)){y.value=!0;try{l.value.meaning=await G(l.value.word)}catch(s){console.error(s)}finally{y.value=!1}}}return ee(L),(s,t)=>{var h;const u=ne;return c(),f("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold"},"จัดการคำศัพท์",-1)),e("button",{class:"btn btn-primary",onClick:Y},"เพิ่มคำศัพท์")]),e("div",ae,[C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>g.value=n),type:"text",placeholder:"ค้นหาคำศัพท์...",class:"input input-bordered w-full max-w-xs"},null,512),[[P,g.value]]),e("div",le,[t[10]||(t[10]=e("label",{tabindex:"0",class:"btn m-1"},"กรองตามแท็ก",-1)),e("ul",ie,[(c(!0),f(D,null,E(J.value.filter(n=>n),n=>(c(),f("li",{key:n},[e("label",re,[C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>a.value=d),value:n,type:"checkbox",class:"checkbox"},null,8,ue),[[te,a.value]]),e("span",null,p(n),1)])]))),128))])])]),e("div",de,[e("div",ce,[e("button",{class:"btn",disabled:i.value===1,onClick:t[2]||(t[2]=n=>i.value--)},"«",8,pe),e("button",me,"หน้า "+p(i.value),1),e("button",{class:"btn",disabled:i.value>=$.value,onClick:t[3]||(t[3]=n=>i.value++)},"»",8,ve)])]),e("div",be,[(c(!0),f(D,null,E(Q.value,n=>(c(),f("div",{key:n._id,class:"card bg-base-200"},[e("div",ge,[e("h2",fe,p(n.word),1),e("p",null,p(n.meaning),1),e("div",we,[(c(!0),f(D,null,E(n.tags,d=>(c(),f("span",{key:d,class:"badge badge-primary"},p(d),1))),128))]),e("div",_e,[e("button",{class:"btn btn-sm",onClick:d=>V(n)},"แก้ไข",8,ye),e("button",{class:"btn btn-sm btn-error",onClick:d=>H(n)},"ลบ",8,he)])])]))),128))]),e("div",xe,[e("div",Ce,[e("button",{class:"btn",disabled:i.value===1,onClick:t[4]||(t[4]=n=>i.value--)},"«",8,ke),e("button",Ae,"หน้า "+p(i.value),1),e("button",{class:"btn",disabled:i.value>=$.value,onClick:t[5]||(t[5]=n=>i.value++)},"»",8,Ie)])]),e("div",{class:O(["modal",{"modal-open":_.value}])},[e("div",Pe,[e("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:A},"✕"),e("h3",Me,p(o.value?"แก้ไขคำศัพท์":"เพิ่มคำศัพท์"),1),e("form",{onSubmit:se(R,["prevent"]),class:"space-y-6"},[e("div",Le,[t[11]||(t[11]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"คำศัพท์")],-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>l.value.word=n),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[P,l.value.word]])]),e("div",De,[e("label",Ee,[t[12]||(t[12]=e("span",{class:"label-text font-medium"},"ความหมาย",-1)),e("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!l.value.word||y.value,onClick:X},[y.value?(c(),F(u,{key:1,name:"svg-spinners:pulse-rings-3"})):(c(),F(u,{key:0,name:"material-symbols:magic-button"})),k(" "+p(y.value?"กำลังโหลด...":"ขอความหมายจาก AI"),1)],8,Te)]),C(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=n=>l.value.meaning=n),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[P,l.value.meaning]])]),e("div",je,[t[13]||(t[13]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"แท็ก (คั่นด้วย ,)")],-1)),C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=n=>l.value.tagsInput=n),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[P,l.value.tagsInput]])]),e("div",Se,[e("button",$e,[M(u,{name:"ri:save-3-line"}),t[14]||(t[14]=k(" บันทึก "))]),e("button",{type:"button",class:"btn",onClick:A},[M(u,{name:"bitcoin-icons:cross-filled"}),t[15]||(t[15]=k(" ยกเลิก "))])])],32)]),e("div",{class:"modal-backdrop",onClick:A})],2),e("div",{class:O(["modal",{"modal-open":x.value}])},[e("div",Ve,[t[18]||(t[18]=e("h3",{class:"text-lg font-bold mb-4"},"ยืนยันการลบ",-1)),e("p",null,'คุณต้องการลบคำศัพท์ "'+p((h=v.value)==null?void 0:h.word)+'" ใช่หรือไม่?',1),e("div",Be,[e("button",{class:"btn btn-error",onClick:W},[M(u,{name:"material-symbols:delete-outline"}),t[16]||(t[16]=k(" ยืนยัน "))]),e("button",{class:"btn",onClick:B},[M(u,{name:"bitcoin-icons:cross-filled"}),t[17]||(t[17]=k(" ยกเลิก "))])])]),e("div",{class:"modal-backdrop",onClick:B})],2)])}}});export{Ue as default};
