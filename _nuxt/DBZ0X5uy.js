import{f as q,z as G,r as m,g as J,h as W,c as v,a as o,i as Y,t as f,C as H,l as I,v as k,A as O,d as C,F as Q,j as R,b as D,o as u,n as X,k as Z}from"./DGKBXwsW.js";import{P as F}from"./BYoDscgR.js";function ee(){const b="app_settings",h=new F("flashcards");async function y(){try{const t=await h.get(b);if(!t.openaiApiKey||!t.customPrompt||!t.responseLanguage)throw new Error("การตั้งค่าไม่ถูกต้อง");return{openaiApiKey:t.openaiApiKey,customPrompt:t.customPrompt,responseLanguage:t.responseLanguage}}catch(t){throw console.error("Error loading settings:",t),new Error("ไม่พบการตั้งค่า API Key")}}async function _(t){try{const l=await y();if(!l.openaiApiKey)throw new Error("กรุณาตั้งค่า OpenAI API Key ก่อนใช้งาน");const r=l.customPrompt.replace("{word}",t),g=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.openaiApiKey}`},body:JSON.stringify({model:"gpt-4.1-nano",messages:[{role:"system",content:`You are a helpful assistant that provides word meanings and examples. Please respond in ${l.responseLanguage==="th"?"Thai":"English"} language.`},{role:"user",content:r}],temperature:.7})});if(!g.ok)throw new Error("เกิดข้อผิดพลาดในการเรียกใช้ API");return(await g.json()).choices[0].message.content.trim()}catch(l){throw console.error("Error getting meaning:",l),new Error(l.message||"เกิดข้อผิดพลาดในการขอความหมายจาก AI")}}return{getMeaning:_}}const te={class:"modal",id:"edit-modal"},ae={class:"modal-box relative max-w-2xl"},se={key:0,role:"alert",class:"alert alert-info shadow-lg mb-6"},ne={class:"text-xl font-bold mb-6"},oe={class:"form-control"},re={class:"form-control"},le={class:"label flex justify-between items-center"},ie=["disabled"],de={class:"form-control"},ce={class:"flex flex-wrap gap-2 mb-4"},ue=["onClick"],pe={class:"modal-action mt-2"},me={type:"submit",class:"btn btn-primary"},ve=q({__name:"addEdit",props:{card:{type:Object,default:()=>({})}},emits:["saveCard"],setup(b,{emit:h}){var S,B,M,T;const{getMeaning:y}=ee(),_=h,t=b;G(()=>t.card,a=>{var e,s,n,i;r.value.word=((e=t.card)==null?void 0:e.word)||"",r.value.meaning=((s=t.card)==null?void 0:s.meaning)||"",r.value.tagsInput=Array.isArray((n=t.card)==null?void 0:n.tags)?t.card.tags.join(", "):((i=t.card)==null?void 0:i.tags)||""});const l=new F("flashcards"),r=m({word:((S=t.card)==null?void 0:S.word)||"",meaning:((B=t.card)==null?void 0:B.meaning)||"",tagsInput:Array.isArray((M=t.card)==null?void 0:M.tags)?t.card.tags.join(", "):((T=t.card)==null?void 0:T.tags)||""});function g(a){const s=(r.value.tagsInput||"").split(",").map(i=>i.trim()).filter(Boolean),n=s.indexOf(a);n===-1?s.push(a):s.splice(n,1),r.value.tagsInput=s.join(", ")}const c=m(!1),A=m(!1),E=m(""),x=m([]),N=J(()=>{const a=new Set;return x.value.forEach(e=>{var s;(s=e.tags)==null||s.forEach(n=>a.add(n))}),Array.from(a)});async function P(){const e=(await l.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var n;return s.word&&!((n=s._id)!=null&&n.startsWith("_design"))});x.value=e.map(s=>{var n,i,p;return{...s,tags:s.tags||[],stats:{correct:((n=s.stats)==null?void 0:n.correct)||0,incorrect:((i=s.stats)==null?void 0:i.incorrect)||0,lastSeen:((p=s.stats)==null?void 0:p.lastSeen)||Date.now()}}})}async function z(){var j,K;const a=r.value.word.trim(),e=r.value.meaning.trim();if(!a||!e)return;if(x.value.find(d=>{var L,V;return((L=d==null?void 0:d.word)==null?void 0:L.toLowerCase())===(a==null?void 0:a.toLowerCase())&&d._id!==((V=t.card)==null?void 0:V._id)})){alert(`มีคำ "${a}" อยู่แล้วในรายการ`);return}console.log("cardForm",r.value);const n=r.value.tagsInput.split(",").map(d=>d.trim()).filter(Boolean),i=Date.now(),p={word:a,meaning:e,tags:n,createdAt:((j=t.card)==null?void 0:j.createdAt)||i,updatedAt:i};if((K=t.card)!=null&&K._id){const d=await l.get(t.card._id);await l.put({...p,_id:t.card._id,_rev:d._rev})}else await l.post(p);w(),P(),_("saveCard",!0)}async function $(){try{const a=await l.get("app_settings");if(!(a!=null&&a.openaiApiKey))throw new Error("OpenAI API Key is not set");if(!r.value.word||c.value)throw new Error("Please enter a word");c.value=!0,r.value.meaning=await y(r.value.word)}catch(a){U("เกิดข้อผิดพลาด : "+a),console.error(a);return}finally{c.value=!1}}function U(a){E.value=a,A.value=!0,setTimeout(()=>A.value=!1,5e3)}function w(){const a=document.getElementById("edit-modal");a==null||a.classList.remove("modal-open")}return W(()=>{P()}),(a,e)=>{const s=Z;return u(),v("div",te,[o("div",ae,[o("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:w},"✕"),A.value?(u(),v("div",se,[e[3]||(e[3]=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("span",null,f(E.value),1)])):Y("",!0),o("h3",ne,f(t.card?"แก้ไขคำศัพท์":"เพิ่มคำศัพท์"),1),o("form",{onSubmit:H(z,["prevent"]),class:"space-y-6"},[o("div",oe,[e[4]||(e[4]=o("label",{class:"label"},[o("span",{class:"label-text font-medium"},"คำศัพท์")],-1)),I(o("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>r.value.word=n),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[k,r.value.word]])]),o("div",re,[o("label",le,[e[5]||(e[5]=o("span",{class:"label-text font-medium"},"ความหมาย",-1)),o("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!r.value.word||c.value,onClick:$},[c.value?(u(),O(s,{key:1,name:"svg-spinners:pulse-rings-3"})):(u(),O(s,{key:0,name:"material-symbols:magic-button"})),C(" "+f(c.value?"กำลังโหลด...":"ขอความหมายจาก AI"),1)],8,ie)]),I(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=n=>r.value.meaning=n),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[k,r.value.meaning]])]),o("div",de,[e[6]||(e[6]=o("label",{class:"label"},[o("span",{class:"label-text font-medium"},"แท็ก (คั่นด้วย ,)")],-1)),I(o("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>r.value.tagsInput=n),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[k,r.value.tagsInput]])]),o("div",ce,[(u(!0),v(Q,null,R(N.value,n=>(u(),v("span",{key:n,class:X(["badge badge-lg cursor-pointer",{"badge-primary":r.value.tagsInput.includes(n)}]),onClick:i=>g(n)},f(n),11,ue))),128))]),o("div",pe,[o("button",me,[D(s,{name:"ri:save-3-line"}),e[7]||(e[7]=C(" บันทึก "))]),o("button",{type:"button",class:"btn",onClick:w},[D(s,{name:"bitcoin-icons:cross-filled"}),e[8]||(e[8]=C(" ยกเลิก "))])])],32)]),o("div",{class:"modal-backdrop",onClick:w})])}}});export{ve as _,ee as u};
