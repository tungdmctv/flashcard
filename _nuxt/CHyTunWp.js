import{f as rt,r as i,g as _,B as vt,h as mt,c as m,a as e,m as ft,i as M,b as p,d as R,F as D,k as V,C as J,t as c,D as Q,E,q as pt,l as X,w as gt,p as bt,e as _t,o as u,j as wt}from"./t3Mm4Yag.js";import{_ as xt}from"./D3wbODw1.js";import{P as ht}from"./BYoDscgR.js";import{p as yt}from"./C9ZjJIze.js";const kt={class:"text-lg"},St={class:"flex justify-end items-center mb-6"},Ct={class:"flex flex-wrap justify-end gap-4 items-center"},Mt={class:"dropdown dropdown-sm"},Rt={tabindex:"0",class:"btn m-1"},It={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},Tt={class:"label cursor-pointer justify-start gap-2"},jt=["value"],Lt={class:"label-text"},Nt={class:"w-full flex flex-col items-center justify-center"},$t={class:"stats shadow mb-2 w-full lg:w-1/2"},Ht={class:"stat"},Wt={class:"stat-value"},Bt={class:"stat"},Dt={class:"stat-value text-success"},Vt={class:"stat"},Et={class:"stat-value text-error"},Ot={class:"stat"},Ut={class:"stat-value"},Pt={class:"w-full flex justify-end items-center pb-4"},zt={class:"flex items-center gap-2 ml-4"},At=["disabled"],Ft=["disabled"],Gt={class:"card-body items-center text-center"},qt={class:"card-title text-6xl mb-4 py-6"},Kt=["innerHTML"],Jt={class:"flex gap-4"},Qt={class:"flex flex-wrap justify-start items-center gap-2 mt-2 text-gray-300"},Xt={key:1,class:"text-center py-12"},Yt={key:2,class:"text-center py-12"},Zt={key:3,class:"flex justify-center gap-2 my-4"},te={class:"dropdown"},ee=["value"],se={class:"modal"},ae={class:"modal-box relative"},le={class:"mb-2"},oe={class:"mb-2 text-success"},ne={class:"mb-4 text-error"},ie={class:"modal-box w-full"},ce={class:"w-2/3 mx-center stats stats-vertical shadow"},de={class:"stat"},ue={class:"stat-value"},re={class:"stat"},ve={class:"stat-value text-success"},me={class:"stat-desc"},fe={class:"stat"},pe={class:"stat-value text-error"},ge={class:"stat-desc"},be={class:"stat"},_e={class:"stat-value"},we={class:"modal-action"},Ce=rt({__name:"practice",setup(xe){const I=new ht("flashcards"),Y=i(yt.languages),T=i("th-TH"),Z=i({pronunciationLanguage:"th-TH"}),w=i([]),f=i(0),r=i(!1),g=i(!0),S=i([]),h=i(!1),b=i([]),y=i(0);i(!1),i("");const N=i(!1),$=i(void 0);i(!1),i(!1);const O=i({word:"",meaning:"",tagsInput:""}),v=i({}),j=_(()=>w.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.correct)||0)},0)),H=_(()=>w.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.incorrect)||0)},0)),W=_(()=>j.value+H.value),B=_(()=>{const a=W.value;return a>0?Math.round(j.value/a*100):0}),L=_(()=>{const a=Object.values(v.value);return{totalPlayed:a.reduce((t,s)=>t+s.played,0),totalCorrect:a.reduce((t,s)=>t+s.correct,0),totalIncorrect:a.reduce((t,s)=>t+s.incorrect,0),avgSuccessRate:a.length>0?Math.round(a.reduce((t,s)=>t+s.successRate,0)/a.length):0}}),tt=_(()=>{var a;return((a=d.value)==null?void 0:a.meaning.replace(/\n/g,"<br>"))||""}),et=_(()=>[...new Set(U.value.flatMap(a=>a.tags))]),k=_(()=>w.value.filter(a=>S.value.length===0||S.value.some(t=>a.tags.includes(t)))),d=_(()=>k.value[f.value]||null),U=i([]);async function st(){const t=(await I.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var o;return s.word&&!((o=s._id)!=null&&o.startsWith("_design"))});w.value=t.map(s=>{var o,n,l;return{...s,tags:s.tags||[],stats:{correct:((o=s.stats)==null?void 0:o.correct)||0,incorrect:((n=s.stats)==null?void 0:n.incorrect)||0,lastSeen:((l=s.stats)==null?void 0:l.lastSeen)||Date.now()}}}),U.value=[...w.value],g.value&&(console.log("shuffle loadCards"),C())}async function P(a){var l,x,G,q,K;if(!((l=d.value)!=null&&l._id))return;const t=await I.get(d.value._id),s={correct:((x=t.stats)==null?void 0:x.correct)||0,incorrect:((G=t.stats)==null?void 0:G.incorrect)||0,lastSeen:((q=t.stats)==null?void 0:q.lastSeen)||Date.now()},o=a?"correct":"incorrect";s[o]=(Number(s[o])||0)+1,s.lastSeen=Date.now(),await I.put({...t,stats:s}),d.value.stats&&(d.value.stats[a?"correct":"incorrect"]++,d.value.stats.lastSeen=s.lastSeen),d.value._id&&!b.value.includes(d.value._id)&&b.value.push(d.value._id);const n=((K=d.value)==null?void 0:K._id)||"";v.value[n]||(v.value[n]={played:0,correct:0,incorrect:0,successRate:0}),v.value[n].played++,a?v.value[n].correct++:v.value[n].incorrect++,v.value[n].successRate=v.value[n].played>0?Math.round(v.value[n].correct/v.value[n].played*100):0,r.value=!1,at()}function C(){f.value=0,r.value=!1;const a=[...k.value];for(let t=a.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[a[t],a[s]]=[a[s],a[t]]}w.value=[...a]}function at(){console.log("next card"),g.value?(console.log("next isRandomMode"),C(),Math.random()>.75&&(console.log("next getLowestSuccessRateWords"),z())):(console.log("next Not Random"),Math.random()>=.75&&(console.log("next Not Random : getLowestSuccessRateWords"),z())),f.value<k.value.length-1?f.value++:f.value=0,r.value=!1,y.value=-1}function z(a=1){const t=Object.entries(v.value).filter(([s,o])=>o.played>0&&o.successRate<80).sort((s,o)=>s[1].successRate-o[1].successRate).slice(0,a).map(([s,o])=>{var n;return{wordId:s,word:((n=w.value.find(l=>l._id===s))==null?void 0:n.word)||s,successRate:o.successRate}});if(t.length>0){const s=t[0],o=w.value.find(n=>n._id===s.wordId);if(o){const n=k.value.filter(l=>l._id!==s.wordId).toSpliced(f.value,0,o);k.value=[...n]}}return console.log("lowestWords",t),t}function lt(a){var l;if(typeof window>"u"||!window.speechSynthesis)return;const t=new SpeechSynthesisUtterance(((l=d.value)==null?void 0:l.word)||""),s={th:"th-TH",en:"en-US",zh:"zh-CN"};t.lang=s[a]??"en-US";const o=window.speechSynthesis.getVoices(),n=o.find(x=>x.lang===t.lang)||o.find(x=>x.lang.startsWith(t.lang.slice(0,2)));n&&(t.voice=n),window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}function ot(){g.value=!g.value,r.value=!1,g.value?C():f.value=0}function nt(){r.value||(r.value=!0)}function it(){h.value=!0}function A(){h.value=!1,r.value=!1,b.value=[],y.value=-1,g.value?C():f.value=0}function F(a){if(b.value.length===0)return;let t=y.value+a;if(t<0?t=b.value.length-1:t>=b.value.length&&(t=0),y.value=t,y.value>=0){const s=b.value[y.value],o=k.value.findIndex(n=>n._id===s);o>=0&&(f.value=o,r.value=!0)}}vt(S,()=>{f.value=0,r.value=!1,g.value&&C()});async function ct(){try{const a=await I.get("app_settings");Z.value={pronunciationLanguage:a.pronunciationLanguage||"th-TH"},T.value=a.pronunciationLanguage||"th-TH"}catch(a){console.error("Failed to load settings:",a)}}function dt(a){a?($.value=a,O.value={word:a.word,meaning:a.meaning,tagsInput:a.tags.join(", ")}):($.value=void 0,O.value={word:"",meaning:"",tagsInput:""}),setTimeout(()=>{ut("edit-modal")},40)}function ut(a=""){const t=document.getElementById(a);t==null||t.classList.add("modal-open")}return mt(()=>{st(),ct()}),(a,t)=>{const s=wt,o=_t,n=xt;return u(),m("div",kt,[e("div",St,[e("div",Ct,[e("div",Mt,[e("label",Rt,[p(s,{name:"material-symbols:label-important-rounded"}),t[11]||(t[11]=R(" Tags "))]),e("ul",It,[(u(!0),m(D,null,V(et.value,l=>(u(),m("li",{key:l},[e("label",Tt,[M(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=x=>S.value=x),value:l,class:"checkbox"},null,8,jt),[[X,S.value]]),e("span",Lt,c(l),1)])]))),128))])]),e("button",{class:"btn btn-sm",onClick:ot},[g.value?(u(),J(s,{key:0,name:"fe:random"})):(u(),J(s,{key:1,name:"lineicons:sort-amount-asc"})),R(" "+c(g.value?"Random":"A->B"),1)]),e("div",{onClick:t[1]||(t[1]=l=>N.value=!0)},[p(s,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto mb-1"})]),e("button",{class:"btn btn-error btn-xs",onClick:it},[p(s,{name:"ic:baseline-stop-circle"}),t[12]||(t[12]=R(" End "))])])]),e("div",Nt,[e("div",$t,[e("div",Ht,[t[13]||(t[13]=e("div",{class:"stat-title"},"เล่น",-1)),e("div",Wt,c(L.value.totalPlayed),1)]),e("div",Bt,[t[14]||(t[14]=e("div",{class:"stat-title"},"ถูก",-1)),e("div",Dt,c(L.value.totalCorrect),1)]),e("div",Vt,[t[15]||(t[15]=e("div",{class:"stat-title"},"ผิด",-1)),e("div",Et,c(L.value.totalIncorrect),1)]),e("div",Ot,[t[16]||(t[16]=e("div",{class:"stat-title"},"อัตราความสำเร็จ",-1)),e("div",Ut,c(L.value.avgSuccessRate)+"%",1)])])]),e("div",Pt,[e("div",zt,[e("button",{class:"btn btn-sm btn-outline",disabled:b.value.length===0,onClick:t[2]||(t[2]=l=>F(-1))},[p(s,{name:"material-symbols:arrow-back"})],8,At),e("button",{class:"btn btn-sm btn-outline",disabled:b.value.length===0,onClick:t[3]||(t[3]=l=>F(1))},[p(s,{name:"material-symbols:arrow-forward"})],8,Ft)])]),d.value&&!h.value?(u(),m("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:nt},[e("div",{onClick:t[4]||(t[4]=l=>dt(d.value)),class:"absolute top-2 right-2"},[p(s,{name:"material-symbols:edit-square-outline"})]),e("div",Gt,[e("h2",qt,c(d.value.word),1),M(e("p",{class:"text-xl mb-4",innerHTML:tt.value},null,8,Kt),[[Q,r.value]]),M(e("div",Jt,[e("button",{class:"btn btn-success",onClick:t[5]||(t[5]=E(l=>P(!0),["stop"]))},"OK"),e("button",{class:"btn btn-error",onClick:t[6]||(t[6]=E(l=>P(!1),["stop"]))},"Again")],512),[[Q,r.value]])]),e("div",Qt,[(u(!0),m(D,null,V(d.value.tags,l=>(u(),m("span",{key:l,class:"badge badge-sm"},c(l),1))),128))])])):h.value?(u(),m("div",Yt,t[18]||(t[18]=[e("p",null,"No cards available.",-1)]))):(u(),m("div",Xt,[t[17]||(t[17]=e("p",{class:"text-xl mb-4"},"No Words Selected",-1)),e("button",{class:"btn btn-primary",onClick:A},"Start")])),d.value&&!h.value?(u(),m("div",Zt,[e("div",te,[M(e("select",{"onUpdate:modelValue":t[7]||(t[7]=l=>T.value=l),class:"select select-bordered w-full"},[(u(!0),m(D,null,V(Y.value,l=>(u(),m("option",{key:l.code,value:l.code},c(l.name),9,ee))),128))],512),[[pt,T.value]])]),e("button",{class:"btn",onClick:t[8]||(t[8]=E(l=>lt(T.value),["stop"]))},[p(s,{name:"material-symbols:volume-up"}),t[19]||(t[19]=R(" อ่านออกเสียง "))])])):ft("",!0),M(e("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":t[9]||(t[9]=l=>h.value=l)},null,512),[[X,h.value]]),e("div",se,[e("div",ae,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold mb-4"},"จบเกมแล้ว 🎉",-1)),e("p",le,"คำที่ทายไปทั้งหมด: "+c(W.value),1),e("p",oe,"จำนวนคำที่ถูกต้อง: "+c(j.value),1),e("p",ne,"จำนวนคำที่ผิดพลาด: "+c(H.value),1),e("div",{class:"modal-action"},[e("button",{class:"btn btn-primary",onClick:A},"เล่นใหม่")])])]),e("dialog",{id:"stats_modal",class:bt(["modal",{"modal-open":N.value}])},[e("div",ie,[t[27]||(t[27]=e("h3",{class:"w-full flex justify-center items-center font-bold text-lg mb-4"},"Overall Statistics",-1)),e("div",ce,[e("div",de,[t[21]||(t[21]=e("div",{class:"stat-title"},"Total Plays",-1)),e("div",ue,c(W.value),1)]),e("div",re,[t[22]||(t[22]=e("div",{class:"stat-title"},"Correct",-1)),e("div",ve,c(j.value),1),e("div",me,c(B.value)+"% ",1)]),e("div",fe,[t[23]||(t[23]=e("div",{class:"stat-title"},"Incorrect",-1)),e("div",pe,c(H.value),1),e("div",ge,c(100-B.value)+"%",1)]),e("div",be,[t[24]||(t[24]=e("div",{class:"stat-title"},"Success Rate",-1)),e("div",_e,c(B.value)+"%",1),t[25]||(t[25]=e("div",{class:"stat-desc"},"Overall success rate",-1))])]),e("div",we,[p(o,{to:"/stat",class:"btn btn-secondary"},{default:gt(()=>[p(s,{name:"material-symbols:bar-chart-4-bars"}),t[26]||(t[26]=R(" Stats "))]),_:1,__:[26]}),e("button",{class:"btn",onClick:t[10]||(t[10]=l=>N.value=!1)},"Close")])])],2),p(n,{id:"edit-modal",card:$.value},null,8,["card"])])}}});export{Ce as default};
