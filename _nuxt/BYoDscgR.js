function Ft(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ft={exports:{}},an;function Sr(){return an||(an=1,function(e,t){(function(n){e.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(h,d){var u=h[0],a=h[1],c=h[2],f=h[3];u+=(a&c|~a&f)+d[0]-680876936|0,u=(u<<7|u>>>25)+a|0,f+=(u&a|~u&c)+d[1]-389564586|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&a)+d[2]+606105819|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&u)+d[3]-1044525330|0,a=(a<<22|a>>>10)+c|0,u+=(a&c|~a&f)+d[4]-176418897|0,u=(u<<7|u>>>25)+a|0,f+=(u&a|~u&c)+d[5]+1200080426|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&a)+d[6]-1473231341|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&u)+d[7]-45705983|0,a=(a<<22|a>>>10)+c|0,u+=(a&c|~a&f)+d[8]+1770035416|0,u=(u<<7|u>>>25)+a|0,f+=(u&a|~u&c)+d[9]-1958414417|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&a)+d[10]-42063|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&u)+d[11]-1990404162|0,a=(a<<22|a>>>10)+c|0,u+=(a&c|~a&f)+d[12]+1804603682|0,u=(u<<7|u>>>25)+a|0,f+=(u&a|~u&c)+d[13]-40341101|0,f=(f<<12|f>>>20)+u|0,c+=(f&u|~f&a)+d[14]-1502002290|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&u)+d[15]+1236535329|0,a=(a<<22|a>>>10)+c|0,u+=(a&f|c&~f)+d[1]-165796510|0,u=(u<<5|u>>>27)+a|0,f+=(u&c|a&~c)+d[6]-1069501632|0,f=(f<<9|f>>>23)+u|0,c+=(f&a|u&~a)+d[11]+643717713|0,c=(c<<14|c>>>18)+f|0,a+=(c&u|f&~u)+d[0]-373897302|0,a=(a<<20|a>>>12)+c|0,u+=(a&f|c&~f)+d[5]-701558691|0,u=(u<<5|u>>>27)+a|0,f+=(u&c|a&~c)+d[10]+38016083|0,f=(f<<9|f>>>23)+u|0,c+=(f&a|u&~a)+d[15]-660478335|0,c=(c<<14|c>>>18)+f|0,a+=(c&u|f&~u)+d[4]-405537848|0,a=(a<<20|a>>>12)+c|0,u+=(a&f|c&~f)+d[9]+568446438|0,u=(u<<5|u>>>27)+a|0,f+=(u&c|a&~c)+d[14]-1019803690|0,f=(f<<9|f>>>23)+u|0,c+=(f&a|u&~a)+d[3]-187363961|0,c=(c<<14|c>>>18)+f|0,a+=(c&u|f&~u)+d[8]+1163531501|0,a=(a<<20|a>>>12)+c|0,u+=(a&f|c&~f)+d[13]-1444681467|0,u=(u<<5|u>>>27)+a|0,f+=(u&c|a&~c)+d[2]-51403784|0,f=(f<<9|f>>>23)+u|0,c+=(f&a|u&~a)+d[7]+1735328473|0,c=(c<<14|c>>>18)+f|0,a+=(c&u|f&~u)+d[12]-1926607734|0,a=(a<<20|a>>>12)+c|0,u+=(a^c^f)+d[5]-378558|0,u=(u<<4|u>>>28)+a|0,f+=(u^a^c)+d[8]-2022574463|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^a)+d[11]+1839030562|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^u)+d[14]-35309556|0,a=(a<<23|a>>>9)+c|0,u+=(a^c^f)+d[1]-1530992060|0,u=(u<<4|u>>>28)+a|0,f+=(u^a^c)+d[4]+1272893353|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^a)+d[7]-155497632|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^u)+d[10]-1094730640|0,a=(a<<23|a>>>9)+c|0,u+=(a^c^f)+d[13]+681279174|0,u=(u<<4|u>>>28)+a|0,f+=(u^a^c)+d[0]-358537222|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^a)+d[3]-722521979|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^u)+d[6]+76029189|0,a=(a<<23|a>>>9)+c|0,u+=(a^c^f)+d[9]-640364487|0,u=(u<<4|u>>>28)+a|0,f+=(u^a^c)+d[12]-421815835|0,f=(f<<11|f>>>21)+u|0,c+=(f^u^a)+d[15]+530742520|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^u)+d[2]-995338651|0,a=(a<<23|a>>>9)+c|0,u+=(c^(a|~f))+d[0]-198630844|0,u=(u<<6|u>>>26)+a|0,f+=(a^(u|~c))+d[7]+1126891415|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~a))+d[14]-1416354905|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~u))+d[5]-57434055|0,a=(a<<21|a>>>11)+c|0,u+=(c^(a|~f))+d[12]+1700485571|0,u=(u<<6|u>>>26)+a|0,f+=(a^(u|~c))+d[3]-1894986606|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~a))+d[10]-1051523|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~u))+d[1]-2054922799|0,a=(a<<21|a>>>11)+c|0,u+=(c^(a|~f))+d[8]+1873313359|0,u=(u<<6|u>>>26)+a|0,f+=(a^(u|~c))+d[15]-30611744|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~a))+d[6]-1560198380|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~u))+d[13]+1309151649|0,a=(a<<21|a>>>11)+c|0,u+=(c^(a|~f))+d[4]-145523070|0,u=(u<<6|u>>>26)+a|0,f+=(a^(u|~c))+d[11]-1120210379|0,f=(f<<10|f>>>22)+u|0,c+=(u^(f|~a))+d[2]+718787259|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~u))+d[9]-343485551|0,a=(a<<21|a>>>11)+c|0,h[0]=u+h[0]|0,h[1]=a+h[1]|0,h[2]=c+h[2]|0,h[3]=f+h[3]|0}function s(h){var d=[],u;for(u=0;u<64;u+=4)d[u>>2]=h.charCodeAt(u)+(h.charCodeAt(u+1)<<8)+(h.charCodeAt(u+2)<<16)+(h.charCodeAt(u+3)<<24);return d}function o(h){var d=[],u;for(u=0;u<64;u+=4)d[u>>2]=h[u]+(h[u+1]<<8)+(h[u+2]<<16)+(h[u+3]<<24);return d}function v(h){var d=h.length,u=[1732584193,-271733879,-1732584194,271733878],a,c,f,q,O,E;for(a=64;a<=d;a+=64)i(u,s(h.substring(a-64,a)));for(h=h.substring(a-64),c=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)f[a>>2]|=h.charCodeAt(a)<<(a%4<<3);if(f[a>>2]|=128<<(a%4<<3),a>55)for(i(u,f),a=0;a<16;a+=1)f[a]=0;return q=d*8,q=q.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(q[2],16),E=parseInt(q[1],16)||0,f[14]=O,f[15]=E,i(u,f),u}function _(h){var d=h.length,u=[1732584193,-271733879,-1732584194,271733878],a,c,f,q,O,E;for(a=64;a<=d;a+=64)i(u,o(h.subarray(a-64,a)));for(h=a-64<d?h.subarray(a-64):new Uint8Array(0),c=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)f[a>>2]|=h[a]<<(a%4<<3);if(f[a>>2]|=128<<(a%4<<3),a>55)for(i(u,f),a=0;a<16;a+=1)f[a]=0;return q=d*8,q=q.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(q[2],16),E=parseInt(q[1],16)||0,f[14]=O,f[15]=E,i(u,f),u}function y(h){var d="",u;for(u=0;u<4;u+=1)d+=r[h>>u*8+4&15]+r[h>>u*8&15];return d}function w(h){var d;for(d=0;d<h.length;d+=1)h[d]=y(h[d]);return h.join("")}w(v("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function h(d,u){return d=d|0||0,d<0?Math.max(d+u,0):Math.min(d,u)}ArrayBuffer.prototype.slice=function(d,u){var a=this.byteLength,c=h(d,a),f=a,q,O,E,P;return u!==n&&(f=h(u,a)),c>f?new ArrayBuffer(0):(q=f-c,O=new ArrayBuffer(q),E=new Uint8Array(O),P=new Uint8Array(this,c,q),E.set(P),O)}}();function l(h){return/[\u0080-\uFFFF]/.test(h)&&(h=unescape(encodeURIComponent(h))),h}function g(h,d){var u=h.length,a=new ArrayBuffer(u),c=new Uint8Array(a),f;for(f=0;f<u;f+=1)c[f]=h.charCodeAt(f);return d?c:a}function m(h){return String.fromCharCode.apply(null,new Uint8Array(h))}function S(h,d,u){var a=new Uint8Array(h.byteLength+d.byteLength);return a.set(new Uint8Array(h)),a.set(new Uint8Array(d),h.byteLength),a}function C(h){var d=[],u=h.length,a;for(a=0;a<u-1;a+=2)d.push(parseInt(h.substr(a,2),16));return String.fromCharCode.apply(String,d)}function p(){this.reset()}return p.prototype.append=function(h){return this.appendBinary(l(h)),this},p.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var d=this._buff.length,u;for(u=64;u<=d;u+=64)i(this._hash,s(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},p.prototype.end=function(h){var d=this._buff,u=d.length,a,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f;for(a=0;a<u;a+=1)c[a>>2]|=d.charCodeAt(a)<<(a%4<<3);return this._finish(c,u),f=w(this._hash),h&&(f=C(f)),this.reset(),f},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(h){return this._buff=h.buff,this._length=h.length,this._hash=h.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(h,d){var u=d,a,c,f;if(h[u>>2]|=128<<(u%4<<3),u>55)for(i(this._hash,h),u=0;u<16;u+=1)h[u]=0;a=this._length*8,a=a.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(a[2],16),f=parseInt(a[1],16)||0,h[14]=c,h[15]=f,i(this._hash,h)},p.hash=function(h,d){return p.hashBinary(l(h),d)},p.hashBinary=function(h,d){var u=v(h),a=w(u);return d?C(a):a},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(h){var d=S(this._buff.buffer,h),u=d.length,a;for(this._length+=h.byteLength,a=64;a<=u;a+=64)i(this._hash,o(d.subarray(a-64,a)));return this._buff=a-64<u?new Uint8Array(d.buffer.slice(a-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(h){var d=this._buff,u=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c,f;for(c=0;c<u;c+=1)a[c>>2]|=d[c]<<(c%4<<3);return this._finish(a,u),f=w(this._hash),h&&(f=C(f)),this.reset(),f},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var h=p.prototype.getState.call(this);return h.buff=m(h.buff),h},p.ArrayBuffer.prototype.setState=function(h){return h.buff=g(h.buff,!0),p.prototype.setState.call(this,h)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(h,d){var u=_(new Uint8Array(h)),a=w(u);return d?C(a):a},p})}(ft)),ft.exports}var Ar=Sr();const Ct=Ft(Ar);var Qe,qr=new Uint8Array(16);function Cr(){if(!Qe&&(Qe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Qe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qe(qr)}const Or=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function xr(e){return typeof e=="string"&&Or.test(e)}var ue=[];for(var lt=0;lt<256;++lt)ue.push((lt+256).toString(16).substr(1));function Er(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(ue[e[t+0]]+ue[e[t+1]]+ue[e[t+2]]+ue[e[t+3]]+"-"+ue[e[t+4]]+ue[e[t+5]]+"-"+ue[e[t+6]]+ue[e[t+7]]+"-"+ue[e[t+8]]+ue[e[t+9]]+"-"+ue[e[t+10]]+ue[e[t+11]]+ue[e[t+12]]+ue[e[t+13]]+ue[e[t+14]]+ue[e[t+15]]).toLowerCase();if(!xr(n))throw TypeError("Stringified UUID is invalid");return n}function Gt(e,t,n){e=e||{};var r=e.random||(e.rng||Cr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Er(r)}var We={},on;function kr(){if(on)return We;on=1,We.stringify=function(n){var r=[];r.push({obj:n});for(var i="",s,o,v,_,y,w,l,g,m,S,C;s=r.pop();)if(o=s.obj,v=s.prefix||"",_=s.val||"",i+=v,_)i+=_;else if(typeof o!="object")i+=typeof o>"u"?null:JSON.stringify(o);else if(o===null)i+="null";else if(Array.isArray(o)){for(r.push({val:"]"}),y=o.length-1;y>=0;y--)w=y===0?"":",",r.push({obj:o[y],prefix:w});r.push({val:"["})}else{l=[];for(g in o)o.hasOwnProperty(g)&&l.push(g);for(r.push({val:"}"}),y=l.length-1;y>=0;y--)m=l[y],S=o[m],C=y>0?",":"",C+=JSON.stringify(m)+":",r.push({obj:S,prefix:C});r.push({val:"{"})}return i};function e(t,n,r){var i=r[r.length-1];t===i.element&&(r.pop(),i=r[r.length-1]);var s=i.element,o=i.index;if(Array.isArray(s))s.push(t);else if(o===n.length-2){var v=n.pop();s[v]=t}else n.push(t)}return We.parse=function(t){for(var n=[],r=[],i=0,s,o,v,_,y,w,l,g,m;;){if(s=t[i++],s==="}"||s==="]"||typeof s>"u"){if(n.length===1)return n.pop();e(n.pop(),n,r);continue}switch(s){case" ":case"	":case`
`:case":":case",":break;case"n":i+=3,e(null,n,r);break;case"t":i+=3,e(!0,n,r);break;case"f":i+=4,e(!1,n,r);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(o="",i--;;)if(v=t[i++],/[\d\.\-e\+]/.test(v))o+=v;else{i--;break}e(parseFloat(o),n,r);break;case'"':for(_="",y=void 0,w=0;l=t[i++],l!=='"'||y==="\\"&&w%2===1;)_+=l,y=l,y==="\\"?w++:w=0;e(JSON.parse('"'+_+'"'),n,r);break;case"[":g={element:[],index:n.length},n.push(g.element),r.push(g);break;case"{":m={element:{},index:n.length},n.push(m.element),r.push(m);break;default:throw new Error("unexpectedly reached end of input: "+s)}}},We}var Dr=kr();const $n=Ft(Dr);var He={exports:{}},un;function Tr(){if(un)return He.exports;un=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(c,f,q){return Function.prototype.apply.call(c,f,q)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(c){return Object.getOwnPropertyNames(c).concat(Object.getOwnPropertySymbols(c))}:n=function(c){return Object.getOwnPropertyNames(c)};function r(a){console&&console.warn&&console.warn(a)}var i=Number.isNaN||function(c){return c!==c};function s(){s.init.call(this)}He.exports=s,He.exports.once=h,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function v(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(a){if(typeof a!="number"||a<0||i(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");o=a}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(c){if(typeof c!="number"||c<0||i(c))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+c+".");return this._maxListeners=c,this};function _(a){return a._maxListeners===void 0?s.defaultMaxListeners:a._maxListeners}s.prototype.getMaxListeners=function(){return _(this)},s.prototype.emit=function(c){for(var f=[],q=1;q<arguments.length;q++)f.push(arguments[q]);var O=c==="error",E=this._events;if(E!==void 0)O=O&&E.error===void 0;else if(!O)return!1;if(O){var P;if(f.length>0&&(P=f[0]),P instanceof Error)throw P;var B=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw B.context=P,B}var U=E[c];if(U===void 0)return!1;if(typeof U=="function")t(U,this,f);else for(var j=U.length,N=S(U,j),q=0;q<j;++q)t(N[q],this,f);return!0};function y(a,c,f,q){var O,E,P;if(v(f),E=a._events,E===void 0?(E=a._events=Object.create(null),a._eventsCount=0):(E.newListener!==void 0&&(a.emit("newListener",c,f.listener?f.listener:f),E=a._events),P=E[c]),P===void 0)P=E[c]=f,++a._eventsCount;else if(typeof P=="function"?P=E[c]=q?[f,P]:[P,f]:q?P.unshift(f):P.push(f),O=_(a),O>0&&P.length>O&&!P.warned){P.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=a,B.type=c,B.count=P.length,r(B)}return a}s.prototype.addListener=function(c,f){return y(this,c,f,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(c,f){return y(this,c,f,!0)};function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(a,c,f){var q={fired:!1,wrapFn:void 0,target:a,type:c,listener:f},O=w.bind(q);return O.listener=f,q.wrapFn=O,O}s.prototype.once=function(c,f){return v(f),this.on(c,l(this,c,f)),this},s.prototype.prependOnceListener=function(c,f){return v(f),this.prependListener(c,l(this,c,f)),this},s.prototype.removeListener=function(c,f){var q,O,E,P,B;if(v(f),O=this._events,O===void 0)return this;if(q=O[c],q===void 0)return this;if(q===f||q.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete O[c],O.removeListener&&this.emit("removeListener",c,q.listener||f));else if(typeof q!="function"){for(E=-1,P=q.length-1;P>=0;P--)if(q[P]===f||q[P].listener===f){B=q[P].listener,E=P;break}if(E<0)return this;E===0?q.shift():C(q,E),q.length===1&&(O[c]=q[0]),O.removeListener!==void 0&&this.emit("removeListener",c,B||f)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(c){var f,q,O;if(q=this._events,q===void 0)return this;if(q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):q[c]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete q[c]),this;if(arguments.length===0){var E=Object.keys(q),P;for(O=0;O<E.length;++O)P=E[O],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=q[c],typeof f=="function")this.removeListener(c,f);else if(f!==void 0)for(O=f.length-1;O>=0;O--)this.removeListener(c,f[O]);return this};function g(a,c,f){var q=a._events;if(q===void 0)return[];var O=q[c];return O===void 0?[]:typeof O=="function"?f?[O.listener||O]:[O]:f?p(O):S(O,O.length)}s.prototype.listeners=function(c){return g(this,c,!0)},s.prototype.rawListeners=function(c){return g(this,c,!1)},s.listenerCount=function(a,c){return typeof a.listenerCount=="function"?a.listenerCount(c):m.call(a,c)},s.prototype.listenerCount=m;function m(a){var c=this._events;if(c!==void 0){var f=c[a];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function S(a,c){for(var f=new Array(c),q=0;q<c;++q)f[q]=a[q];return f}function C(a,c){for(;c+1<a.length;c++)a[c]=a[c+1];a.pop()}function p(a){for(var c=new Array(a.length),f=0;f<c.length;++f)c[f]=a[f].listener||a[f];return c}function h(a,c){return new Promise(function(f,q){function O(P){a.removeListener(c,E),q(P)}function E(){typeof a.removeListener=="function"&&a.removeListener("error",O),f([].slice.call(arguments))}u(a,c,E,{once:!0}),c!=="error"&&d(a,O,{once:!0})})}function d(a,c,f){typeof a.on=="function"&&u(a,"error",c,f)}function u(a,c,f,q){if(typeof a.on=="function")q.once?a.once(c,f):a.on(c,f);else if(typeof a.addEventListener=="function")a.addEventListener(c,function O(E){q.once&&a.removeEventListener(c,O),f(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}return He.exports}var Pr=Tr();const Oe=Ft(Pr);function Rr(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function Lr(e){return e instanceof ArrayBuffer?e.slice(0):e.slice(0,e.size,e.type)}var Nn=Function.prototype.toString,Br=Nn.call(Object);function Ir(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&Nn.call(n)==Br}function ae(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=ae(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(Rr(e))return Lr(e);if(!Ir(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=ae(e[n]);typeof i<"u"&&(t[n]=i)}return t}function Kn(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function Mn(e){return function(...t){t=ae(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(s,o){var v;try{var _=Kn(function(y,w){y?o(y):s(w)});t.push(_),v=e.apply(n,t),v&&typeof v.then=="function"&&s(v)}catch(y){o(y)}});return r&&i.then(function(s){r(null,s)},r),i}}function jr(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(o,v){var _=["api",e.name,t];_=_.concat(o?["error",o]:["success",v]),e.constructor.emit("debug",_),s(o,v)}}}function te(e,t){return Mn(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return jr(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,s){r.taskqueue.addTask(function(o){o?s(o):i(r[e].apply(r,n))})})})}function Je(e,t){for(var n={},r=0,i=t.length;r<i;r++){var s=t[r];s in e&&(n[s]=e[s])}return n}var $r=6;function cn(e){return e}function Nr(e){return[{ok:e}]}function Un(e,t,n){var r=t.docs,i=new Map;r.forEach(function(C){i.has(C.id)?i.get(C.id).push(C):i.set(C.id,[C])});var s=i.size,o=0,v=new Array(s);function _(){var C=[];v.forEach(function(p){p.docs.forEach(function(h){C.push({id:p.id,docs:[h]})})}),n(null,{results:C})}function y(){++o===s&&_()}function w(C,p,h){v[C]={id:p,docs:h},y()}var l=[];i.forEach(function(C,p){l.push(p)});var g=0;function m(){if(!(g>=l.length)){var C=Math.min(g+$r,l.length),p=l.slice(g,C);S(p,g),g+=p.length}}function S(C,p){C.forEach(function(h,d){var u=p+d,a=i.get(h),c=Je(a[0],["atts_since","attachments"]);c.open_revs=a.map(function(q){return q.rev}),c.open_revs=c.open_revs.filter(cn);var f=cn;c.open_revs.length===0&&(delete c.open_revs,f=Nr),["revs","attachments","binary","ajax","latest"].forEach(function(q){q in t&&(c[q]=t[q])}),e.get(h,c,function(q,O){var E;q?E=[{error:q}]:E=f(O),w(u,h,E),m()})})}m()}var Ot;try{localStorage.setItem("_pouch_check_localstorage",1),Ot=!!localStorage.getItem("_pouch_check_localstorage")}catch{Ot=!1}function et(){return Ot}const qe=typeof queueMicrotask=="function"?queueMicrotask:function(t){Promise.resolve().then(t)};class Kr extends Oe{constructor(){super(),this._listeners={},et()&&addEventListener("storage",t=>{this.emit(t.key)})}addListener(t,n,r,i){if(this._listeners[n])return;var s=!1,o=this;function v(){if(!o._listeners[n])return;if(s){s="waiting";return}s=!0;var _=Je(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function y(){s=!1}r.changes(_).on("change",function(w){w.seq>i.since&&!i.cancelled&&(i.since=w.seq,i.onChange(w))}).on("complete",function(){s==="waiting"&&qe(v),s=!1}).on("error",y)}this._listeners[n]=v,this.on(t,v)}removeListener(t,n){n in this._listeners&&(super.removeListener(t,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(t){et()&&(localStorage[t]=localStorage[t]==="a"?"b":"a")}notify(t){this.emit(t),this.notifyLocalWindows(t)}}function _e(e){if(typeof console<"u"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function Mr(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function Ur(e){var t=0;return e||(t=2e3),Mr(e,t)}function xt(e,t){_e("info","The above "+e+" is totally normal. "+t)}class V extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new V(401,"unauthorized","Name or password is incorrect.");var Fr=new V(400,"bad_request","Missing JSON list of 'docs'"),he=new V(404,"not_found","missing"),Ne=new V(409,"conflict","Document update conflict"),Fn=new V(400,"bad_request","_id field must contain a string"),Gr=new V(412,"missing_id","_id is required for puts"),Jr=new V(400,"bad_request","Only reserved document ids may start with underscore.");new V(412,"precondition_failed","Database not open");var Jt=new V(500,"unknown_error","Database encountered an unknown error"),Gn=new V(500,"badarg","Some query argument is invalid");new V(400,"invalid_request","Request was invalid");var zr=new V(400,"query_parse_error","Some query parameter is invalid"),fn=new V(500,"doc_validation","Bad special document member"),st=new V(400,"bad_request","Something wrong with the request"),dt=new V(400,"bad_request","Document must be a JSON object");new V(404,"not_found","Database not found");var zt=new V(500,"indexed_db_went_bad","unknown");new V(500,"web_sql_went_bad","unknown");new V(500,"levelDB_went_went_bad","unknown");new V(403,"forbidden","Forbidden by design doc validate_doc_update function");var Ze=new V(400,"bad_request","Invalid rev format");new V(412,"file_exists","The database could not be created, the file already exists.");var Qr=new V(412,"missing_stub","A pre-existing attachment stub wasn't found");new V(413,"invalid_url","Provided URL is invalid");function G(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),s=0,o=i.length;s<o;s++)typeof e[i[s]]!="function"&&(this[i[s]]=e[i[s]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=V.prototype,new n(t)}function Ke(e){if(typeof e!="object"){var t=e;e=Jt,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}function Wr(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return G(st,r)}}function Qt(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var s=n&&Wr(e.filter,i.doc,t);if(typeof s=="object")return s;if(s)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var o in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,o)&&(i.doc._attachments[o].stub=!0);return!0}}function Jn(e){var t;if(e?typeof e!="string"?t=G(Fn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=G(Jr)):t=G(Gr),t)throw t}function Ae(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(_e("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function Hr(e,t){return"listenerCount"in e?e.listenerCount(t):Oe.listenerCount(e,t)}function Et(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function ln(e){var t=Et(e);return t?t.join("/"):null}var dn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],hn="queryKey",Xr=/(?:^|&)([^&=]*)=?([^&]*)/g,Yr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function zn(e){for(var t=Yr.exec(e),n={},r=14;r--;){var i=dn[r],s=t[r]||"",o=["user","password"].indexOf(i)!==-1;n[i]=o?decodeURIComponent(s):s}return n[hn]={},n[dn[12]].replace(Xr,function(v,_,y){_&&(n[hn][_]=y)}),n}function Wt(e,t){var n=[],r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function tt(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,s=n(r);return s?(s._id=t,s._rev=i,Zr(e,s,n)):{updated:!1,rev:i}})}function Zr(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return tt(e,t._id,n)})}var Ht=function(e){return atob(e)},ze=function(e){return btoa(e)};function Xt(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if(s.name!=="TypeError")throw s;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function Vr(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Yt(e,t){return Xt([Vr(e)],{type:t})}function Zt(e,t){return Yt(Ht(e),t)}function ei(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Qn(e,t){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var s=i.target.result||"";if(r)return t(s);t(ei(s))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function Wn(e,t){Qn(e,function(n){t(n)})}function Vt(e,t){Wn(e,function(n){t(ze(n))})}function ti(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var ni=self.setImmediate||self.setTimeout,ri=32768;function ii(e){return ze(e)}function si(e,t,n,r,i){(n>0||r<t.size)&&(t=t.slice(n,r)),ti(t,function(s){e.append(s),i()})}function ai(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function en(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(ri,r),s=Math.ceil(r/i),o=0,v=n?new Ct:new Ct.ArrayBuffer,_=n?ai:si;function y(){ni(l)}function w(){var g=v.end(!0),m=ii(g);t(m),v.destroy()}function l(){var g=o*i,m=g+i;o++,o<s?_(v,e,g,m,y):_(v,e,g,m,w)}l()}function Hn(e){return Ct.hash(e)}function Xn(e,t){if(!t)return Gt().replace(/-/g,"").toLowerCase();var n=Object.assign({},e);return delete n._rev_tree,Hn(JSON.stringify(n))}var at=Gt;function Re(e){for(var t,n,r,i=e.rev_tree.slice(),s;s=i.pop();){var o=s.ids,v=o[2],_=s.pos;if(v.length){for(var y=0,w=v.length;y<w;y++)i.push({pos:_+1,ids:v[y]});continue}var l=!!o[1].deleted,g=o[0];(!t||(r!==l?r:n!==_?n<_:t<g))&&(t=g,n=_,r=l)}return n+"-"+t}function Le(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,s=r.ids,o=s[2],v=t(o.length===0,i,s[0],r.ctx,s[1]),_=0,y=o.length;_<y;_++)n.push({pos:i+1,ids:o[_],ctx:v})}function oi(e,t){return e.pos-t.pos}function tn(e){var t=[];Le(e,function(i,s,o,v,_){i&&t.push({rev:s+"-"+o,pos:s,opts:_})}),t.sort(oi).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function nn(e){for(var t=Re(e),n=tn(e.rev_tree),r=[],i=0,s=n.length;i<s;i++){var o=n[i];o.rev!==t&&!o.opts.deleted&&r.push(o.rev)}return r}function ui(e){var t=[];return Le(e.rev_tree,function(n,r,i,s,o){o.status==="available"&&!n&&(t.push(r+"-"+i),o.status="missing")}),t}function ci(e,t){let n=[];const r=e.slice();let i;for(;i=r.pop();){const{pos:s,ids:o}=i,v=`${s}-${o[0]}`,_=o[2];if(n.push(v),v===t){if(_.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(_.length===0||_.length>1)&&(n=[]);for(let y=0,w=_.length;y<w;y++)r.push({pos:s+1,ids:_[y]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function Yn(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,o=s[0],v=s[1],_=s[2],y=_.length===0,w=r.history?r.history.slice():[];w.push({id:o,opts:v}),y&&t.push({pos:i+1-w.length,ids:w});for(var l=0,g=_.length;l<g;l++)n.push({pos:i+1,ids:_[l],history:w})}return t.reverse()}function fi(e,t){return e.pos-t.pos}function li(e,t,n){for(var r=0,i=e.length,s;r<i;)s=r+i>>>1,n(e[s],t)<0?r=s+1:i=s;return r}function di(e,t,n){var r=li(e,t,n);e.splice(r,0,t)}function vn(e,t){for(var n,r,i=t,s=e.length;i<s;i++){var o=e[i],v=[o.id,o.opts,[]];r?(r[2].push(v),r=v):n=r=v}return n}function hi(e,t){return e[0]<t[0]?-1:1}function _n(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,o=i.tree2;(s[1].status||o[1].status)&&(s[1].status=s[1].status==="available"||o[1].status==="available"?"available":"missing");for(var v=0;v<o[2].length;v++){if(!s[2][0]){r="new_leaf",s[2][0]=o[2][v];continue}for(var _=!1,y=0;y<s[2].length;y++)s[2][y][0]===o[2][v][0]&&(n.push({tree1:s[2][y],tree2:o[2][v]}),_=!0);_||(r="new_branch",di(s[2],o[2][v],hi))}}return{conflicts:r,tree:e}}function Zn(e,t,n){var r=[],i=!1,s=!1,o;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var v=0,_=e.length;v<_;v++){var y=e[v];if(y.pos===t.pos&&y.ids[0]===t.ids[0])o=_n(y.ids,t.ids),r.push({pos:y.pos,ids:o.tree}),i=i||o.conflicts,s=!0;else if(n!==!0){var w=y.pos<t.pos?y:t,l=y.pos<t.pos?t:y,g=l.pos-w.pos,m=[],S=[];for(S.push({ids:w.ids,diff:g,parent:null,parentIdx:null});S.length>0;){var C=S.pop();if(C.diff===0){C.ids[0]===l.ids[0]&&m.push(C);continue}for(var p=C.ids[2],h=0,d=p.length;h<d;h++)S.push({ids:p[h],diff:C.diff-1,parent:C.ids,parentIdx:h})}var u=m[0];u?(o=_n(u.ids,l.ids),u.parent[2][u.parentIdx]=o.tree,r.push({pos:w.pos,ids:w.ids}),i=i||o.conflicts,s=!0):r.push(y)}else r.push(y)}return s||r.push(t),r.sort(fi),{tree:r,conflicts:i||"internal_node"}}function vi(e,t){for(var n=Yn(e),r,i,s=0,o=n.length;s<o;s++){var v=n[s],_=v.ids,y;if(_.length>t){r||(r={});var w=_.length-t;y={pos:v.pos+w,ids:vn(_,w)};for(var l=0;l<w;l++){var g=v.pos+l+"-"+_[l].id;r[g]=!0}}else y={pos:v.pos,ids:vn(_,0)};i?i=Zn(i,y,!0).tree:i=[y]}return r&&Le(i,function(m,S,C){delete r[S+"-"+C]}),{tree:i,revs:r?Object.keys(r):[]}}function Vn(e,t,n){var r=Zn(e,t),i=vi(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function _i(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),s=r[1],o;o=n.pop();){if(o.pos===i&&o.ids[0]===s)return!0;for(var v=o.ids[2],_=0,y=v.length;_<y;_++)n.push({pos:o.pos+1,ids:v[_]})}return!1}function gi(e){return e.ids}function Ce(e,t){t||(t=Re(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(gi),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Pe(e){return typeof e=="string"&&e.startsWith("_local/")}function yi(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,o=s[0],v=s[1],_=s[2],y=_.length===0,w=r.history?r.history.slice():[];if(w.push({id:o,pos:i,opts:v}),y)for(var l=0,g=w.length;l<g;l++){var m=w[l],S=m.pos+"-"+m.id;if(S===e)return i+"-"+o}for(var C=0,p=_.length;C<p;C++)n.push({pos:i+1,ids:_[C],history:w})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function pi(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){_e("error",'Error in .on("change", function):',i)}}function mi(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=tn(t.rev_tree).map(function(s){return{rev:s.rev}}));var i={id:t.id,changes:r,doc:e};return Ce(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=nn(t),i.doc._conflicts.length||delete i.doc._conflicts),i}class wi extends Oe{constructor(t,n,r){super(),this.db=t,n=n?ae(n):{};var i=n.complete=Kn((v,_)=>{v?Hr(this,"error")>0&&this.emit("error",v):this.emit("complete",_),this.removeAllListeners(),t.removeListener("destroyed",s)});r&&(this.on("complete",function(v){r(null,v)}),this.on("error",r));const s=()=>{this.cancel()};t.once("destroyed",s),n.onChange=(v,_,y)=>{this.isCancelled||pi(this,v,_,y)};var o=new Promise(function(v,_){n.complete=function(y,w){y?_(y):v(w)}});this.once("cancel",function(){t.removeListener("destroyed",s),n.complete(null,{status:"cancelled"})}),this.then=o.then.bind(o),this.catch=o.catch.bind(o),this.then(function(v){i(null,v)},i),t.taskqueue.isReady?this.validateChanges(n):t.taskqueue.addTask(v=>{v?n.complete(v):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(t){var n=t.complete;J._changesFilterPlugin?J._changesFilterPlugin.validate(t,r=>{if(r)return n(r);this.doChanges(t)}):this.doChanges(t)}doChanges(t){var n=t.complete;if(t=ae(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=mi,t.since==="latest"&&(t.since="now"),t.since||(t.since=0),t.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}t.since=i.update_seq,this.doChanges(t)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(t),J._changesFilterPlugin.shouldFilter(this,t))return J._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&_e("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=t.limit===0?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...s)=>{r.cancel(),i.apply(this,s)}}}}function ht(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function bi(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var s=r[i];n._attachments[s]=Je(n._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}function Si(e,t){if(e._id===t._id){const n=e._revisions?e._revisions.start:0,r=t._revisions?t._revisions.start:0;return n-r}return e._id<t._id?-1:1}function Ai(e){var t={},n=[];return Le(e,function(r,i,s,o){var v=i+"-"+s;return r&&(t[v]=0),o!==void 0&&n.push({from:o,to:v}),v}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function qi(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function er(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(s,o){s?r(s):r(null,o),qe(function(){e._compactionQueue.shift(),e._compactionQueue.length&&er(e)})})})}function Ci(e,t,n){return e.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:t,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:t,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return e.put(r)})}function Oi(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}function vt(e){return e===null||typeof e!="object"||Array.isArray(e)}const xi=/^\d+-[^-]*$/;function _t(e){return typeof e=="string"&&xi.test(e)}class tr extends Oe{_setup(){this.post=te("post",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),vt(t))return r(G(dt));this.bulkDocs({docs:[t]},n,ht(r,t._id))}).bind(this),this.put=te("put",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),vt(t))return r(G(dt));if(Jn(t._id),"_rev"in t&&!_t(t._rev))return r(G(Ze));if(Pe(t._id)&&typeof this._putLocal=="function")return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);const i=o=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(t,n,o):this.bulkDocs({docs:[t]},n,ht(o,t._id))};n.force&&t._rev?(s(),i(function(o){var v=o?null:{ok:!0,id:t._id,rev:t._rev};r(o,v)})):i(r);function s(){var o=t._rev.split("-"),v=o[1],_=parseInt(o[0],10),y=_+1,w=Xn();t._revisions={start:y,ids:[w,v]},t._rev=y+"-"+w,n.new_edits=!1}}).bind(this),this.putAttachment=te("putAttachment",function(t,n,r,i,s){var o=this;typeof s=="function"&&(s=i,i=r,r=null),typeof s>"u"&&(s=i,i=r,r=null),s||_e("warn","Attachment",n,"on document",t,"is missing content_type");function v(_){var y="_rev"in _?parseInt(_._rev,10):0;return _._attachments=_._attachments||{},_._attachments[n]={content_type:s,data:i,revpos:++y},o.put(_)}return o.get(t).then(function(_){if(_._rev!==r)throw G(Ne);return v(_)},function(_){if(_.reason===he.message)return v({_id:t});throw _})}).bind(this),this.removeAttachment=te("removeAttachment",function(t,n,r,i){this.get(t,(s,o)=>{if(s){i(s);return}if(o._rev!==r){i(G(Ne));return}if(!o._attachments)return i();delete o._attachments[n],Object.keys(o._attachments).length===0&&delete o._attachments,this.put(o,i)})}).bind(this),this.remove=te("remove",function(t,n,r,i){var s;typeof n=="string"?(s={_id:t,_rev:n},typeof r=="function"&&(i=r,r={})):(s=t,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var o={_id:s._id,_rev:s._rev||r.rev};if(o._deleted=!0,Pe(o._id)&&typeof this._removeLocal=="function")return this._removeLocal(s,i);this.bulkDocs({docs:[o]},r,ht(i,o._id))}).bind(this),this.revsDiff=te("revsDiff",function(t,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(t);if(!i.length)return r(null,{});var s=0,o=new Map;function v(y,w){o.has(y)||o.set(y,{missing:[]}),o.get(y).missing.push(w)}function _(y,w){var l=t[y].slice(0);Le(w,function(g,m,S,C,p){var h=m+"-"+S,d=l.indexOf(h);d!==-1&&(l.splice(d,1),p.status!=="available"&&v(y,h))}),l.forEach(function(g){v(y,g)})}i.forEach(function(y){this._getRevisionTree(y,function(w,l){if(w&&w.status===404&&w.message==="missing")o.set(y,{missing:t[y]});else{if(w)return r(w);_(y,l)}if(++s===i.length){var g={};return o.forEach(function(m,S){g[S]=m}),r(null,g)}})},this)}).bind(this),this.bulkGet=te("bulkGet",function(t,n){Un(this,t,n)}).bind(this),this.compactDocument=te("compactDocument",function(t,n,r){this._getRevisionTree(t,(i,s)=>{if(i)return r(i);var o=Ai(s),v=[],_=[];Object.keys(o).forEach(function(y){o[y]>n&&v.push(y)}),Le(s,function(y,w,l,g,m){var S=w+"-"+l;m.status==="available"&&v.indexOf(S)!==-1&&_.push(S)}),this._doCompaction(t,_,r)})}).bind(this),this.compact=te("compact",function(t,n){typeof t=="function"&&(n=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),this._compactionQueue.length===1&&er(this)}).bind(this),this.get=te("get",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},typeof t!="string")return r(G(Fn));if(Pe(t)&&typeof this._getLocal=="function")return this._getLocal(t,r);var i=[];const s=()=>{var _=[],y=i.length;if(!y)return r(null,_);i.forEach(w=>{this.get(t,{rev:w,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(l,g){if(l)_.push({missing:w});else{for(var m,S=0,C=_.length;S<C;S++)if(_[S].ok&&_[S].ok._rev===g._rev){m=!0;break}m||_.push({ok:g})}y--,y||r(null,_)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(t,function(_,y){if(_)return r(_);i=tn(y).map(function(w){return w.rev}),s()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var o=0;o<i.length;o++){var v=i[o];if(!_t(v))return r(G(Ze))}s()}else return r(G(Jt,"function_clause"));return}return this._get(t,n,(_,y)=>{if(_)return _.docId=t,r(_);var w=y.doc,l=y.metadata,g=y.ctx;if(n.conflicts){var m=nn(l);m.length&&(w._conflicts=m)}if(Ce(l,w._rev)&&(w._deleted=!0),n.revs||n.revs_info){for(var S=w._rev.split("-"),C=parseInt(S[0],10),p=S[1],h=Yn(l.rev_tree),d=null,u=0;u<h.length;u++){var a=h[u];const j=a.ids.findIndex(N=>N.id===p);var c=j===C-1;(c||!d&&j!==-1)&&(d=a)}if(!d)return _=new Error("invalid rev tree"),_.docId=t,r(_);const B=w._rev.split("-")[1],U=d.ids.findIndex(j=>j.id===B)+1;var f=d.ids.length-U;if(d.ids.splice(U,f),d.ids.reverse(),n.revs&&(w._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(j){return j.id})}),n.revs_info){var q=d.pos+d.ids.length;w._revs_info=d.ids.map(function(j){return q--,{rev:q+"-"+j.id,status:j.opts.status}})}}if(n.attachments&&w._attachments){var O=w._attachments,E=Object.keys(O).length;if(E===0)return r(null,w);Object.keys(O).forEach(B=>{this._getAttachment(w._id,B,O[B],{binary:n.binary,metadata:l,ctx:g},function(U,j){var N=w._attachments[B];N.data=j,delete N.stub,delete N.length,--E||r(null,w)})})}else{if(w._attachments)for(var P in w._attachments)Object.prototype.hasOwnProperty.call(w._attachments,P)&&(w._attachments[P].stub=!0);r(null,w)}})}).bind(this),this.getAttachment=te("getAttachment",function(t,n,r,i){r instanceof Function&&(i=r,r={}),this._get(t,r,(s,o)=>{if(s)return i(s);if(o.doc._attachments&&o.doc._attachments[n])r.ctx=o.ctx,r.binary=!0,r.metadata=o.metadata,this._getAttachment(t,n,o.doc._attachments[n],r,i);else return i(G(he))})}).bind(this),this.allDocs=te("allDocs",function(t,n){if(typeof t=="function"&&(n=t,t={}),t.skip=typeof t.skip<"u"?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in t})[0];if(r){n(G(zr,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Ae(this)&&(qi(t),t.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}).bind(this),this.close=te("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}).bind(this),this.info=te("info",function(t){this._info((n,r)=>{if(n)return t(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Ae(this)),r.adapter=this.adapter,t(null,r)})}).bind(this),this.id=te("id",function(t){return this._id(t)}).bind(this),this.bulkDocs=te("bulkDocs",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return r(G(Fr));for(var i=0;i<t.docs.length;++i){const _=t.docs[i];if(vt(_))return r(G(dt));if("_rev"in _&&!_t(_._rev))return r(G(Ze))}var s;if(t.docs.forEach(function(_){_._attachments&&Object.keys(_._attachments).forEach(function(y){s=s||Oi(y),_._attachments[y].content_type||_e("warn","Attachment",y,"on document",_._id,"is missing content_type")})}),s)return r(G(st,s));"new_edits"in n||("new_edits"in t?n.new_edits=t.new_edits:n.new_edits=!0);var o=this;!n.new_edits&&!Ae(o)&&t.docs.sort(Si),bi(t.docs);var v=t.docs.map(function(_){return _._id});this._bulkDocs(t,n,function(_,y){if(_)return r(_);if(n.new_edits||(y=y.filter(function(g){return g.error})),!Ae(o))for(var w=0,l=y.length;w<l;w++)y[w].id=y[w].id||v[w];r(null,y)})}).bind(this),this.registerDependentDatabase=te("registerDependentDatabase",function(t,n){var r=ae(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(t,r);function s(o){return o.dependentDbs=o.dependentDbs||{},o.dependentDbs[t]?!1:(o.dependentDbs[t]=!0,o)}tt(this,"_local/_pouch_dependentDbs",s).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=te("destroy",function(t,n){typeof t=="function"&&(n=t,t={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(t,(s,o)=>{if(s)return n(s);this._destroyed=!0,this.emit("destroyed"),n(null,o||{ok:!0})})};if(Ae(this))return i();this.get("_local/_pouch_dependentDbs",(s,o)=>{if(s)return s.status!==404?n(s):i();var v=o.dependentDbs,_=this.constructor,y=Object.keys(v).map(w=>{var l=r?w.replace(new RegExp("^"+_.prefix),""):w;return new _(l,this.__opts).destroy()});Promise.all(y).then(i,n)})}).bind(this)}_compact(t,n){var r={return_docs:!1,last_seq:t.last_seq||0,since:t.last_seq||0},i=[],s,o=0;const v=w=>{this.activeTasks.update(s,{completed_items:++o}),i.push(this.compactDocument(w.id,0))},_=w=>{this.activeTasks.remove(s,w),n(w)},y=w=>{var l=w.last_seq;Promise.all(i).then(()=>tt(this,"_local/compaction",g=>!g.last_seq||g.last_seq<l?(g.last_seq=l,g):!1)).then(()=>{this.activeTasks.remove(s),n(null,{ok:!0})}).catch(_)};this.info().then(w=>{s=this.activeTasks.add({name:"database_compaction",total_items:w.update_seq-r.last_seq}),this.changes(r).on("change",v).on("complete",y).on("error",_)})}changes(t,n){return typeof t=="function"&&(n=t,t={}),t=t||{},t.return_docs="return_docs"in t?t.return_docs:!t.live,new wi(this,t,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}tr.prototype.purge=te("_purge",function(e,t,n){if(typeof this._purge>"u")return n(G(Jt,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(e,(i,s)=>{if(i)return n(i);if(!s)return n(G(he));let o;try{o=ci(s,t)}catch(v){return n(v.message||v)}r._purge(e,o,(v,_)=>{if(v)return n(v);Ci(r,e,t).then(function(){return n(null,_)})})})});class Ei{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()}fail(t){this.failed=t,this.execute()}ready(t){this.isReady=!0,this.db=t,this.execute()}addTask(t){this.queue.push(t),this.failed&&this.execute()}}function ki(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,s=J.prefix,o=t.adapter;if(!o)for(var v=0;v<i.length;++v){if(o=i[v],o==="idb"&&"websql"in r&&et()&&localStorage["_pouch__websqldb_"+s+e]){_e("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var _=r[o],y=_&&"use_prefix"in _?_.use_prefix:!0;return{name:y?s+e:e,adapter:o}}function Di(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e}})}function nr(e,t){let n=function(...r){if(!(this instanceof n))return new n(...r);t.apply(this,r)};return Di(n,e),n}function Ti(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}class gn extends tr{constructor(t,n){super(),this._setup(t,n)}_setup(t,n){if(super._setup(),n=n||{},t&&typeof t=="object"&&(n=t,t=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=ae(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=J.prefix,typeof t!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+t,i=ki(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=t,this._adapter=n.adapter,J.emit("debug",["adapter","Picked adapter: ",n.adapter]),!J.adapters[n.adapter]||!J.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!J.adapters[n.view_adapter]||!J.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new Ei,this.adapter=n.adapter,J.adapters[n.adapter].call(this,n,s=>{if(s)return this.taskqueue.fail(s);Ti(this),this.emit("created",this),J.emit("created",this.name),this.taskqueue.ready(this)})}}const J=nr(gn,function(e,t){gn.prototype._setup.call(this,e,t)});var rr=fetch,je=Headers;class Pi{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(t){const n=Gt();return this.tasks[n]={id:n,name:t.name,total_items:t.total_items,created_at:new Date().toJSON()},n}get(t){return this.tasks[t]}remove(t,n){return delete this.tasks[t],this.tasks}update(t,n){const r=this.tasks[t];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[t]=i}return this.tasks}}J.adapters={};J.preferredAdapters=[];J.prefix="_pouch_";var yn=new Oe;function Ri(e){Object.keys(Oe.prototype).forEach(function(n){typeof Oe.prototype[n]=="function"&&(e[n]=yn[n].bind(yn))});var t=e._destructionListeners=new Map;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),s=i.indexOf(r);s<0||(i.splice(s,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(s){s.emit("destroyed",!0)})}})}Ri(J);J.adapter=function(e,t,n){t.valid()&&(J.adapters[e]=t,n&&J.preferredAdapters.push(e))};J.plugin=function(e){if(typeof e=="function")e(J);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){J.prototype[t]=e[t]})}return this.__defaults&&(J.__defaults=Object.assign({},this.__defaults)),J};J.defaults=function(e){let t=nr(J,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},t.__defaults,r),J.call(this,n,r)});return t.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in t||(t[n]=J[n])}),t.__defaults=Object.assign({},this.__defaults,e),t};J.fetch=function(e,t){return rr(e,t)};J.prototype.activeTasks=J.activeTasks=new Pi;var Li="9.0.0";function rn(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var s=t[r];if(n=n[s],!n)break}return n}function Bi(e,t){return e<t?-1:e>t?1:0}function sn(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var s=e[r];r>0&&e[r-1]==="\\"&&(s==="$"||s===".")?n=n.substring(0,n.length-1)+s:s==="."?(t.push(n),n=""):n+=s}return t.push(n),t}var Ii=["$or","$nor","$not"];function ir(e){return Ii.indexOf(e)>-1}function sr(e){return Object.keys(e)[0]}function ji(e){return e[sr(e)]}function Ge(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var s=r[i];if(typeof s!="object"&&(s={$eq:s}),ir(i))if(s instanceof Array){if(n[i]){n[i]=!1,t[i]=s;return}var o=[];t[i].forEach(function(_){Object.keys(s).forEach(function(y){var w=s[y],l=Math.max(Object.keys(_).length,Object.keys(w).length),g=Ge([_,w]);Object.keys(g).length<=l||o.push(g)})}),t[i]=o}else t[i]=Ge([s]);else{var v=t[i]=t[i]||{};Object.keys(s).forEach(function(_){var y=s[_];if(_==="$gt"||_==="$gte")return $i(_,y,v);if(_==="$lt"||_==="$lte")return Ni(_,y,v);if(_==="$ne")return Ki(y,v);if(_==="$eq")return Mi(y,v);if(_==="$regex")return Ui(y,v);v[_]=y})}})}),t}function $i(e,t,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt<"u"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function Ni(e,t,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt<"u"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function Ki(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function Mi(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Ui(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function ar(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=Ge(e[n].$and));var r=e[t];typeof r=="object"&&ar(r)}return e}function or(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=or(r,t))}return t}function Fi(e){var t=ae(e);or(t,!1)&&(t=ar(t),"$and"in t&&(t=Ge(t.$and))),["$or","$nor"].forEach(function(o){o in t&&t[o].forEach(function(v){for(var _=Object.keys(v),y=0;y<_.length;y++){var w=_[y],l=v[w];(typeof l!="object"||l===null)&&(v[w]={$eq:l})}})}),"$not"in t&&(t.$not=Ge([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],s=t[i];(typeof s!="object"||s===null)&&(s={$eq:s}),t[i]=s}return kt(t),t}function kt(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&kt(r)}):t==="$ne"?e.$ne=[n]:t==="$regex"?e.$regex=[n]:n&&typeof n=="object"&&kt(n)})}function Gi(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Ji(e,t,n){var r=Gi(e,t,n);return r+e}var ur=-324,Dt=3,Tt="";function ne(e,t){if(e===t)return 0;e=Be(e),t=Be(t);var n=Pt(e),r=Pt(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Yi(e,t)}return Array.isArray(e)?Xi(e,t):Zi(e,t)}function Be(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=Be(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=t[i];typeof s<"u"&&(e[i]=Be(s))}}}}return e}function zi(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Vi(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,s="";if(t)for(;++r<i;)s+=pe(n[r]);else for(;++r<i;){var o=n[r];s+=pe(o)+pe(e[o])}return s}return""}function pe(e){var t="\0";return e=Be(e),Pt(e)+Tt+zi(e)+t}function Qi(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var s=e[t]==="0";t++;var o="",v=e.substring(t,t+Dt),_=parseInt(v,10)+ur;for(s&&(_=-_),t+=Dt;;){var y=e[t];if(y==="\0")break;o+=y,t++}o=o.split("."),o.length===1?r=parseInt(o,10):r=parseFloat(o[0]+"."+o[1]),s&&(r=r-10),_!==0&&(r=parseFloat(r+"e"+_))}return{num:r,length:t-n}}function Wi(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(n);else if(s===e.length-2){var o=e.pop();i[o]=n}else e.push(n)}}function Hi(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();Wi(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var s=Qi(e,r);t.push(s.num),r+=s.length;break;case"4":for(var o="";;){var v=e[r];if(v==="\0")break;o+=v,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(o);break;case"5":var _={element:[],index:t.length};t.push(_.element),n.push(_);break;case"6":var y={element:{},index:t.length};t.push(y.element),n.push(y);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Xi(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=ne(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Yi(e,t){return e===t?0:e>t?1:-1}function Zi(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),s=0;s<i;s++){var o=ne(n[s],r[s]);if(o!==0||(o=ne(e[n[s]],t[r[s]]),o!==0))return o}return n.length===r.length?0:n.length>r.length?1:-1}function Pt(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function Vi(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",s=(r?-n:n)-ur,o=Ji(s.toString(),"0",Dt);i+=Tt+o;var v=Math.abs(parseFloat(t[0]));r&&(v=10-v);var _=v.toFixed(20);return _=_.replace(/\.?0+$/,""),i+=Tt+_,i}function es(e){function t(n){return e.map(function(r){var i=sr(r),s=sn(i),o=rn(n,s);return o})}return function(n,r){var i=t(n.doc),s=t(r.doc),o=ne(i,s);return o!==0?o:Bi(n.doc._id,r.doc._id)}}function ts(e,t,n){if(e=e.filter(function(o){return $e(o.doc,t.selector,n)}),t.sort){var r=es(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&ji(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,s=("limit"in t?t.limit:e.length)+i;e=e.slice(i,s)}return e}function $e(e,t,n){return n.every(function(r){var i=t[r],s=sn(r),o=rn(e,s);return ir(r)?ns(r,i,e):nt(i,e,s,o)})}function nt(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var s=e[i];if(i.indexOf("$")===0)return pn(i,t,s,n,r);var o=sn(i);if(r===void 0&&typeof s!="object"&&o.length>0)return!1;var v=rn(r,o);return typeof s=="object"?nt(s,t,n,v):pn("$eq",t,s,o,v)}):e===r:!0}function ns(e,t,n){return e==="$or"?t.some(function(r){return $e(n,r,Object.keys(r))}):e==="$not"?!$e(n,t,Object.keys(t)):!t.find(function(r){return $e(n,r,Object.keys(r))})}function pn(e,t,n,r,i){if(!wn[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return wn[e](t,n,r,i)}function Ue(e){return typeof e<"u"&&e!==null}function xe(e){return typeof e<"u"}function rs(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function mn(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return ne(n,r)===0}):ne(n,e)===0})}function is(e,t){return t.every(function(n){return e.some(function(r){return ne(n,r)===0})})}function ss(e,t){return e.length===t}function as(e,t){var n=new RegExp(t);return n.test(e)}function os(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var wn={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return $e(i,t,Object.keys(t))}):r.some(function(i){return nt(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return $e(i,t,Object.keys(t))}):r.every(function(i){return nt(t,e,n,i)})},$eq:function(e,t,n,r){return xe(r)&&ne(r,t)===0},$gte:function(e,t,n,r){return xe(r)&&ne(r,t)>=0},$gt:function(e,t,n,r){return xe(r)&&ne(r,t)>0},$lte:function(e,t,n,r){return xe(r)&&ne(r,t)<=0},$lt:function(e,t,n,r){return xe(r)&&ne(r,t)<0},$exists:function(e,t,n,r){return t?xe(r):!xe(r)},$mod:function(e,t,n,r){return Ue(r)&&rs(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return ne(r,i)!==0})},$in:function(e,t,n,r){return Ue(r)&&mn(r,t)},$nin:function(e,t,n,r){return Ue(r)&&!mn(r,t)},$size:function(e,t,n,r){return Ue(r)&&Array.isArray(r)&&ss(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&is(r,t)},$regex:function(e,t,n,r){return Ue(r)&&typeof r=="string"&&t.every(function(i){return as(r,i)})},$type:function(e,t,n,r){return os(r,t)}};function us(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=Fi(t);var n={doc:e},r=ts([n],{selector:t},Object.keys(t));return r&&r.length===1}function cs(e){return Wt(`"use strict";
return `+e+";",{})}function fs(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Wt(t,{})}function ls(e,t){if(e.selector&&e.filter&&e.filter!=="_selector"){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function ds(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=ln(e.view):e.filter=ln(e.filter))}function hs(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!Ae(e.db)}function vs(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=G(st,"`view` filter parameter not found or invalid.");return n(r)}var i=Et(t.view);e.db.get("_design/"+i[0],function(o,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(Ke(o));var _=v&&v.views&&v.views[i[1]]&&v.views[i[1]].map;if(!_)return n(G(he,v.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=fs(_),e.doChanges(t)})}else if(t.selector)t.filter=function(o){return us(o,t.selector)},e.doChanges(t);else{var s=Et(t.filter);e.db.get("_design/"+s[0],function(o,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(Ke(o));var _=v&&v.filters&&v.filters[s[1]];if(!_)return n(G(he,v&&v.filters?"missing json key: "+s[1]:"missing json key: filters"));t.filter=cs(_),e.doChanges(t)})}}function _s(e){e._changesFilterPlugin={validate:ls,normalize:ds,shouldFilter:hs,filter:vs}}J.plugin(_s);J.version=Li;function gs(e,t,n){return new Promise(function(r){var i=Xt([""]);let s;{const o=n;s=e.objectStore(t).put(i,o)}s.onsuccess=function(){var o=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);r(v||!o||parseInt(o[1],10)>=43)},s.onerror=e.onabort=function(o){o.preventDefault(),o.stopPropagation(),r(!1)}}).catch(function(){return!1})}function cr(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var ys=cr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ps=cr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function bn(e){if(!/^\d+-/.test(e))return G(Ze);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function ms(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],s=1,o=r.length;s<o;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}function fr(e,t,n){n||(n={deterministic_revs:!0});var r,i,s,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=at()),i=Xn(e,n.deterministic_revs),e._rev){if(s=bn(e._rev),s.error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[i,o,[]]]]}],r=s.prefix+1}else e._rev_tree=[{pos:1,ids:[i,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=ms(e._revisions,o),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(s=bn(e._rev),s.error)return s;r=s.prefix,i=s.id,e._rev_tree=[{pos:r,ids:[i,o,[]]}]}Jn(e._id),e._rev=r+"-"+i;var v={metadata:{},data:{}};for(var _ in e)if(Object.prototype.hasOwnProperty.call(e,_)){var y=_[0]==="_";if(y&&!ys[_]){var w=G(fn,_);throw w.message=fn.message+": "+_,w}else y&&!ps[_]?v.metadata[_.slice(1)]=e[_]:v.data[_]=e[_]}return v}function ws(e){try{return Ht(e)}catch{var t=G(Gn,"Attachment is not a valid base64 string");return{error:t}}}function bs(e,t,n){var r=ws(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=Yt(r,e.content_type):t==="base64"?e.data=ze(r):e.data=r,en(r,function(i){e.digest="md5-"+i,n()})}function Ss(e,t,n){en(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?Wn(e.data,function(i){e.data=i,n()}):t==="base64"?Vt(e.data,function(i){e.data=i,n()}):n()})}function As(e,t,n){if(e.stub)return n();typeof e.data=="string"?bs(e,t,n):Ss(e,t,n)}function qs(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(o){var v=o.data&&o.data._attachments?Object.keys(o.data._attachments):[],_=0;if(!v.length)return s();function y(l){i=l,_++,_===v.length&&s()}for(var w in o.data._attachments)Object.prototype.hasOwnProperty.call(o.data._attachments,w)&&As(o.data._attachments[w],t,y)});function s(){r++,e.length===r&&(i?n(i):n())}}function Cs(e,t,n,r,i,s,o,v){if(_i(t.rev_tree,n.metadata.rev)&&!v)return r[i]=n,s();var _=t.winningRev||Re(t),y="deleted"in t?t.deleted:Ce(t,_),w="deleted"in n.metadata?n.metadata.deleted:Ce(n.metadata),l=/^1-/.test(n.metadata.rev);if(y&&!w&&v&&l){var g=n.data;g._rev=_,g._id=n.metadata.id,n=fr(g,v)}var m=Vn(t.rev_tree,n.metadata.rev_tree[0],e),S=v&&(y&&w&&m.conflicts!=="new_leaf"||!y&&m.conflicts!=="new_leaf"||y&&!w&&m.conflicts==="new_branch");if(S){var C=G(Ne);return r[i]=C,s()}var p=n.metadata.rev;n.metadata.rev_tree=m.tree,n.stemmedRevs=m.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var h=Re(n.metadata),d=Ce(n.metadata,h),u=y===d?0:y<d?-1:1,a;p===h?a=d:a=Ce(n.metadata,p),o(n,h,d,a,!0,u,i,s)}function Os(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function xs(e,t,n,r,i,s,o,v,_){e=e||1e3;function y(C,p,h){var d=Re(C.metadata),u=Ce(C.metadata,d);if("was_delete"in v&&u)return s[p]=G(he,"deleted"),h();var a=w&&Os(C);if(a){var c=G(Ne);return s[p]=c,h()}var f=u?0:1;o(C,d,u,u,!1,f,p,h)}var w=v.new_edits,l=new Map,g=0,m=t.length;function S(){++g===m&&_&&_()}t.forEach(function(C,p){if(C._id&&Pe(C._id)){var h=C._deleted?"_removeLocal":"_putLocal";n[h](C,{ctx:i},function(u,a){s[p]=u||a,S()});return}var d=C.metadata.id;l.has(d)?(m--,l.get(d).push([C,p])):l.set(d,[[C,p]])}),l.forEach(function(C,p){var h=0;function d(){++h<C.length?u():S()}function u(){var a=C[h],c=a[0],f=a[1];if(r.has(p))Cs(e,r.get(p),c,s,f,d,o,w);else{var q=Vn([],c.metadata.rev_tree[0],e);c.metadata.rev_tree=q.tree,c.stemmedRevs=q.stemmedRevs||[],y(c,f,d)}}u()})}var Es=5,ie="document-store",ce="by-sequence",ve="attach-store",De="attach-seq-store",fe="meta-store",be="local-store",gt="detect-blob-support";function ks(e){try{return JSON.parse(e)}catch{return $n.parse(e)}}function Ds(e){try{return JSON.stringify(e)}catch{return $n.stringify(e)}}function Se(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(G(zt,n,t.type))}}function Rt(e,t,n){return{data:Ds(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Te(e){if(!e)return null;var t=ks(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function rt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function lr(e,t,n,r){n?r(e?typeof e!="string"?e:Zt(e,t):Xt([""],{type:t})):e?typeof e!="string"?Qn(e,function(i){r(ze(i))}):r(e):r("")}function dr(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var s=0;function o(){++s===i.length&&r&&r()}function v(_,y){var w=_._attachments[y],l=w.digest,g=n.objectStore(ve).get(l);g.onsuccess=function(m){w.body=m.target.result.body,o()}}i.forEach(function(_){t.attachments&&t.include_docs?v(e,_):(e._attachments[_].stub=!0,o())})}function Lt(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var s=n.doc._attachments[i];if("body"in s){var o=s.body,v=s.content_type;return new Promise(function(_){lr(o,v,t,function(y){n.doc._attachments[i]=Object.assign(Je(s,["digest","content_type"]),{data:y}),_()})})}}))}}))}function hr(e,t,n){var r=[],i=n.objectStore(ce),s=n.objectStore(ve),o=n.objectStore(De),v=e.length;function _(){v--,v||y()}function y(){r.length&&r.forEach(function(w){var l=o.index("digestSeq").count(IDBKeyRange.bound(w+"::",w+"::",!1,!1));l.onsuccess=function(g){var m=g.target.result;m||s.delete(w)}})}e.forEach(function(w){var l=i.index("_doc_id_rev"),g=t+"::"+w;l.getKey(g).onsuccess=function(m){var S=m.target.result;if(typeof S!="number")return _();i.delete(S);var C=o.index("seq").openCursor(IDBKeyRange.only(S));C.onsuccess=function(p){var h=p.target.result;if(h){var d=h.value.digestSeq.split("::")[0];r.push(d),o.delete(h.primaryKey),h.continue()}else _()}}})}function me(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var Fe=new Kr;function Ts(e,t,n,r,i,s){for(var o=t.docs,v,_,y,w,l,g,m,S,C=0,p=o.length;C<p;C++){var h=o[C];h._id&&Pe(h._id)||(h=o[C]=fr(h,n.new_edits,e),h.error&&!m&&(m=h))}if(m)return s(m);var d=!1,u=0,a=new Array(o.length),c=new Map,f=!1,q=r._meta.blobSupport?"blob":"base64";qs(o,q,function(k){if(k)return s(k);O()});function O(){var k=[ie,ce,ve,be,De,fe],R=me(i,k,"readwrite");if(R.error)return s(R.error);v=R.txn,v.onabort=Se(s),v.ontimeout=Se(s),v.oncomplete=j,_=v.objectStore(ie),y=v.objectStore(ce),w=v.objectStore(ve),l=v.objectStore(De),g=v.objectStore(fe),g.get(fe).onsuccess=function($){S=$.target.result,B()},z(function($){if($)return f=!0,s($);U()})}function E(){d=!0,B()}function P(){xs(e.revs_limit,o,r,c,v,a,Q,n,E)}function B(){!S||!d||(S.docCount+=u,g.put(S))}function U(){if(!o.length)return;var k=0;function R(){++k===o.length&&P()}function $(I){var K=Te(I.target.result);K&&c.set(K.id,K),R()}for(var F=0,L=o.length;F<L;F++){var x=o[F];if(x._id&&Pe(x._id)){R();continue}var D=_.get(x.metadata.id);D.onsuccess=$}}function j(){f||(Fe.notify(r._meta.name),s(null,a))}function N(k,R){var $=w.get(k);$.onsuccess=function(F){if(F.target.result)R();else{var L=G(Qr,"unknown stub attachment with digest "+k);L.status=412,R(L)}}}function z(k){var R=[];if(o.forEach(function(x){x.data&&x.data._attachments&&Object.keys(x.data._attachments).forEach(function(D){var I=x.data._attachments[D];I.stub&&R.push(I.digest)})}),!R.length)return k();var $=0,F;function L(){++$===R.length&&k(F)}R.forEach(function(x){N(x,function(D){D&&!F&&(F=D),L()})})}function Q(k,R,$,F,L,x,D,I){k.metadata.winningRev=R,k.metadata.deleted=$;var K=k.data;K._id=k.metadata.id,K._rev=k.metadata.rev,F&&(K._deleted=!0);var M=K._attachments&&Object.keys(K._attachments).length;if(M)return b(k,R,$,L,D,I);u+=x,B(),W(k,R,$,L,D,I)}function W(k,R,$,F,L,x){var D=k.data,I=k.metadata;D._doc_id_rev=I.id+"::"+I.rev,delete D._id,delete D._rev;function K(re){var le=k.stemmedRevs||[];F&&r.auto_compaction&&(le=le.concat(ui(k.metadata))),le&&le.length&&hr(le,k.metadata.id,v),I.seq=re.target.result;var we=Rt(I,R,$),X=_.put(we);X.onsuccess=Y}function M(re){re.preventDefault(),re.stopPropagation();var le=y.index("_doc_id_rev"),we=le.getKey(D._doc_id_rev);we.onsuccess=function(X){var H=y.put(D,X.target.result);H.onsuccess=K}}function Y(){a[L]={ok:!0,id:I.id,rev:I.rev},c.set(k.metadata.id,k.metadata),A(k,I.seq,x)}var ee=y.put(D);ee.onsuccess=K,ee.onerror=M}function b(k,R,$,F,L,x){var D=k.data,I=0,K=Object.keys(D._attachments);function M(){I===K.length&&W(k,R,$,F,L,x)}function Y(){I++,M()}K.forEach(function(ee){var re=k.data._attachments[ee];if(re.stub)I++,M();else{var le=re.data;delete re.data,re.revpos=parseInt(R,10);var we=re.digest;T(we,le,Y)}})}function A(k,R,$){var F=0,L=Object.keys(k.data._attachments||{});if(!L.length)return $();function x(){++F===L.length&&$()}function D(K){var M=k.data._attachments[K].digest,Y=l.put({seq:R,digestSeq:M+"::"+R});Y.onsuccess=x,Y.onerror=function(ee){ee.preventDefault(),ee.stopPropagation(),x()}}for(var I=0;I<L.length;I++)D(L[I])}function T(k,R,$){var F=w.count(k);F.onsuccess=function(L){var x=L.target.result;if(x)return $();var D={digest:k,body:R},I=w.put(D);I.onsuccess=$}}}function vr(e,t,n,r,i){r===-1&&(r=1e3);var s=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,o,v,_;function y(m){v=m.target.result,o&&i(o,v,_)}function w(m){o=m.target.result,v&&i(o,v,_)}function l(){if(!o.length)return i();var m=o[o.length-1],S;if(t&&t.upper)try{S=IDBKeyRange.bound(m,t.upper,!0,t.upperOpen)}catch(C){if(C.name==="DataError"&&C.code===0)return i()}else S=IDBKeyRange.lowerBound(m,!0);t=S,o=null,v=null,e.getAll(t,r).onsuccess=y,e.getAllKeys(t,r).onsuccess=w}function g(m){var S=m.target.result;if(!S)return i();i([S.key],[S.value],S)}s?(_={continue:l},e.getAll(t,r).onsuccess=y,e.getAllKeys(t,r).onsuccess=w):n?e.openCursor(t,"prev").onsuccess=g:e.openCursor(t).onsuccess=g}function Ps(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(s){var o=s.target.result;o?(r.push(o.value),o.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function Rs(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(s,o){t.get(s).onsuccess=function(v){v.target.result?r[o]=v.target.result:r[o]={key:s,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function Ls(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(s){return{error:s}}return null}function Bs(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,s="key"in e?e.key:!1,o="keys"in e?e.keys:!1,v=e.skip||0,_=typeof e.limit=="number"?e.limit:-1,y=e.inclusive_end!==!1,w,l;if(!o&&(w=Ls(r,i,y,s,e.descending),l=w&&w.error,l&&!(l.name==="DataError"&&l.code===0)))return n(G(zt,l.name,l.message));var g=[ie,ce,fe];e.attachments&&g.push(ve);var m=me(t,g,"readonly");if(m.error)return n(m.error);var S=m.txn;S.oncomplete=U,S.onabort=Se(n);var C=S.objectStore(ie),p=S.objectStore(ce),h=S.objectStore(fe),d=p.index("_doc_id_rev"),u=[],a,c;h.get(fe).onsuccess=function(j){a=j.target.result.docCount},e.update_seq&&(p.openKeyCursor(null,"prev").onsuccess=j=>{var N=j.target.result;N&&N.key&&(c=N.key)});function f(j,N,z){var Q=j.id+"::"+z;d.get(Q).onsuccess=function(b){if(N.doc=rt(b.target.result)||{},e.conflicts){var A=nn(j);A.length&&(N.doc._conflicts=A)}dr(N.doc,e,S)}}function q(j,N){var z={id:N.id,key:N.id,value:{rev:j}},Q=N.deleted;Q?o&&(u.push(z),z.value.deleted=!0,z.doc=null):v--<=0&&(u.push(z),e.include_docs&&f(N,z,j))}function O(j){for(var N=0,z=j.length;N<z&&u.length!==_;N++){var Q=j[N];if(Q.error&&o){u.push(Q);continue}var W=Te(Q),b=W.winningRev;q(b,W)}}function E(j,N,z){z&&(O(N),u.length<_&&z.continue())}function P(j){var N=j.target.result;e.descending&&(N=N.reverse()),O(N)}function B(){var j={total_rows:a,offset:e.skip,rows:u};e.update_seq&&c!==void 0&&(j.update_seq=c),n(null,j)}function U(){e.attachments?Lt(u,e.binary).then(B):B()}if(!(l||_===0)){if(o)return Rs(o,C,E);if(_===-1)return Ps(C,w,P);vr(C,w,e.descending,_+v,E)}}function Is(e,t){var n=e.objectStore(ie).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}var Bt=!1,It=[];function js(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function Sn(){Bt||!It.length||(Bt=!0,It.shift()())}function $s(e,t,n){It.push(function(){e(function(s,o){js(t,s,o,n),Bt=!1,qe(function(){Sn()})})}),Sn()}function Ns(e,t,n,r){if(e=ae(e),e.continuous){var i=n+":"+at();return Fe.addListener(n,i,t,e),Fe.notify(n),{cancel:function(){Fe.removeListener(n,i)}}}var s=e.doc_ids&&new Set(e.doc_ids);e.since=e.since||0;var o=e.since,v="limit"in e?e.limit:-1;v===0&&(v=1);var _=[],y=0,w=Qt(e),l=new Map,g,m,S,C;function p(O,E,P){if(!P||!O.length)return;var B=new Array(O.length),U=new Array(O.length);function j(Q,W){var b=e.processChange(W,Q,e);o=b.seq=Q.seq;var A=w(b);return typeof A=="object"?Promise.reject(A):A?(y++,e.return_docs&&_.push(b),e.attachments&&e.include_docs?new Promise(function(T){dr(W,e,g,function(){Lt([b],e.binary).then(function(){T(b)})})}):Promise.resolve(b)):Promise.resolve()}function N(){for(var Q=[],W=0,b=B.length;W<b&&y!==v;W++){var A=B[W];if(A){var T=U[W];Q.push(j(T,A))}}Promise.all(Q).then(function(k){for(var R=0,$=k.length;R<$;R++)k[R]&&e.onChange(k[R])}).catch(e.complete),y!==v&&P.continue()}var z=0;E.forEach(function(Q,W){var b=rt(Q),A=O[W];d(b,A,function(T,k){U[W]=T,B[W]=k,++z===O.length&&N()})})}function h(O,E,P,B){if(P.seq!==E)return B();if(P.winningRev===O._rev)return B(P,O);var U=O._id+"::"+P.winningRev,j=C.get(U);j.onsuccess=function(N){B(P,rt(N.target.result))}}function d(O,E,P){if(s&&!s.has(O._id))return P();var B=l.get(O._id);if(B)return h(O,E,B,P);S.get(O._id).onsuccess=function(U){B=Te(U.target.result),l.set(O._id,B),h(O,E,B,P)}}function u(){e.complete(null,{results:_,last_seq:o})}function a(){!e.continuous&&e.attachments?Lt(_).then(u):u()}var c=[ie,ce];e.attachments&&c.push(ve);var f=me(r,c,"readonly");if(f.error)return e.complete(f.error);g=f.txn,g.onabort=Se(e.complete),g.oncomplete=a,m=g.objectStore(ce),S=g.objectStore(ie),C=m.index("_doc_id_rev");var q=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;vr(m,q,e.descending,v,p)}var Ie=new Map,yt,pt=new Map;function _r(e,t){var n=this;$s(function(r){Ks(n,e,r)},t,n.constructor)}function Ks(e,t,n){var r=t.name,i=null,s=null;e._meta=null;function o(p){return function(h,d){h&&h instanceof Error&&!h.reason&&s&&(h.reason=s),p(h,d)}}function v(p){var h=p.createObjectStore(ie,{keyPath:"id"});p.createObjectStore(ce,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),p.createObjectStore(ve,{keyPath:"digest"}),p.createObjectStore(fe,{keyPath:"id",autoIncrement:!1}),p.createObjectStore(gt),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),p.createObjectStore(be,{keyPath:"_id"});var d=p.createObjectStore(De,{autoIncrement:!0});d.createIndex("seq","seq"),d.createIndex("digestSeq","digestSeq",{unique:!0})}function _(p,h){var d=p.objectStore(ie);d.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),d.openCursor().onsuccess=function(u){var a=u.target.result;if(a){var c=a.value,f=Ce(c);c.deletedOrLocal=f?"1":"0",d.put(c),a.continue()}else h()}}function y(p){p.createObjectStore(be,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function w(p,h){var d=p.objectStore(be),u=p.objectStore(ie),a=p.objectStore(ce),c=u.openCursor();c.onsuccess=function(f){var q=f.target.result;if(q){var O=q.value,E=O.id,P=Pe(E),B=Re(O);if(P){var U=E+"::"+B,j=E+"::",N=E+"::~",z=a.index("_doc_id_rev"),Q=IDBKeyRange.bound(j,N,!1,!1),W=z.openCursor(Q);W.onsuccess=function(b){if(W=b.target.result,!W)u.delete(q.primaryKey),q.continue();else{var A=W.value;A._doc_id_rev===U&&d.put(A),a.delete(W.primaryKey),W.continue()}}}else q.continue()}else h&&h()}}function l(p){var h=p.createObjectStore(De,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function g(p,h){var d=p.objectStore(ce),u=p.objectStore(ve),a=p.objectStore(De),c=u.count();c.onsuccess=function(f){var q=f.target.result;if(!q)return h();d.openCursor().onsuccess=function(O){var E=O.target.result;if(!E)return h();for(var P=E.value,B=E.primaryKey,U=Object.keys(P._attachments||{}),j={},N=0;N<U.length;N++){var z=P._attachments[U[N]];j[z.digest]=!0}var Q=Object.keys(j);for(N=0;N<Q.length;N++){var W=Q[N];a.put({seq:B,digestSeq:W+"::"+B})}E.continue()}}}function m(p){function h(c){return c.data?Te(c):(c.deleted=c.deletedOrLocal==="1",c)}var d=p.objectStore(ce),u=p.objectStore(ie),a=u.openCursor();a.onsuccess=function(c){var f=c.target.result;if(!f)return;var q=h(f.value);q.winningRev=q.winningRev||Re(q);function O(){var P=q.id+"::",B=q.id+"::",U=d.index("_doc_id_rev").openCursor(IDBKeyRange.bound(P,B)),j=0;U.onsuccess=function(N){var z=N.target.result;if(!z)return q.seq=j,E();var Q=z.primaryKey;Q>j&&(j=Q),z.continue()}}function E(){var P=Rt(q,q.winningRev,q.deleted),B=u.put(P);B.onsuccess=function(){f.continue()}}if(q.seq)return E();O()}}e._remote=!1,e.type=function(){return"idb"},e._id=Mn(function(p){p(null,e._meta.instanceId)}),e._bulkDocs=function(h,d,u){Ts(t,h,d,e,i,o(u))},e._get=function(h,d,u){var a,c,f,q=d.ctx;if(!q){var O=me(i,[ie,ce,ve],"readonly");if(O.error)return u(O.error);q=O.txn}function E(){u(f,{doc:a,metadata:c,ctx:q})}q.objectStore(ie).get(h).onsuccess=function(P){if(c=Te(P.target.result),!c)return f=G(he,"missing"),E();var B;if(d.rev)B=d.latest?yi(d.rev,c):d.rev;else{B=c.winningRev;var U=Ce(c);if(U)return f=G(he,"deleted"),E()}var j=q.objectStore(ce),N=c.id+"::"+B;j.index("_doc_id_rev").get(N).onsuccess=function(z){if(a=z.target.result,a&&(a=rt(a)),!a)return f=G(he,"missing"),E();E()}}},e._getAttachment=function(p,h,d,u,a){var c;if(u.ctx)c=u.ctx;else{var f=me(i,[ie,ce,ve],"readonly");if(f.error)return a(f.error);c=f.txn}var q=d.digest,O=d.content_type;c.objectStore(ve).get(q).onsuccess=function(E){var P=E.target.result.body;lr(P,O,u.binary,function(B){a(null,B)})}},e._info=function(h){var d,u,a=me(i,[fe,ce],"readonly");if(a.error)return h(a.error);var c=a.txn;c.objectStore(fe).get(fe).onsuccess=function(f){u=f.target.result.docCount},c.objectStore(ce).openKeyCursor(null,"prev").onsuccess=function(f){var q=f.target.result;d=q?q.key:0},c.oncomplete=function(){h(null,{doc_count:u,update_seq:d,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(h,d){Bs(h,i,o(d))},e._changes=function(h){return Ns(h,e,r,i)},e._close=function(p){i.close(),Ie.delete(r),p()},e._getRevisionTree=function(p,h){var d=me(i,[ie],"readonly");if(d.error)return h(d.error);var u=d.txn,a=u.objectStore(ie).get(p);a.onsuccess=function(c){var f=Te(c.target.result);f?h(null,f.rev_tree):h(G(he))}},e._doCompaction=function(p,h,d){var u=[ie,ce,ve,De],a=me(i,u,"readwrite");if(a.error)return d(a.error);var c=a.txn,f=c.objectStore(ie);f.get(p).onsuccess=function(q){var O=Te(q.target.result);Le(O.rev_tree,function(B,U,j,N,z){var Q=U+"-"+j;h.indexOf(Q)!==-1&&(z.status="missing")}),hr(h,p,c);var E=O.winningRev,P=O.deleted;c.objectStore(ie).put(Rt(O,E,P))},c.onabort=Se(d),c.oncomplete=function(){d()}},e._getLocal=function(p,h){var d=me(i,[be],"readonly");if(d.error)return h(d.error);var u=d.txn,a=u.objectStore(be).get(p);a.onerror=Se(h),a.onsuccess=function(c){var f=c.target.result;f?(delete f._doc_id_rev,h(null,f)):h(G(he))}},e._putLocal=function(p,h,d){typeof h=="function"&&(d=h,h={}),delete p._revisions;var u=p._rev,a=p._id;u?p._rev="0-"+(parseInt(u.split("-")[1],10)+1):p._rev="0-1";var c=h.ctx,f;if(!c){var q=me(i,[be],"readwrite");if(q.error)return d(q.error);c=q.txn,c.onerror=Se(d),c.oncomplete=function(){f&&d(null,f)}}var O=c.objectStore(be),E;u?(E=O.get(a),E.onsuccess=function(P){var B=P.target.result;if(!B||B._rev!==u)d(G(Ne));else{var U=O.put(p);U.onsuccess=function(){f={ok:!0,id:p._id,rev:p._rev},h.ctx&&d(null,f)}}}):(E=O.add(p),E.onerror=function(P){d(G(Ne)),P.preventDefault(),P.stopPropagation()},E.onsuccess=function(){f={ok:!0,id:p._id,rev:p._rev},h.ctx&&d(null,f)})},e._removeLocal=function(p,h,d){typeof h=="function"&&(d=h,h={});var u=h.ctx;if(!u){var a=me(i,[be],"readwrite");if(a.error)return d(a.error);u=a.txn,u.oncomplete=function(){c&&d(null,c)}}var c,f=p._id,q=u.objectStore(be),O=q.get(f);O.onerror=Se(d),O.onsuccess=function(E){var P=E.target.result;!P||P._rev!==p._rev?d(G(he)):(q.delete(f),c={ok:!0,id:f,rev:"0-0"},h.ctx&&d(null,c))}},e._destroy=function(p,h){Fe.removeAllListeners(r);var d=pt.get(r);d&&d.result&&(d.result.close(),Ie.delete(r));var u=indexedDB.deleteDatabase(r);u.onsuccess=function(){pt.delete(r),et()&&r in localStorage&&delete localStorage[r],h(null,{ok:!0})},u.onerror=Se(h)};var S=Ie.get(r);if(S)return i=S.idb,e._meta=S.global,qe(function(){n(null,e)});var C=indexedDB.open(r,Es);pt.set(r,C),C.onupgradeneeded=function(p){var h=p.target.result;if(p.oldVersion<1)return v(h);var d=p.currentTarget.transaction;p.oldVersion<3&&y(h),p.oldVersion<4&&l(h);var u=[_,w,g,m],a=p.oldVersion;function c(){var f=u[a-1];a++,f&&f(d,c)}c()},C.onsuccess=function(p){i=p.target.result,i.onversionchange=function(){i.close(),Ie.delete(r)},i.onabort=function(E){_e("error","Database has a global failure",E.target.error),s=E.target.error,i.close(),Ie.delete(r)};var h=i.transaction([fe,gt,ie],"readwrite"),d=!1,u,a,c,f;function q(){typeof c>"u"||!d||(e._meta={name:r,instanceId:f,blobSupport:c},Ie.set(r,{idb:i,global:e._meta}),n(null,e))}function O(){if(!(typeof a>"u"||typeof u>"u")){var E=r+"_id";E in u?f=u[E]:u[E]=f=at(),u.docCount=a,h.objectStore(fe).put(u)}}h.objectStore(fe).get(fe).onsuccess=function(E){u=E.target.result||{id:fe},O()},Is(h,function(E){a=E,O()}),yt||(yt=gs(h,gt,"key")),yt.then(function(E){c=E,q()}),h.oncomplete=function(){d=!0,q()},h.onabort=Se(n)},C.onerror=function(p){var h=p.target.error&&p.target.error.message;h?h.indexOf("stored database is a higher version")!==-1&&(h=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):h="Failed to open indexedDB, are you in private browsing mode?",_e("error",h),n(G(zt,h))}}_r.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function Ms(e){e.adapter("idb",_r,!0)}function Us(e,t){return new Promise(function(n,r){var i=0,s=0,o=0,v=e.length,_;function y(){i++,e[s++]().then(l,g)}function w(){++o===v?_?r(_):n():m()}function l(){i--,w()}function g(S){i--,_=_||S,w()}function m(){for(;i<t&&s<v;)y()}m()})}const Fs=25,Gs=50,Xe=5e3,Js=1e4,mt={};function wt(e){const t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){const i=n[r];i.data=Zt(i.data,i.content_type)})}function Ee(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):e.startsWith("_local/")?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function An(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){const n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){Vt(n.data,r)}).then(function(r){n.data=r})}))}function zs(e){if(!e.prefix)return!1;const t=zn(e.prefix).protocol;return t==="http"||t==="https"}function Qs(e,t){if(zs(t)){const i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}const n=zn(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});const r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function se(e,t){return Ve(e,e.db+"/"+t)}function Ve(e,t){const n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function Ye(e){const t=Object.keys(e);return t.length===0?"":"?"+t.map(n=>n+"="+encodeURIComponent(e[n])).join("&")}function Ws(e){const t=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,s=!("method"in e)||e.method==="GET";return(n||r||i)&&s}function jt(e,t){const n=this,r=Qs(e.name,e),i=se(r,"");e=ae(e);const s=async function(l,g){if(g=g||{},g.headers=g.headers||new je,g.credentials="include",e.auth||r.auth){const C=e.auth||r.auth,p=C.username+":"+C.password,h=ze(unescape(encodeURIComponent(p)));g.headers.set("Authorization","Basic "+h)}const m=e.headers||{};return Object.keys(m).forEach(function(C){g.headers.append(C,m[C])}),Ws(g)&&(l+=(l.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(e.fetch||rr)(l,g)};function o(l,g){return te(l,function(...m){y().then(function(){return g.apply(this,m)}).catch(function(S){m.pop()(S)})}).bind(n)}async function v(l,g){const m={};g=g||{},g.headers=g.headers||new je,g.headers.get("Content-Type")||g.headers.set("Content-Type","application/json"),g.headers.get("Accept")||g.headers.set("Accept","application/json");const S=await s(l,g);m.ok=S.ok,m.status=S.status;const C=await S.json();if(m.data=C,!m.ok)throw m.data.status=m.status,Ke(m.data);return Array.isArray(m.data)&&(m.data=m.data.map(function(p){return p.error||p.missing?Ke(p):p})),m}let _;async function y(){return e.skip_setup?Promise.resolve():_||(_=v(i).catch(function(l){return l&&l.status&&l.status===404?(xt(404,"PouchDB is just detecting if the remote exists."),v(i,{method:"PUT"})):Promise.reject(l)}).catch(function(l){return l&&l.status&&l.status===412?!0:Promise.reject(l)}),_.catch(function(){_=null}),_)}qe(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=o("id",async function(l){let g;try{g=await(await s(Ve(r,""))).json()}catch{g={}}const m=g&&g.uuid?g.uuid+r.db:se(r,"");l(null,m)}),n.compact=o("compact",async function(l,g){typeof l=="function"&&(g=l,l={}),l=ae(l),await v(se(r,"_compact"),{method:"POST"});function m(){n.info(function(S,C){C&&!C.compact_running?g(null,{ok:!0}):setTimeout(m,l.interval||200)})}m()}),n.bulkGet=te("bulkGet",function(l,g){const m=this;async function S(d){const u={};l.revs&&(u.revs=!0),l.attachments&&(u.attachments=!0),l.latest&&(u.latest=!0);try{const a=await v(se(r,"_bulk_get"+Ye(u)),{method:"POST",body:JSON.stringify({docs:l.docs})});l.attachments&&l.binary&&a.data.results.forEach(function(c){c.docs.forEach(wt)}),d(null,a.data)}catch(a){d(a)}}function C(){const d=Gs,u=Math.ceil(l.docs.length/d);let a=0;const c=new Array(u);function f(q){return function(O,E){c[q]=E.results,++a===u&&g(null,{results:c.flat()})}}for(let q=0;q<u;q++){const O=Je(l,["revs","attachments","binary","latest"]);O.docs=l.docs.slice(q*d,Math.min(l.docs.length,(q+1)*d)),Un(m,O,f(q))}}const p=Ve(r,""),h=mt[p];typeof h!="boolean"?S(function(d,u){d?(mt[p]=!1,xt(d.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),C()):(mt[p]=!0,g(null,u))}):h?S(g):C()}),n._info=async function(l){try{await y();const m=await(await s(se(r,""))).json();m.host=se(r,""),l(null,m)}catch(g){l(g)}},n.fetch=async function(l,g){await y();const m=l.substring(0,1)==="/"?Ve(r,l.substring(1)):se(r,l);return s(m,g)},n.get=o("get",async function(l,g,m){typeof g=="function"&&(m=g,g={}),g=ae(g);const S={};g.revs&&(S.revs=!0),g.revs_info&&(S.revs_info=!0),g.latest&&(S.latest=!0),g.open_revs&&(g.open_revs!=="all"&&(g.open_revs=JSON.stringify(g.open_revs)),S.open_revs=g.open_revs),g.rev&&(S.rev=g.rev),g.conflicts&&(S.conflicts=g.conflicts),g.update_seq&&(S.update_seq=g.update_seq),l=Ee(l);function C(d){const u=d._attachments,a=u&&Object.keys(u);if(!u||!a.length)return;async function c(q){const O=u[q],E=Ee(d._id)+"/"+w(q)+"?rev="+d._rev,P=await s(se(r,E));let B;"buffer"in P?B=await P.buffer():B=await P.blob();let U;if(g.binary){const j=Object.getOwnPropertyDescriptor(B.__proto__,"type");(!j||j.set)&&(B.type=O.content_type),U=B}else U=await new Promise(function(j){Vt(B,j)});delete O.stub,delete O.length,O.data=U}const f=a.map(function(q){return function(){return c(q)}});return Us(f,5)}function p(d){return Array.isArray(d)?Promise.all(d.map(function(u){if(u.ok)return C(u.ok)})):C(d)}const h=se(r,l+Ye(S));try{const d=await v(h);g.attachments&&await p(d.data),m(null,d.data)}catch(d){d.docId=l,m(d)}}),n.remove=o("remove",async function(l,g,m,S){let C;typeof g=="string"?(C={_id:l,_rev:g},typeof m=="function"&&(S=m,m={})):(C=l,typeof g=="function"?(S=g,m={}):(S=m,m=g));const p=C._rev||m.rev,h=se(r,Ee(C._id))+"?rev="+p;try{const d=await v(h,{method:"DELETE"});S(null,d.data)}catch(d){S(d)}});function w(l){return l.split("/").map(encodeURIComponent).join("/")}n.getAttachment=o("getAttachment",async function(l,g,m,S){typeof m=="function"&&(S=m,m={});const C=m.rev?"?rev="+m.rev:"",p=se(r,Ee(l))+"/"+w(g)+C;let h;try{const d=await s(p,{method:"GET"});if(!d.ok)throw d;h=d.headers.get("content-type");let u;typeof process<"u",u=await d.blob(),typeof process<"u",S(null,u)}catch(d){S(d)}}),n.removeAttachment=o("removeAttachment",async function(l,g,m,S){const C=se(r,Ee(l)+"/"+w(g))+"?rev="+m;try{const p=await v(C,{method:"DELETE"});S(null,p.data)}catch(p){S(p)}}),n.putAttachment=o("putAttachment",async function(l,g,m,S,C,p){typeof C=="function"&&(p=C,C=S,S=m,m=null);const h=Ee(l)+"/"+w(g);let d=se(r,h);if(m&&(d+="?rev="+m),typeof S=="string"){let u;try{u=Ht(S)}catch{return p(G(Gn,"Attachment is not a valid base64 string"))}S=u?Yt(u,C):""}try{const u=await v(d,{headers:new je({"Content-Type":C}),method:"PUT",body:S});p(null,u.data)}catch(u){p(u)}}),n._bulkDocs=async function(l,g,m){l.new_edits=g.new_edits;try{await y(),await Promise.all(l.docs.map(An));const S=await v(se(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(l)});m(null,S.data)}catch(S){m(S)}},n._put=async function(l,g,m){try{await y(),await An(l);const S=await v(se(r,Ee(l._id)),{method:"PUT",body:JSON.stringify(l)});m(null,S.data)}catch(S){S.docId=l&&l._id,m(S)}},n.allDocs=o("allDocs",async function(l,g){typeof l=="function"&&(g=l,l={}),l=ae(l);const m={};let S,C="GET";l.conflicts&&(m.conflicts=!0),l.update_seq&&(m.update_seq=!0),l.descending&&(m.descending=!0),l.include_docs&&(m.include_docs=!0),l.attachments&&(m.attachments=!0),l.key&&(m.key=JSON.stringify(l.key)),l.start_key&&(l.startkey=l.start_key),l.startkey&&(m.startkey=JSON.stringify(l.startkey)),l.end_key&&(l.endkey=l.end_key),l.endkey&&(m.endkey=JSON.stringify(l.endkey)),typeof l.inclusive_end<"u"&&(m.inclusive_end=!!l.inclusive_end),typeof l.limit<"u"&&(m.limit=l.limit),typeof l.skip<"u"&&(m.skip=l.skip);const p=Ye(m);typeof l.keys<"u"&&(C="POST",S={keys:l.keys});try{const h=await v(se(r,"_all_docs"+p),{method:C,body:JSON.stringify(S)});l.include_docs&&l.attachments&&l.binary&&h.data.rows.forEach(wt),g(null,h.data)}catch(h){g(h)}}),n._changes=function(l){const g="batch_size"in l?l.batch_size:Fs;l=ae(l),l.continuous&&!("heartbeat"in l)&&(l.heartbeat=Js);let m="timeout"in l?l.timeout:30*1e3;"timeout"in l&&l.timeout&&m-l.timeout<Xe&&(m=l.timeout+Xe),"heartbeat"in l&&l.heartbeat&&m-l.heartbeat<Xe&&(m=l.heartbeat+Xe);const S={};"timeout"in l&&l.timeout&&(S.timeout=l.timeout);const C=typeof l.limit<"u"?l.limit:!1;let p=C;if(l.style&&(S.style=l.style),(l.include_docs||l.filter&&typeof l.filter=="function")&&(S.include_docs=!0),l.attachments&&(S.attachments=!0),l.continuous&&(S.feed="longpoll"),l.seq_interval&&(S.seq_interval=l.seq_interval),l.conflicts&&(S.conflicts=!0),l.descending&&(S.descending=!0),l.update_seq&&(S.update_seq=!0),"heartbeat"in l&&l.heartbeat&&(S.heartbeat=l.heartbeat),l.filter&&typeof l.filter=="string"&&(S.filter=l.filter),l.view&&typeof l.view=="string"&&(S.filter="_view",S.view=l.view),l.query_params&&typeof l.query_params=="object")for(const O in l.query_params)Object.prototype.hasOwnProperty.call(l.query_params,O)&&(S[O]=l.query_params[O]);let h="GET",d;l.doc_ids?(S.filter="_doc_ids",h="POST",d={doc_ids:l.doc_ids}):l.selector&&(S.filter="_selector",h="POST",d={selector:l.selector});const u=new AbortController;let a;const c=async function(O,E){if(l.aborted)return;S.since=O,typeof S.since=="object"&&(S.since=JSON.stringify(S.since)),l.descending?C&&(S.limit=p):S.limit=!C||p>g?g:p;const P=se(r,"_changes"+Ye(S)),B={signal:u.signal,method:h,body:JSON.stringify(d)};if(a=O,!l.aborted)try{await y();const U=await v(P,B);E(null,U.data)}catch(U){E(U)}},f={results:[]},q=function(O,E){if(l.aborted)return;let P=0;if(E&&E.results){P=E.results.length,f.last_seq=E.last_seq;let U=null,j=null;typeof E.pending=="number"&&(U=E.pending),(typeof f.last_seq=="string"||typeof f.last_seq=="number")&&(j=f.last_seq),l.query_params,E.results=E.results.filter(function(N){p--;const z=Qt(l)(N);return z&&(l.include_docs&&l.attachments&&l.binary&&wt(N),l.return_docs&&f.results.push(N),l.onChange(N,U,j)),z})}else if(O){l.aborted=!0,l.complete(O);return}E&&E.last_seq&&(a=E.last_seq);const B=C&&p<=0||E&&P<g||l.descending;l.continuous&&!(C&&p<=0)||!B?qe(function(){c(a,q)}):l.complete(null,f)};return c(l.since||0,q),{cancel:function(){l.aborted=!0,u.abort()}}},n.revsDiff=o("revsDiff",async function(l,g,m){typeof g=="function"&&(m=g,g={});try{const S=await v(se(r,"_revs_diff"),{method:"POST",body:JSON.stringify(l)});m(null,S.data)}catch(S){m(S)}}),n._close=function(l){l()},n._destroy=async function(l,g){try{const m=await v(se(r,""),{method:"DELETE"});g(null,m)}catch(m){m.status===404?g(null,{ok:!0}):g(m)}}}jt.valid=function(){return!0};function Hs(e){e.adapter("http",jt,!1),e.adapter("https",jt,!1)}class ke extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ke)}catch{}}}class ot extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ot)}catch{}}}class ut extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ut)}catch{}}}function gr(e,t){return t&&e.then(function(n){qe(function(){t(null,n)})},function(n){qe(function(){t(n)})}),e}function Xs(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&gr(r,n),r}}function Ys(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function bt(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function qn(e){var t=new Set(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function St(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function Cn(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new ut(t)}function $t(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var s=0,o=i.length;s<o;s++){var v=i[s];if(typeof v!="number")throw Cn("_sum");typeof t[s]>"u"?t.push(v):t[s]+=v}}else throw Cn("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var Zs=_e.bind(null,"log"),Vs=Array.isArray,ea=JSON.parse;function yr(e,t){return Wt("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:$t,log:Zs,isArray:Vs,toJSON:ea})}class Nt{constructor(){this.promise=Promise.resolve()}add(t){return this.promise=this.promise.catch(()=>{}).then(()=>t()),this.promise}finish(){return this.promise}}function On(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function ta(e,t){return On(e)+On(t)+"undefined"}async function xn(e,t,n,r,i,s){const o=ta(n,r);let v;if(!i&&(v=e._cachedViews=e._cachedViews||{},v[o]))return v[o];const _=e.info().then(async function(y){const w=y.db_name+"-mrview-"+(i?"temp":Hn(o));function l(p){p.views=p.views||{};let h=t;h.indexOf("/")===-1&&(h=t+"/"+t);const d=p.views[h]=p.views[h]||{};if(!d[w])return d[w]=!0,p}await tt(e,"_local/"+s,l);const m=(await e.registerDependentDatabase(w)).db;m.auto_compaction=!0;const S={name:w,db:m,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let C;try{C=await S.db.get("_local/lastSeq")}catch(p){if(p.status!==404)throw p}return S.seq=C?C.seq:0,v&&S.db.once("destroyed",function(){delete v[o]}),S});return v&&(v[o]=_),_}const En={},kn=new Nt,na=50;function At(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function ra(e){return e.length===1&&/^1-/.test(e[0].rev)}function Dn(e,t,n){try{e.emit("error",t)}catch{_e("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),_e("error",t,n)}}function ia(e,t,n,r){function i(b,A,T){try{A(T)}catch(k){Dn(b,k,{fun:A,doc:T})}}function s(b,A,T,k,R){try{return{output:A(T,k,R)}}catch($){return Dn(b,$,{fun:A,keys:T,values:k,rereduce:R}),{error:$}}}function o(b,A){const T=ne(b.key,A.key);return T!==0?T:ne(b.value,A.value)}function v(b,A,T){return T=T||0,typeof A=="number"?b.slice(T,A+T):T>0?b.slice(T):b}function _(b){const A=b.value;return A&&typeof A=="object"&&A._id||b.id}function y(b){for(const A of b.rows){const T=A.doc&&A.doc._attachments;if(T)for(const k of Object.keys(T)){const R=T[k];T[k].data=Zt(R.data,R.content_type)}}}function w(b){return function(A){return b.include_docs&&b.attachments&&b.binary&&y(A),A}}function l(b,A,T,k){let R=A[b];typeof R<"u"&&(k&&(R=encodeURIComponent(JSON.stringify(R))),T.push(b+"="+R))}function g(b){if(typeof b<"u"){const A=Number(b);return!isNaN(A)&&A===parseInt(b,10)?A:b}}function m(b){return b.group_level=g(b.group_level),b.limit=g(b.limit),b.skip=g(b.skip),b}function S(b){if(b){if(typeof b!="number")return new ke(`Invalid value for integer: "${b}"`);if(b<0)return new ke(`Invalid value for positive integer: "${b}"`)}}function C(b,A){const T=b.descending?"endkey":"startkey",k=b.descending?"startkey":"endkey";if(typeof b[T]<"u"&&typeof b[k]<"u"&&ne(b[T],b[k])>0)throw new ke("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(A.reduce&&b.reduce!==!1){if(b.include_docs)throw new ke("{include_docs:true} is invalid for reduce");if(b.keys&&b.keys.length>1&&!b.group&&!b.group_level)throw new ke("Multi-key fetches for reduce views must use {group: true}")}for(const R of["group_level","limit","skip"]){const $=S(b[R]);if($)throw $}}async function p(b,A,T){let k=[],R,$="GET",F;if(l("reduce",T,k),l("include_docs",T,k),l("attachments",T,k),l("limit",T,k),l("descending",T,k),l("group",T,k),l("group_level",T,k),l("skip",T,k),l("stale",T,k),l("conflicts",T,k),l("startkey",T,k,!0),l("start_key",T,k,!0),l("endkey",T,k,!0),l("end_key",T,k,!0),l("inclusive_end",T,k),l("key",T,k,!0),l("update_seq",T,k),k=k.join("&"),k=k===""?"":"?"+k,typeof T.keys<"u"){const I=`keys=${encodeURIComponent(JSON.stringify(T.keys))}`;I.length+k.length+1<=2e3?k+=(k[0]==="?"?"&":"?")+I:($="POST",typeof A=="string"?R={keys:T.keys}:A.keys=T.keys)}if(typeof A=="string"){const D=At(A),I=await b.fetch("_design/"+D[0]+"/_view/"+D[1]+k,{headers:new je({"Content-Type":"application/json"}),method:$,body:JSON.stringify(R)});F=I.ok;const K=await I.json();if(!F)throw K.status=I.status,Ke(K);for(const M of K.rows)if(M.value&&M.value.error&&M.value.error==="builtin_reduce_error")throw new Error(M.reason);return new Promise(function(M){M(K)}).then(w(T))}R=R||{};for(const D of Object.keys(A))Array.isArray(A[D])?R[D]=A[D]:R[D]=A[D].toString();const L=await b.fetch("_temp_view"+k,{headers:new je({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(R)});F=L.ok;const x=await L.json();if(!F)throw x.status=L.status,Ke(x);return new Promise(function(D){D(x)}).then(w(T))}function h(b,A,T){return new Promise(function(k,R){b._query(A,T,function($,F){if($)return R($);k(F)})})}function d(b){return new Promise(function(A,T){b._viewCleanup(function(k,R){if(k)return T(k);A(R)})})}function u(b){return function(A){if(A.status===404)return b;throw A}}async function a(b,A,T){const k="_local/doc_"+b,R={_id:k,keys:[]},$=T.get(b),F=$[0],L=$[1];function x(){return ra(L)?Promise.resolve(R):A.db.get(k).catch(u(R))}function D(Y){return Y.keys.length?A.db.allDocs({keys:Y.keys,include_docs:!0}):Promise.resolve({rows:[]})}function I(Y,ee){const re=[],le=new Set;for(const X of ee.rows){const H=X.doc;if(H&&(re.push(H),le.add(H._id),H._deleted=!F.has(H._id),!H._deleted)){const Z=F.get(H._id);"value"in Z&&(H.value=Z.value)}}const we=St(F);for(const X of we)if(!le.has(X)){const H={_id:X},Z=F.get(X);"value"in Z&&(H.value=Z.value),re.push(H)}return Y.keys=qn(we.concat(Y.keys)),re.push(Y),re}const K=await x(),M=await D(K);return I(K,M)}function c(b){return b.sourceDB.get("_local/purges").then(function(A){const T=A.purgeSeq;return b.db.get("_local/purgeSeq").then(function(k){return k._rev}).catch(u(void 0)).then(function(k){return b.db.put({_id:"_local/purgeSeq",_rev:k,purgeSeq:T})})}).catch(function(A){if(A.status!==404)throw A})}function f(b,A,T){var k="_local/lastSeq";return b.db.get(k).catch(u({_id:k,seq:0})).then(function(R){var $=St(A);return Promise.all($.map(function(F){return a(F,b,A)})).then(function(F){var L=F.flat();return R.seq=T,L.push(R),b.db.bulkDocs({docs:L})}).then(()=>c(b))})}function q(b){const A=typeof b=="string"?b:b.name;let T=En[A];return T||(T=En[A]=new Nt),T}async function O(b,A){return bt(q(b),function(){return E(b,A)})()}async function E(b,A){let T,k,R;function $(X,H){const Z={id:k._id,key:Be(X)};typeof H<"u"&&H!==null&&(Z.value=Be(H)),T.push(Z)}const F=t(b.mapFun,$);let L=b.seq||0;function x(){return b.sourceDB.info().then(function(X){R=b.sourceDB.activeTasks.add({name:"view_indexing",total_items:X.update_seq-L})})}function D(X,H){return function(){return f(b,X,H)}}let I=0;const K={view:b.name,indexed_docs:I};b.sourceDB.emit("indexing",K);const M=new Nt;async function Y(){const X=await b.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:L,limit:A.changes_batch_size}),H=await ee();return re(X,H)}function ee(){return b.db.get("_local/purgeSeq").then(function(X){return X.purgeSeq}).catch(u(-1)).then(function(X){return b.sourceDB.get("_local/purges").then(function(H){const Z=H.purges.filter(function(de,oe){return oe>X}).map(de=>de.docId),ge=Z.filter(function(de,oe){return Z.indexOf(de)===oe});return Promise.all(ge.map(function(de){return b.sourceDB.get(de).then(function(oe){return{docId:de,doc:oe}}).catch(u({docId:de}))}))}).catch(u([]))})}function re(X,H){const Z=X.results;if(!Z.length&&!H.length)return;for(const oe of H)if(Z.findIndex(function(Me){return Me.id===oe.docId})<0){const Me={_id:oe.docId,doc:{_id:oe.docId,_deleted:1},changes:[]};oe.doc&&(Me.doc=oe.doc,Me.changes.push({rev:oe.doc._rev})),Z.push(Me)}const ge=le(Z);M.add(D(ge,L)),I=I+Z.length;const de={view:b.name,last_seq:X.last_seq,results_count:Z.length,indexed_docs:I};if(b.sourceDB.emit("indexing",de),b.sourceDB.activeTasks.update(R,{completed_items:I}),!(Z.length<A.changes_batch_size))return Y()}function le(X){const H=new Map;for(const Z of X){if(Z.doc._id[0]!=="_"){T=[],k=Z.doc,k._deleted||i(b.sourceDB,F,k),T.sort(o);const ge=we(T);H.set(Z.doc._id,[ge,Z.changes])}L=Z.seq}return H}function we(X){const H=new Map;let Z;for(let ge=0,de=X.length;ge<de;ge++){const oe=X[ge],ct=[oe.key,oe.id];ge>0&&ne(oe.key,Z)===0&&ct.push(ge),H.set(pe(ct),oe),Z=oe.key}return H}try{await x(),await Y(),await M.finish(),b.seq=L,b.sourceDB.activeTasks.remove(R)}catch(X){b.sourceDB.activeTasks.remove(R,X)}}function P(b,A,T){T.group_level===0&&delete T.group_level;const k=T.group||T.group_level,R=n(b.reduceFun),$=[],F=isNaN(T.group_level)?Number.POSITIVE_INFINITY:T.group_level;for(const L of A){const x=$[$.length-1];let D=k?L.key:null;if(k&&Array.isArray(D)&&(D=D.slice(0,F)),x&&ne(x.groupKey,D)===0){x.keys.push([L.key,L.id]),x.values.push(L.value);continue}$.push({keys:[[L.key,L.id]],values:[L.value],groupKey:D})}A=[];for(const L of $){const x=s(b.sourceDB,R,L.keys,L.values,!1);if(x.error&&x.error instanceof ut)throw x.error;A.push({value:x.error?null:x.output,key:L.groupKey})}return{rows:v(A,T.limit,T.skip)}}function B(b,A){return bt(q(b),function(){return U(b,A)})()}async function U(b,A){let T;const k=b.reduceFun&&A.reduce!==!1,R=A.skip||0;typeof A.keys<"u"&&!A.keys.length&&(A.limit=0,delete A.keys);async function $(L){L.include_docs=!0;const x=await b.db.allDocs(L);return T=x.total_rows,x.rows.map(function(D){if("value"in D.doc&&typeof D.doc.value=="object"&&D.doc.value!==null){const K=Object.keys(D.doc.value).sort(),M=["id","key","value"];if(!(K<M||K>M))return D.doc.value}const I=Hi(D.doc._id);return{key:I[0],id:I[1],value:"value"in D.doc?D.doc.value:null}})}async function F(L){let x;if(k?x=P(b,L,A):typeof A.keys>"u"?x={total_rows:T,offset:R,rows:L}:x={total_rows:T,offset:R,rows:v(L,A.limit,A.skip)},A.update_seq&&(x.update_seq=b.seq),A.include_docs){const D=qn(L.map(_)),I=await b.sourceDB.allDocs({keys:D,include_docs:!0,conflicts:A.conflicts,attachments:A.attachments,binary:A.binary}),K=new Map;for(const M of I.rows)K.set(M.id,M.doc);for(const M of L){const Y=_(M),ee=K.get(Y);ee&&(M.doc=ee)}}return x}if(typeof A.keys<"u"){const x=A.keys.map(function(K){const M={startkey:pe([K]),endkey:pe([K,{}])};return A.update_seq&&(M.update_seq=!0),$(M)}),I=(await Promise.all(x)).flat();return F(I)}else{const L={descending:A.descending};A.update_seq&&(L.update_seq=!0);let x,D;if("start_key"in A&&(x=A.start_key),"startkey"in A&&(x=A.startkey),"end_key"in A&&(D=A.end_key),"endkey"in A&&(D=A.endkey),typeof x<"u"&&(L.startkey=A.descending?pe([x,{}]):pe([x])),typeof D<"u"){let K=A.inclusive_end!==!1;A.descending&&(K=!K),L.endkey=pe(K?[D,{}]:[D])}if(typeof A.key<"u"){const K=pe([A.key]),M=pe([A.key,{}]);L.descending?(L.endkey=K,L.startkey=M):(L.startkey=K,L.endkey=M)}k||(typeof A.limit=="number"&&(L.limit=A.limit),L.skip=R);const I=await $(L);return F(I)}}async function j(b){return(await b.fetch("_view_cleanup",{headers:new je({"Content-Type":"application/json"}),method:"POST"})).json()}async function N(b){try{const A=await b.get("_local/"+e),T=new Map;for(const x of Object.keys(A.views)){const D=At(x),I="_design/"+D[0],K=D[1];let M=T.get(I);M||(M=new Set,T.set(I,M)),M.add(K)}const k={keys:St(T),include_docs:!0},R=await b.allDocs(k),$={};for(const x of R.rows){const D=x.key.substring(8);for(const I of T.get(x.key)){let K=D+"/"+I;A.views[K]||(K=I);const M=Object.keys(A.views[K]),Y=x.doc&&x.doc.views&&x.doc.views[I];for(const ee of M)$[ee]=$[ee]||Y}}const L=Object.keys($).filter(function(x){return!$[x]}).map(function(x){return bt(q(x),function(){return new b.constructor(x,b.__opts).destroy()})()});return Promise.all(L).then(function(){return{ok:!0}})}catch(A){if(A.status===404)return{ok:!0};throw A}}async function z(b,A,T){if(typeof b._query=="function")return h(b,A,T);if(Ae(b))return p(b,A,T);const k={changes_batch_size:b.__opts.view_update_changes_batch_size||na};if(typeof A!="string")return C(T,A),kn.add(async function(){const R=await xn(b,"temp_view/temp_view",A.map,A.reduce,!0,e);return Ys(O(R,k).then(function(){return B(R,T)}),function(){return R.db.destroy()})}),kn.finish();{const R=A,$=At(R),F=$[0],L=$[1],x=await b.get("_design/"+F);if(A=x.views&&x.views[L],!A)throw new ot(`ddoc ${x._id} has no view named ${L}`);r(x,L),C(T,A);const D=await xn(b,R,A.map,A.reduce,!1,e);return T.stale==="ok"||T.stale==="update_after"?(T.stale==="update_after"&&qe(function(){O(D,k)}),B(D,T)):(await O(D,k),B(D,T))}}function Q(b,A,T){const k=this;typeof A=="function"&&(T=A,A={}),A=A?m(A):{},typeof b=="function"&&(b={map:b});const R=Promise.resolve().then(function(){return z(k,b,A)});return gr(R,T),R}const W=Xs(function(){const b=this;return typeof b._viewCleanup=="function"?d(b):Ae(b)?j(b):N(b)});return{query:Q,viewCleanup:W}}var qt={_sum:function(e,t){return $t(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,s=0,o=r.length;s<o;s++){var v=r[s];i+=v*v}return i}return{sum:$t(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function sa(e){if(/^_sum/.test(e))return qt._sum;if(/^_count/.test(e))return qt._count;if(/^_stats/.test(e))return qt._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function aa(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return yr(e.toString(),t)}function oa(e){var t=e.toString(),n=sa(t);return n||yr(t)}function ua(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new ot("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var ca="mrviews",pr=ia(ca,aa,oa,ua);function fa(e,t,n){return pr.query.call(this,e,t,n)}function la(e){return pr.viewCleanup.call(this,e)}var da={query:fa,viewCleanup:la};function ha(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Tn(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function va(e,t,n){var r=Ae(t)&&!Ae(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(s){return Promise.all(i.map(function(o){return ha(s,n,o)?t.getAttachment(n._id,o):e.getAttachment(s._id,o)}))}).catch(function(s){if(s.status!==404)throw s;return Tn(t,n)}):Tn(t,n)}function _a(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function ga(e,t,n,r){n=ae(n);var i=[],s=!0;function o(){var _=_a(n);if(_.docs.length)return e.bulkGet(_).then(function(y){if(r.cancelled)throw new Error("cancelled");return Promise.all(y.results.map(function(w){return Promise.all(w.docs.map(function(l){var g=l.ok;return l.error&&(s=!1),!g||!g._attachments?g:va(t,e,g).then(m=>{var S=Object.keys(g._attachments);return m.forEach(function(C,p){var h=g._attachments[S[p]];delete h.stub,delete h.length,h.data=C}),g})}))})).then(function(w){i=i.concat(w.flat().filter(Boolean))})})}function v(){return{ok:s,docs:i}}return Promise.resolve().then(o).then(v)}var Pn=1,Rn="pouchdb",ya=5,ye=0;function Kt(e,t,n,r,i){return e.get(t).catch(function(s){if(s.status===404)return(e.adapter==="http"||e.adapter==="https")&&xt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Rn,version:Pn};throw s}).then(function(s){if(!i.cancelled&&s.last_seq!==n)return s.history=(s.history||[]).filter(function(o){return o.session_id!==r}),s.history.unshift({last_seq:n,session_id:r}),s.history=s.history.slice(0,ya),s.version=Pn,s.replicator=Rn,s.session_id=r,s.last_seq=n,e.put(s).catch(function(o){if(o.status===409)return Kt(e,t,n,r,i);throw o})})}class Ln{constructor(t,n,r,i,s={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0}){this.src=t,this.target=n,this.id=r,this.returnValue=i,this.opts=s,typeof s.writeSourceCheckpoint>"u"&&(s.writeSourceCheckpoint=!0),typeof s.writeTargetCheckpoint>"u"&&(s.writeTargetCheckpoint=!0)}writeCheckpoint(t,n){var r=this;return this.updateTarget(t,n).then(function(){return r.updateSource(t,n)})}updateTarget(t,n){return this.opts.writeTargetCheckpoint?Kt(this.target,this.id,t,n,this.returnValue):Promise.resolve(!0)}updateSource(t,n){if(this.opts.writeSourceCheckpoint){var r=this;return Kt(this.src,this.id,t,n,this.returnValue).catch(function(i){if(In(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var t=this;return!t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?Promise.resolve(ye):t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(n){return n.last_seq||ye}).catch(function(n){if(n.status!==404)throw n;return ye}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||ye:t.src.get(t.id).then(function(r){if(n.version!==r.version)return ye;var i;return n.version?i=n.version.toString():i="undefined",i in Bn?Bn[i](n,r):ye},function(r){if(r.status===404&&n.last_seq)return t.src.put({_id:t.id,last_seq:ye}).then(function(){return ye},function(i){return In(i)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):ye});throw r})}).catch(function(n){if(n.status!==404)throw n;return ye})}}var Bn={undefined:function(e,t){return ne(e.last_seq,t.last_seq)===0?t.last_seq:0},1:function(e,t){return pa(t,e).last_seq}};function pa(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:mr(e.history,t.history)}function mr(e,t){var n=e[0],r=e.slice(1),i=t[0],s=t.slice(1);if(!n||t.length===0)return{last_seq:ye,history:[]};var o=n.session_id;if(Mt(o,t))return{last_seq:n.last_seq,history:e};var v=i.session_id;return Mt(v,r)?{last_seq:i.last_seq,history:s}:mr(r,s)}function Mt(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:Mt(e,r)}function In(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}function wr(e,t,n,r,i){return this instanceof Ln?wr:new Ln(e,t,n,r,i)}var jn=0;function ma(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=Ur),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=jn},s=function(){t.removeListener("active",i)};t.once("paused",s),t.once("active",i)}e.current_back_off=e.current_back_off||jn,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function wa(e){return Object.keys(e).sort(ne).reduce(function(t,n){return t[n]=e[n],t},{})}function ba(e,t,n){var r=n.doc_ids?n.doc_ids.sort(ne):"",i=n.filter?n.filter.toString():"",s="",o="",v="";return n.selector&&(v=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify(wa(n.query_params))),n.filter&&n.filter==="_view"&&(o=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(_){var y=_[0]+_[1]+i+o+s+r+v;return new Promise(function(w){en(y,w)})}).then(function(_){return _=_.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+_})}function br(e,t,n,r,i){var s=[],o,v={seq:0,changes:[],docs:[]},_=!1,y=!1,w=!1,l=0,g=0,m=n.continuous||n.live||!1,S=n.batch_size||100,C=n.batches_limit||10,p=n.style||"all_docs",h=!1,d=n.doc_ids,u=n.selector,a,c,f=[],q=at(),O;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var E={};r.ready(e,t);function P(){return c?Promise.resolve():ba(e,t,n).then(function(x){a=x;var D={};n.checkpoint===!1?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},c=new wr(e,t,a,r,D)})}function B(){if(f=[],o.docs.length!==0){var x=o.docs,D={timeout:n.timeout};return t.bulkDocs({docs:x,new_edits:!1},D).then(function(I){if(r.cancelled)throw b(),new Error("cancelled");var K=Object.create(null);I.forEach(function(Y){Y.error&&(K[Y.id]=Y)});var M=Object.keys(K).length;i.doc_write_failures+=M,i.docs_written+=x.length-M,x.forEach(function(Y){var ee=K[Y._id];if(ee){i.errors.push(ee);var re=(ee.name||"").toLowerCase();if(re==="unauthorized"||re==="forbidden")r.emit("denied",ae(ee));else throw ee}else f.push(Y)})},function(I){throw i.doc_write_failures+=x.length,I})}}function U(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=g=o.seq;var x=ae(i);return f.length&&(x.docs=f,typeof o.pending=="number"&&(x.pending=o.pending,delete o.pending),r.emit("change",x)),_=!0,e.info().then(function(D){var I=e.activeTasks.get(O);if(!(!o||!I)){var K=I.completed_items||0,M=parseInt(D.update_seq,10)-parseInt(l,10);e.activeTasks.update(O,{completed_items:K+o.changes.length,total_items:M})}}),c.writeCheckpoint(o.seq,q).then(function(){if(r.emit("checkpoint",{checkpoint:o.seq}),_=!1,r.cancelled)throw b(),new Error("cancelled");o=void 0,R()}).catch(function(D){throw L(D),D})}function j(){var x={};return o.changes.forEach(function(D){r.emit("checkpoint",{revs_diff:D}),D.id!=="_user/"&&(x[D.id]=D.changes.map(function(I){return I.rev}))}),t.revsDiff(x).then(function(D){if(r.cancelled)throw b(),new Error("cancelled");o.diffs=D})}function N(){return ga(e,t,o.diffs,r).then(function(x){o.error=!x.ok,x.docs.forEach(function(D){delete o.diffs[D._id],i.docs_read++,o.docs.push(D)})})}function z(){if(!(r.cancelled||o)){if(s.length===0){Q(!0);return}o=s.shift(),r.emit("checkpoint",{start_next_batch:o.seq}),j().then(N).then(B).then(U).then(z).catch(function(x){W("batch processing terminated with error",x)})}}function Q(x){if(v.changes.length===0){s.length===0&&!o&&((m&&E.live||y)&&(r.state="pending",r.emit("paused")),y&&b());return}(x||y||v.changes.length>=S)&&(s.push(v),v={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function W(x,D){w||(D.message||(D.message=x),i.ok=!1,i.status="aborting",s=[],v={seq:0,changes:[],docs:[]},b(D))}function b(x){if(!w&&!(r.cancelled&&(i.status="cancelled",_)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=g,w=!0,e.activeTasks.remove(O,x),x){x=G(x),x.result=i;var D=(x.name||"").toLowerCase();D==="unauthorized"||D==="forbidden"?(r.emit("error",x),r.removeAllListeners()):ma(n,r,x,function(){br(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function A(x,D,I){if(r.cancelled)return b();typeof D=="number"&&(v.pending=D);var K=Qt(n)(x);if(!K){var M=e.activeTasks.get(O);if(M){var Y=M.completed_items||0;e.activeTasks.update(O,{completed_items:++Y})}return}v.seq=x.seq||I,v.changes.push(x),r.emit("checkpoint",{pending_batch:v.seq}),qe(function(){Q(s.length===0&&E.live)})}function T(x){if(h=!1,r.cancelled)return b();if(x.results.length>0)E.since=x.results[x.results.length-1].seq,R(),Q(!0);else{var D=function(){m?(E.live=!0,R()):y=!0,Q(!0)};!o&&x.results.length===0?(_=!0,c.writeCheckpoint(x.last_seq,q).then(function(){if(_=!1,i.last_seq=g=x.last_seq,r.cancelled)throw b(),new Error("cancelled");D()}).catch(L)):D()}}function k(x){if(h=!1,r.cancelled)return b();W("changes rejected",x)}function R(){if(!(!h&&!y&&s.length<C))return;h=!0;function x(){I.cancel()}function D(){r.removeListener("cancel",x)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",x);var I=e.changes(E).on("change",A);I.then(D,D),I.then(T).catch(k),n.retry&&(r._changes=I,r._abortChanges=x)}function $(x){return e.info().then(function(D){var I=typeof n.since>"u"?parseInt(D.update_seq,10)-parseInt(x,10):parseInt(D.update_seq,10);return O=e.activeTasks.add({name:`${m?"continuous ":""}replication from ${D.db_name}`,total_items:I}),x})}function F(){P().then(function(){if(r.cancelled){b();return}return c.getCheckpoint().then($).then(function(x){g=x,l=x,E={since:g,limit:S,batch_size:S,style:p,doc_ids:d,selector:u,return_docs:!0},n.filter&&(typeof n.filter!="string"?E.include_docs=!0:E.filter=n.filter),"heartbeat"in n&&(E.heartbeat=n.heartbeat),"timeout"in n&&(E.timeout=n.timeout),n.query_params&&(E.query_params=n.query_params),n.view&&(E.view=n.view),R()})}).catch(function(x){W("getCheckpoint rejected with ",x)})}function L(x){_=!1,W("writeCheckpoint completed with error",x)}if(r.cancelled){b();return}r._addedListeners||(r.once("cancel",b),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(x){n.complete(null,x)})),r._addedListeners=!0),typeof n.since>"u"?F():P().then(function(){return _=!0,c.writeCheckpoint(n.since,q)}).then(function(){if(_=!1,r.cancelled){b();return}g=n.since,F()}).catch(L)}class Sa extends Oe{constructor(){super(),this.cancelled=!1,this.state="pending";const t=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return t.then(n,r)},this.catch=function(n){return t.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(t,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};t.once("destroyed",r),n.once("destroyed",r);function i(){t.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function it(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function Ut(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw G(st,"`doc_ids` filter parameter is not a list.");n.complete=r,n=ae(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new Sa(n),s=it(e,n),o=it(t,n);return br(s,o,n,i),i}function Aa(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=ae(n),n.PouchConstructor=n.PouchConstructor||this,e=it(e,n),t=it(t,n),new qa(e,t,n,r)}class qa extends Oe{constructor(t,n,r,i){super(),this.canceled=!1;const s=r.push?Object.assign({},r,r.push):r,o=r.pull?Object.assign({},r,r.pull):r;this.push=Ut(t,n,s),this.pull=Ut(n,t,o),this.pushPaused=!0,this.pullPaused=!0;const v=u=>{this.emit("change",{direction:"pull",change:u})},_=u=>{this.emit("change",{direction:"push",change:u})},y=u=>{this.emit("denied",{direction:"push",doc:u})},w=u=>{this.emit("denied",{direction:"pull",doc:u})},l=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},g=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},m=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},S=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let C={};const p=u=>(a,c)=>{(a==="change"&&(c===v||c===_)||a==="denied"&&(c===w||c===y)||a==="paused"&&(c===g||c===l)||a==="active"&&(c===S||c===m))&&(a in C||(C[a]={}),C[a][u]=!0,Object.keys(C[a]).length===2&&this.removeAllListeners(a))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function h(u,a,c){u.listeners(a).indexOf(c)==-1&&u.on(a,c)}this.on("newListener",function(u){u==="change"?(h(this.pull,"change",v),h(this.push,"change",_)):u==="denied"?(h(this.pull,"denied",w),h(this.push,"denied",y)):u==="active"?(h(this.pull,"active",S),h(this.push,"active",m)):u==="paused"&&(h(this.pull,"paused",g),h(this.push,"paused",l))}),this.on("removeListener",function(u){u==="change"?(this.pull.removeListener("change",v),this.push.removeListener("change",_)):u==="denied"?(this.pull.removeListener("denied",w),this.push.removeListener("denied",y)):u==="active"?(this.pull.removeListener("active",S),this.push.removeListener("active",m)):u==="paused"&&(this.pull.removeListener("paused",g),this.push.removeListener("paused",l))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));const d=Promise.all([this.push,this.pull]).then(u=>{const a={push:u[0],pull:u[1]};return this.emit("complete",a),i&&i(null,a),this.removeAllListeners(),a},u=>{if(this.cancel(),i?i(u):this.emit("error",u),this.removeAllListeners(),i)throw u});this.then=function(u,a){return d.then(u,a)},this.catch=function(u){return d.catch(u)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function Ca(e){e.replicate=Ut,e.sync=Aa,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}J.plugin(Ms).plugin(Hs).plugin(da).plugin(Ca);export{J as P};
