import{f as rt,r as i,g,B as vt,h as mt,c as m,a as e,m as ft,i as M,b as p,d as R,F as W,k as E,C as J,t as c,D as Q,E as O,q as pt,l as X,w as bt,p as _t,e as gt,o as d,j as wt}from"./BjQOlzC4.js";import{_ as yt}from"./D6PprTov.js";import{P as ht}from"./BYoDscgR.js";import{p as xt}from"./C9ZjJIze.js";const kt={class:"text-lg"},St={class:"flex justify-end items-center mb-6"},Ct={class:"flex flex-wrap justify-end gap-4 items-center"},Mt={class:"dropdown dropdown-sm"},Rt={tabindex:"0",class:"btn m-1"},It={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},Tt={class:"label cursor-pointer justify-start gap-2"},jt=["value"],Lt={class:"label-text"},$t={class:"w-full flex flex-col items-center justify-center"},Ht={class:"stats shadow mb-2 w-full lg:w-1/2"},Bt={class:"stat"},Dt={class:"stat-value"},Nt={class:"stat"},Vt={class:"stat-value text-success"},Wt={class:"stat"},Et={class:"stat-value text-error"},Ot={class:"stat"},Ut={class:"stat-value"},Pt={class:"w-full flex justify-end items-center pb-4"},zt={class:"flex items-center gap-2 ml-4"},At=["disabled"],Ft=["disabled"],Gt={class:"card-body items-center text-center"},qt={class:"card-title text-6xl mb-4 py-6"},Kt=["innerHTML"],Jt={class:"flex gap-4"},Qt={class:"flex flex-wrap justify-start items-center gap-2 mt-2 text-gray-300"},Xt={key:1,class:"text-center py-12"},Yt={key:2,class:"text-center py-12"},Zt={key:3,class:"flex justify-center gap-2 my-4"},te={class:"dropdown"},ee=["value"],se={class:"modal"},ae={class:"modal-box relative"},le={class:"mb-2"},oe={class:"mb-2 text-success"},ne={class:"mb-4 text-error"},ie={class:"modal-box w-full"},ce={class:"w-2/3 mx-center stats stats-vertical shadow"},ue={class:"stat"},de={class:"stat-value"},re={class:"stat"},ve={class:"stat-value text-success"},me={class:"stat-desc"},fe={class:"stat"},pe={class:"stat-value text-error"},be={class:"stat-desc"},_e={class:"stat"},ge={class:"stat-value"},we={class:"modal-action"},Ce=rt({__name:"practice",setup(ye){const I=new ht("flashcards"),Y=i(xt.languages),T=i("th-TH"),Z=i({pronunciationLanguage:"th-TH"}),y=i([]),f=i(0),r=i(!1),b=i(!0),S=i([]),h=i(!1),_=i([]),x=i(0);i(!1),i("");const $=i(!1),H=i(void 0);i(!1),i(!1);const U=i({word:"",meaning:"",tagsInput:""}),v=i({}),j=g(()=>y.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.correct)||0)},0)),B=g(()=>y.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.incorrect)||0)},0)),D=g(()=>j.value+B.value),N=g(()=>{const a=D.value;return a>0?Math.round(j.value/a*100):0}),L=g(()=>{const a=Object.values(v.value);return{totalPlayed:a.reduce((t,s)=>t+s.played,0),totalCorrect:a.reduce((t,s)=>t+s.correct,0),totalIncorrect:a.reduce((t,s)=>t+s.incorrect,0),avgSuccessRate:a.length>0?Math.round(a.reduce((t,s)=>t+s.successRate,0)/a.length):0}}),tt=g(()=>[...new Set(V.value.flatMap(a=>a.tags))]),k=g(()=>V.value.filter(a=>S.value.length===0||S.value.some(t=>a.tags.includes(t)))),u=g(()=>k.value[f.value]||null),et=g(()=>{var a;return((a=u.value)==null?void 0:a.meaning.replace(/\n/g,"<br>"))||""}),V=i([]);async function st(){const t=(await I.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var o;return s.word&&!((o=s._id)!=null&&o.startsWith("_design"))});y.value=t.map(s=>{var o,n,l;return{...s,tags:s.tags||[],stats:{correct:((o=s.stats)==null?void 0:o.correct)||0,incorrect:((n=s.stats)==null?void 0:n.incorrect)||0,lastSeen:((l=s.stats)==null?void 0:l.lastSeen)||Date.now()}}}),V.value=[...y.value],b.value&&C()}function C(){f.value=0,r.value=!1,y.value=[...k.value].sort(()=>Math.random()-.5)}function at(){b.value=!b.value,r.value=!1,b.value?C():f.value=0}function lt(){r.value||(r.value=!0)}async function P(a){var l,w,G,q,K;if(!((l=u.value)!=null&&l._id))return;const t=await I.get(u.value._id),s={correct:((w=t.stats)==null?void 0:w.correct)||0,incorrect:((G=t.stats)==null?void 0:G.incorrect)||0,lastSeen:((q=t.stats)==null?void 0:q.lastSeen)||Date.now()},o=a?"correct":"incorrect";s[o]=(Number(s[o])||0)+1,s.lastSeen=Date.now(),await I.put({...t,stats:s}),u.value.stats&&(u.value.stats[a?"correct":"incorrect"]++,u.value.stats.lastSeen=s.lastSeen),u.value._id&&!_.value.includes(u.value._id)&&_.value.push(u.value._id);const n=((K=u.value)==null?void 0:K._id)||"";v.value[n]||(v.value[n]={played:0,correct:0,incorrect:0,successRate:0}),v.value[n].played++,a?v.value[n].correct++:v.value[n].incorrect++,v.value[n].successRate=v.value[n].played>0?Math.round(v.value[n].correct/v.value[n].played*100):0,r.value=!1,ot()}function ot(){b.value?Math.random()<.75?(console.log("shuffle"),C()):(console.log("getLowestSuccessRateWords"),z()):Math.random()>=.75&&z(),f.value<k.value.length-1?f.value++:f.value=0,r.value=!1,x.value=-1}function z(a=1){const t=Object.entries(v.value).filter(([s,o])=>o.played>0&&o.successRate<80).sort((s,o)=>s[1].successRate-o[1].successRate).slice(0,a).map(([s,o])=>{var n;return{wordId:s,word:((n=y.value.find(l=>l._id===s))==null?void 0:n.word)||s,successRate:o.successRate}});if(t.length>0){const s=t[0],o=y.value.find(n=>n._id===s.wordId);if(o){const n=k.value.filter(l=>l._id!==s.wordId).toSpliced(f.value+1,0,o);k.value=[...n]}}return console.log("lowestWords",t),t}function nt(a){var l;if(typeof window>"u"||!window.speechSynthesis)return;const t=new SpeechSynthesisUtterance(((l=u.value)==null?void 0:l.word)||""),s={th:"th-TH",en:"en-US",zh:"zh-CN"};t.lang=s[a]??"en-US";const o=window.speechSynthesis.getVoices(),n=o.find(w=>w.lang===t.lang)||o.find(w=>w.lang.startsWith(t.lang.slice(0,2)));n&&(t.voice=n),window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}function it(){h.value=!0}function A(){h.value=!1,r.value=!1,_.value=[],x.value=-1,b.value?C():f.value=0}function F(a){if(_.value.length===0)return;let t=x.value+a;if(t<0?t=_.value.length-1:t>=_.value.length&&(t=0),x.value=t,x.value>=0){const s=_.value[x.value],o=k.value.findIndex(n=>n._id===s);o>=0&&(f.value=o,r.value=!0)}}vt(S,()=>{f.value=0,r.value=!1,b.value&&C()});async function ct(){try{const a=await I.get("app_settings");Z.value={pronunciationLanguage:a.pronunciationLanguage||"th-TH"},T.value=a.pronunciationLanguage||"th-TH"}catch(a){console.error("Failed to load settings:",a)}}function ut(a){a?(H.value=a,U.value={word:a.word,meaning:a.meaning,tagsInput:a.tags.join(", ")}):(H.value=void 0,U.value={word:"",meaning:"",tagsInput:""}),setTimeout(()=>{dt("edit-modal")},40)}function dt(a=""){const t=document.getElementById(a);t==null||t.classList.add("modal-open")}return mt(()=>{st(),ct()}),(a,t)=>{const s=wt,o=gt,n=yt;return d(),m("div",kt,[e("div",St,[e("div",Ct,[e("div",Mt,[e("label",Rt,[p(s,{name:"material-symbols:label-important-rounded"}),t[11]||(t[11]=R(" Tags "))]),e("ul",It,[(d(!0),m(W,null,E(tt.value,l=>(d(),m("li",{key:l},[e("label",Tt,[M(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=w=>S.value=w),value:l,class:"checkbox"},null,8,jt),[[X,S.value]]),e("span",Lt,c(l),1)])]))),128))])]),e("button",{class:"btn btn-sm",onClick:at},[b.value?(d(),J(s,{key:0,name:"fe:random"})):(d(),J(s,{key:1,name:"lineicons:sort-amount-asc"})),R(" "+c(b.value?"Random":"A->B"),1)]),e("div",{onClick:t[1]||(t[1]=l=>$.value=!0)},[p(s,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto mb-1"})]),e("button",{class:"btn btn-error btn-xs",onClick:it},[p(s,{name:"ic:baseline-stop-circle"}),t[12]||(t[12]=R(" End "))])])]),e("div",$t,[e("div",Ht,[e("div",Bt,[t[13]||(t[13]=e("div",{class:"stat-title"},"à¹€à¸¥à¹ˆà¸™",-1)),e("div",Dt,c(L.value.totalPlayed),1)]),e("div",Nt,[t[14]||(t[14]=e("div",{class:"stat-title"},"à¸–à¸¹à¸",-1)),e("div",Vt,c(L.value.totalCorrect),1)]),e("div",Wt,[t[15]||(t[15]=e("div",{class:"stat-title"},"à¸œà¸´à¸”",-1)),e("div",Et,c(L.value.totalIncorrect),1)]),e("div",Ot,[t[16]||(t[16]=e("div",{class:"stat-title"},"à¸­à¸±à¸•à¸£à¸²à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ",-1)),e("div",Ut,c(L.value.avgSuccessRate)+"%",1)])])]),e("div",Pt,[e("div",zt,[e("button",{class:"btn btn-sm btn-outline",disabled:_.value.length===0,onClick:t[2]||(t[2]=l=>F(-1))},[p(s,{name:"material-symbols:arrow-back"})],8,At),e("button",{class:"btn btn-sm btn-outline",disabled:_.value.length===0,onClick:t[3]||(t[3]=l=>F(1))},[p(s,{name:"material-symbols:arrow-forward"})],8,Ft)])]),u.value&&!h.value?(d(),m("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:lt},[e("div",{onClick:t[4]||(t[4]=l=>ut(u.value)),class:"absolute top-2 right-2"},[p(s,{name:"material-symbols:edit-square-outline"})]),e("div",Gt,[e("h2",qt,c(u.value.word),1),M(e("p",{class:"text-xl mb-4",innerHTML:et.value},null,8,Kt),[[Q,r.value]]),M(e("div",Jt,[e("button",{class:"btn btn-success",onClick:t[5]||(t[5]=O(l=>P(!0),["stop"]))},"OK"),e("button",{class:"btn btn-error",onClick:t[6]||(t[6]=O(l=>P(!1),["stop"]))},"Again")],512),[[Q,r.value]])]),e("div",Qt,[(d(!0),m(W,null,E(u.value.tags,l=>(d(),m("span",{key:l,class:"badge badge-sm"},c(l),1))),128))])])):h.value?(d(),m("div",Yt,t[18]||(t[18]=[e("p",null,"No cards available.",-1)]))):(d(),m("div",Xt,[t[17]||(t[17]=e("p",{class:"text-xl mb-4"},"No Words Selected",-1)),e("button",{class:"btn btn-primary",onClick:A},"Start")])),u.value&&!h.value?(d(),m("div",Zt,[e("div",te,[M(e("select",{"onUpdate:modelValue":t[7]||(t[7]=l=>T.value=l),class:"select select-bordered w-full"},[(d(!0),m(W,null,E(Y.value,l=>(d(),m("option",{key:l.code,value:l.code},c(l.name),9,ee))),128))],512),[[pt,T.value]])]),e("button",{class:"btn",onClick:t[8]||(t[8]=O(l=>nt(T.value),["stop"]))},[p(s,{name:"material-symbols:volume-up"}),t[19]||(t[19]=R(" à¸­à¹ˆà¸²à¸™à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡ "))])])):ft("",!0),M(e("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":t[9]||(t[9]=l=>h.value=l)},null,512),[[X,h.value]]),e("div",se,[e("div",ae,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold mb-4"},"à¸ˆà¸šà¹€à¸à¸¡à¹à¸¥à¹‰à¸§ ðŸŽ‰",-1)),e("p",le,"à¸„à¸³à¸—à¸µà¹ˆà¸—à¸²à¸¢à¹„à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: "+c(D.value),1),e("p",oe,"à¸ˆà¸³à¸™à¸§à¸™à¸„à¸³à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: "+c(j.value),1),e("p",ne,"à¸ˆà¸³à¸™à¸§à¸™à¸„à¸³à¸—à¸µà¹ˆà¸œà¸´à¸”à¸žà¸¥à¸²à¸”: "+c(B.value),1),e("div",{class:"modal-action"},[e("button",{class:"btn btn-primary",onClick:A},"à¹€à¸¥à¹ˆà¸™à¹ƒà¸«à¸¡à¹ˆ")])])]),e("dialog",{id:"stats_modal",class:_t(["modal",{"modal-open":$.value}])},[e("div",ie,[t[27]||(t[27]=e("h3",{class:"w-full flex justify-center items-center font-bold text-lg mb-4"},"Overall Statistics",-1)),e("div",ce,[e("div",ue,[t[21]||(t[21]=e("div",{class:"stat-title"},"Total Plays",-1)),e("div",de,c(D.value),1)]),e("div",re,[t[22]||(t[22]=e("div",{class:"stat-title"},"Correct",-1)),e("div",ve,c(j.value),1),e("div",me,c(N.value)+"% ",1)]),e("div",fe,[t[23]||(t[23]=e("div",{class:"stat-title"},"Incorrect",-1)),e("div",pe,c(B.value),1),e("div",be,c(100-N.value)+"%",1)]),e("div",_e,[t[24]||(t[24]=e("div",{class:"stat-title"},"Success Rate",-1)),e("div",ge,c(N.value)+"%",1),t[25]||(t[25]=e("div",{class:"stat-desc"},"Overall success rate",-1))])]),e("div",we,[p(o,{to:"/stat",class:"btn btn-secondary"},{default:bt(()=>[p(s,{name:"material-symbols:bar-chart-4-bars"}),t[26]||(t[26]=R(" Stats "))]),_:1,__:[26]}),e("button",{class:"btn",onClick:t[10]||(t[10]=l=>$.value=!1)},"Close")])])],2),p(n,{id:"edit-modal",card:H.value},null,8,["card"])])}}});export{Ce as default};
