import{f as ee,r as o,g as A,h as te,c as m,a as e,l as _,v as M,F as L,k as P,t as i,j as se,m as le,p as K,d as x,b as I,n as O,o as d,q as ne,i as oe}from"./BOeNQzT5.js";import{P as ae}from"./BYoDscgR.js";import{u as ie}from"./BOpmqxdM.js";const de={class:"flex gap-4 mb-6 flex-wrap"},ue={class:"dropdown"},re={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-[1] max-h-96 overflow-y-auto"},ce={class:"cursor-pointer flex gap-2"},ve=["value"],me={class:"flex justify-center my-8"},be={class:"btn-group"},pe=["disabled"],fe={class:"btn"},ge=["disabled"],we={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},_e={class:"card-body"},xe={class:"card-title"},ye={class:"flex flex-wrap gap-2 mt-2"},he={class:"card-actions justify-end mt-4"},ke=["onClick"],Ce=["onClick"],Ae={class:"flex justify-center mt-8"},Me={class:"btn-group"},Ie=["disabled"],De={class:"btn"},Ve=["disabled"],je={class:"modal-box relative max-w-2xl"},Le={key:0,role:"alert",class:"alert alert-info shadow-lg mb-6"},Pe={class:"text-xl font-bold mb-6"},Be={class:"form-control"},Te={class:"form-control"},$e={class:"label flex justify-between items-center"},Fe=["disabled"],Ue={class:"form-control"},ze={class:"modal-action mt-2"},Ee={type:"submit",class:"btn btn-primary"},Ne={class:"modal-box"},Se={class:"modal-action"},B=10,Ge=ee({__name:"cards",setup(qe){const b=new ae("flashcards"),D=o(!1),T=o(""),y=o([]),w=o(""),h=o([]),u=o(null),p=o(null),V=o(!1),k=o(!1),f=o(!1),n=o({word:"",meaning:"",tagsInput:""}),a=o(1),{getMeaning:Q}=ie(),G=A(()=>Array.from(new Set(y.value.flatMap(s=>s.tags)))),$=A(()=>y.value.filter(s=>{const t=w.value?s.word&&s.word.toLowerCase().includes(w.value.toLowerCase())||s.meaning&&s.meaning.toLowerCase().includes(w.value.toLowerCase()):!0,r=!h.value.length||s.tags&&h.value.every(g=>s.tags.includes(g));return t&&r&&s.word}).sort((s,t)=>(t.updatedAt||0)-(s.updatedAt||0))),F=A(()=>Math.ceil($.value.length/B)),H=A(()=>{const s=(a.value-1)*B,t=s+B;return $.value.slice(s,t)});function J(){U()}function U(s){s?(u.value=s,n.value={word:s.word,meaning:s.meaning,tagsInput:s.tags.join(", ")}):(u.value=null,n.value={word:"",meaning:"",tagsInput:""}),V.value=!0}function C(){V.value=!1,u.value=null}function R(s){p.value=s,k.value=!0}function z(){k.value=!1,p.value=null}async function j(){const s=await b.allDocs({include_docs:!0});y.value=s.rows.map(t=>t.doc)}async function W(){var E,N;const s=n.value.word.trim(),t=n.value.meaning.trim();if(!s||!t)return;if(y.value.find(v=>{var S,q;return((S=v==null?void 0:v.word)==null?void 0:S.toLowerCase())===(s==null?void 0:s.toLowerCase())&&v._id!==((q=u.value)==null?void 0:q._id)})){alert(`มีคำ "${s}" อยู่แล้วในรายการ`);return}const g=n.value.tagsInput.split(",").map(v=>v.trim()).filter(Boolean),l=Date.now(),c={word:s,meaning:t,tags:g,createdAt:((E=u.value)==null?void 0:E.createdAt)||l,updatedAt:l};if((N=u.value)!=null&&N._id){const v=await b.get(u.value._id);await b.put({...c,_id:u.value._id,_rev:v._rev})}else await b.post(c);C(),j()}async function X(){var t;if(!((t=p.value)!=null&&t._id))return;const s=await b.get(p.value._id);await b.remove(s),k.value=!1,p.value=null,j()}async function Y(){try{const s=await b.get("app_settings");if(!(s!=null&&s.openaiApiKey))throw new Error("OpenAI API Key is not set");if(!n.value.word||f.value)throw new Error("Please enter a word");f.value=!0,n.value.meaning=await Q(n.value.word)}catch(s){Z("เกิดข้อผิดพลาด : "+s),console.error(s);return}finally{f.value=!1}}function Z(s){T.value=s,D.value=!0,setTimeout(()=>D.value=!1,5e3)}return te(j),(s,t)=>{var g;const r=oe;return d(),m("div",null,[e("div",{class:"flex justify-between items-center mb-6"},[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold"},"จัดการคำศัพท์",-1)),e("button",{class:"btn btn-primary",onClick:J},"เพิ่มคำศัพท์")]),e("div",de,[_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),type:"text",placeholder:"ค้นหาคำศัพท์...",class:"input input-bordered w-full max-w-xs"},null,512),[[M,w.value]]),e("div",ue,[t[10]||(t[10]=e("label",{tabindex:"0",class:"btn m-1"},"กรองตามแท็ก",-1)),e("ul",re,[(d(!0),m(L,null,P(G.value.filter(l=>l),l=>(d(),m("li",{key:l},[e("label",ce,[_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>h.value=c),value:l,type:"checkbox",class:"checkbox"},null,8,ve),[[ne,h.value]]),e("span",null,i(l),1)])]))),128))])])]),e("div",me,[e("div",be,[e("button",{class:"btn",disabled:a.value===1,onClick:t[2]||(t[2]=l=>a.value--)},"«",8,pe),e("button",fe,"หน้า "+i(a.value),1),e("button",{class:"btn",disabled:a.value>=F.value,onClick:t[3]||(t[3]=l=>a.value++)},"»",8,ge)])]),e("div",we,[(d(!0),m(L,null,P(H.value,l=>(d(),m("div",{key:l._id,class:"card bg-base-200"},[e("div",_e,[e("h2",xe,i(l.word),1),e("p",null,i(l.meaning),1),e("div",ye,[(d(!0),m(L,null,P(l.tags,c=>(d(),m("span",{key:c,class:"badge badge-primary"},i(c),1))),128))]),e("div",he,[e("button",{class:"btn btn-sm",onClick:c=>U(l)},"แก้ไข",8,ke),e("button",{class:"btn btn-sm btn-error",onClick:c=>R(l)},"ลบ",8,Ce)])])]))),128))]),e("div",Ae,[e("div",Me,[e("button",{class:"btn",disabled:a.value===1,onClick:t[4]||(t[4]=l=>a.value--)},"«",8,Ie),e("button",De,"หน้า "+i(a.value),1),e("button",{class:"btn",disabled:a.value>=F.value,onClick:t[5]||(t[5]=l=>a.value++)},"»",8,Ve)])]),e("div",{class:O(["modal",{"modal-open":V.value}])},[e("div",je,[e("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:C},"✕"),D.value?(d(),m("div",Le,[t[11]||(t[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,i(T.value),1)])):se("",!0),e("h3",Pe,i(u.value?"แก้ไขคำศัพท์":"เพิ่มคำศัพท์"),1),e("form",{onSubmit:le(W,["prevent"]),class:"space-y-6"},[e("div",Be,[t[12]||(t[12]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"คำศัพท์")],-1)),_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.word=l),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[M,n.value.word]])]),e("div",Te,[e("label",$e,[t[13]||(t[13]=e("span",{class:"label-text font-medium"},"ความหมาย",-1)),e("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!n.value.word||f.value,onClick:Y},[f.value?(d(),K(r,{key:1,name:"svg-spinners:pulse-rings-3"})):(d(),K(r,{key:0,name:"material-symbols:magic-button"})),x(" "+i(f.value?"กำลังโหลด...":"ขอความหมายจาก AI"),1)],8,Fe)]),_(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>n.value.meaning=l),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[M,n.value.meaning]])]),e("div",Ue,[t[14]||(t[14]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"แท็ก (คั่นด้วย ,)")],-1)),_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.tagsInput=l),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[M,n.value.tagsInput]])]),e("div",ze,[e("button",Ee,[I(r,{name:"ri:save-3-line"}),t[15]||(t[15]=x(" บันทึก "))]),e("button",{type:"button",class:"btn",onClick:C},[I(r,{name:"bitcoin-icons:cross-filled"}),t[16]||(t[16]=x(" ยกเลิก "))])])],32)]),e("div",{class:"modal-backdrop",onClick:C})],2),e("div",{class:O(["modal",{"modal-open":k.value}])},[e("div",Ne,[t[19]||(t[19]=e("h3",{class:"text-lg font-bold mb-4"},"ยืนยันการลบ",-1)),e("p",null,'คุณต้องการลบคำศัพท์ "'+i((g=p.value)==null?void 0:g.word)+'" ใช่หรือไม่?',1),e("div",Se,[e("button",{class:"btn btn-error",onClick:X},[I(r,{name:"material-symbols:delete-outline"}),t[17]||(t[17]=x(" ยืนยัน "))]),e("button",{class:"btn",onClick:z},[I(r,{name:"bitcoin-icons:cross-filled"}),t[18]||(t[18]=x(" ยกเลิก "))])])]),e("div",{class:"modal-backdrop",onClick:z})],2)])}}});export{Ge as default};
