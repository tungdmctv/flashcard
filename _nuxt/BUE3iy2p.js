import{f as tt,r as c,g,h as st,c as u,o as d,a as s,i as j,v as et,b as v,d as b,j as ot,F as R,k as U,l as lt,t as n,n as E,m as P,p as I,q as nt}from"./BNIdq3aq.js";import{p as at}from"./C9ZjJIze.js";import{P as rt}from"./BYoDscgR.js";const it={class:"p-0 w-full"},ct={class:"flex justify-center items-center gap-1 mb-6"},ut={class:"dropdown"},dt={tabindex:"0",class:"btn m-1"},vt={tabindex:"0",class:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52 z-[1] max-h-96 overflow-y-auto"},bt={class:"cursor-pointer flex gap-2"},pt=["value"],mt={class:"flex w-full justify-between items-center mb-6 gap-1"},ft={class:"stats shadow w-full p-0"},wt={class:"stat"},gt={class:"stat-value"},kt={class:"stat"},xt={class:"stat-value text-success"},yt={class:"stat"},_t={class:"stat-value text-error"},ht={class:"stat"},Ct={class:"flex text-sm justify-center my-4"},St=["disabled"],Mt={class:"px-4 py-2"},Tt=["disabled"],$t={class:"overflow-x-auto"},Rt={class:"table mx-auto table-xl w-full"},Pt={key:0,class:"ml-1"},Lt={key:0,class:"ml-1"},Vt={key:0,class:"ml-1"},Dt={key:0,class:"ml-1"},jt=["onClick"],Ut={class:"flex items-center gap-2"},zt={class:"flex text-sm justify-center my-4"},Ht=["disabled"],Nt={class:"px-4 py-2"},Bt=["disabled"],Ft={class:"w-full flex my-4 justify-center"},Wt={class:"modal-box"},qt={class:"modal-action"},At={class:"modal-box"},Et={class:"text-3xl font-bold mb-4 text-center"},It=["innerHTML"],Qt={class:"modal-action"},Yt={class:"dropdown"},Gt=["value"],z=20,Zt=tt({__name:"stat",setup(Jt){const Q=c(at.languages),C=c(""),S=c([]),Y=g(()=>Array.from(new Set(p.value.flatMap(e=>e.tags)))),a=c(1),x=new rt("flashcards"),p=c([]),w=c("successRate"),m=c("desc");function G(e){return e>=80?"#22c55e":e>=60?"#eab308":e>=40?"#f97316":"#ef4444"}const y=c(!1);function M(e){w.value===e?m.value=m.value==="asc"?"desc":"asc":(w.value=e,m.value="desc")}const L=g(()=>p.value.reduce((e,t)=>{var l;return e+(((l=t.stats)==null?void 0:l.correct)||0)},0)),H=g(()=>p.value.reduce((e,t)=>{var l;return e+(((l=t.stats)==null?void 0:l.incorrect)||0)},0)),N=g(()=>{const e=L.value+H.value;if(e===0)return 0;const t=L.value/e*100;return Math.round(t)}),B=g(()=>p.value.filter(e=>{const t=C.value?e.word&&e.word.toLowerCase().includes(C.value.toLowerCase()):!0,l=!S.value.length||e.tags&&S.value.every(r=>e.tags.includes(r));return t&&l&&e.word}).sort((e,t)=>{var h,D,q,A;const l=((h=e.stats)==null?void 0:h.correct)||0,r=((D=t.stats)==null?void 0:D.correct)||0,f=((q=e.stats)==null?void 0:q.incorrect)||0,o=((A=t.stats)==null?void 0:A.incorrect)||0;let i=0;switch(w.value){case"word":i=e.word.localeCompare(t.word);break;case"correct":i=l-r;break;case"incorrect":i=f-o;break;case"successRate":i=T(e)-T(t);break}return m.value==="asc"?i:-i})),J=g(()=>{const e=(a.value-1)*z,t=e+z;return B.value.slice(e,t)}),k=g(()=>Math.ceil(B.value.length/z));function T(e){if(!e.stats)return 0;const t=(e.stats.correct||0)+(e.stats.incorrect||0);if(t===0)return 0;const l=e.stats.correct/t*100;return Math.round(l*100)/100}async function K(){const e=await x.allDocs({include_docs:!0});p.value=e.rows.map(t=>t.doc);for(const t of p.value){if(!t._id)continue;const l=await x.get(t._id),r={correct:0,incorrect:0,lastSeen:Date.now()};await x.put({...l,stats:r})}y.value=!1,F()}async function F(){const e=await x.allDocs({include_docs:!0});p.value=e.rows.filter(t=>{var l;return(l=t.doc)==null?void 0:l.word}).map(t=>t.doc)}st(()=>{F(),X()});const _=c(null),V=c(!1);function O(e){_.value=e,V.value=!0}function W(){V.value=!1}const $=c("th-TH");async function X(){try{const e=await x.get("app_settings");$.value=e.pronunciationLanguage||"th-TH"}catch(e){console.error("Failed to load settings:",e)}}function Z(){if(!_.value)return;const e=new SpeechSynthesisUtterance(_.value.word),t={th:"th-TH",en:"en-US",zh:"zh-CN"};e.lang=t[$.value]??"en-US";const l=window.speechSynthesis.getVoices(),r=l.find(f=>f.lang===e.lang)||l.find(f=>f.lang.startsWith(e.lang.slice(0,2)));r&&(e.voice=r),window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}return(e,t)=>{var r,f;const l=ot;return d(),u(R,null,[s("div",it,[t[28]||(t[28]=s("h1",{class:"text-2xl font-bold mb-6"},"สถิติการฝึกฝน",-1)),s("div",ct,[j(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>C.value=o),type:"text",placeholder:"ค้นหาคำศัพท์...",class:"input input-bordered w-1/2"},null,512),[[et,C.value]]),s("div",ut,[s("label",dt,[v(l,{name:"material-symbols:label-outline",class:"mr-1"}),t[14]||(t[14]=b(" Tags"))]),s("ul",vt,[(d(!0),u(R,null,U(Y.value.filter(o=>o),o=>(d(),u("li",{key:o},[s("label",bt,[j(s("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>S.value=i),value:o,type:"checkbox",class:"checkbox"},null,8,pt),[[lt,S.value]]),s("span",null,n(o),1)])]))),128))])])]),s("div",mt,[s("div",ft,[s("div",wt,[t[15]||(t[15]=s("div",{class:"stat-title"},"คำ",-1)),s("div",gt,n(p.value.length),1)]),s("div",kt,[t[16]||(t[16]=s("div",{class:"stat-title"},"ถูก",-1)),s("div",xt,n(L.value),1)]),s("div",yt,[t[17]||(t[17]=s("div",{class:"stat-title"},"ผิด",-1)),s("div",_t,n(H.value),1)]),s("div",ht,[t[18]||(t[18]=s("div",{class:"stat-title"},"สำเร็จ",-1)),s("div",{class:"stat-value",style:E({color:G(N.value)})},n(N.value)+"% ",5)])])]),s("div",Ct,[s("button",{onClick:t[2]||(t[2]=o=>a.value=Math.max(1,a.value-1)),disabled:a.value===1,class:"btn btn-outline btn-sm"},[v(l,{name:"material-symbols:arrow-back-ios",class:"inline-block"})],8,St),s("span",Mt,n(a.value)+" of "+n(k.value),1),s("button",{onClick:t[3]||(t[3]=o=>a.value=Math.min(k.value,a.value+1)),disabled:a.value===k.value,class:"btn btn-outline btn-sm"},[v(l,{name:"material-symbols:arrow-forward-ios",class:"inline-block"})],8,Tt)]),s("div",$t,[s("table",Rt,[s("thead",null,[s("tr",null,[s("th",{onClick:t[4]||(t[4]=o=>M("word")),class:"cursor-pointer hover:font-bold"},[t[19]||(t[19]=b(" คำศัพท์ ")),w.value==="word"?(d(),u("span",Pt,n(m.value==="asc"?"↑":"↓"),1)):P("",!0)]),s("th",{onClick:t[5]||(t[5]=o=>M("correct")),class:"cursor-pointer hover:font-bold"},[t[20]||(t[20]=b(" ถูก ")),w.value==="correct"?(d(),u("span",Lt,n(m.value==="asc"?"↑":"↓"),1)):P("",!0)]),s("th",{onClick:t[6]||(t[6]=o=>M("incorrect")),class:"cursor-pointer hover:font-bold"},[t[21]||(t[21]=b(" ผิด ")),w.value==="incorrect"?(d(),u("span",Vt,n(m.value==="asc"?"↑":"↓"),1)):P("",!0)]),s("th",{onClick:t[7]||(t[7]=o=>M("successRate")),class:"cursor-pointer hover:font-bold"},[t[22]||(t[22]=b(" อัตราความสำเร็จ ")),w.value==="successRate"?(d(),u("span",Dt,n(m.value==="asc"?"↑":"↓"),1)):P("",!0)])])]),s("tbody",null,[(d(!0),u(R,null,U(J.value.filter(o=>o.word),o=>{var i,h;return d(),u("tr",{key:o._id},[s("td",{onClick:D=>O(o),class:"cursor-pointer hover:text-blue-500 text-2xl"},n(o.word),9,jt),s("td",null,n(((i=o.stats)==null?void 0:i.correct)||0),1),s("td",null,n(((h=o.stats)==null?void 0:h.incorrect)||0),1),s("td",null,[s("div",Ut,[s("span",{style:E("color: hsl("+T(o)*1.2+", 100%, 50%)")},n(T(o))+"% ",5)])])])}),128))])]),s("div",zt,[s("button",{onClick:t[8]||(t[8]=o=>a.value=Math.max(1,a.value-1)),disabled:a.value===1,class:"btn btn-outline btn-sm"},[v(l,{name:"material-symbols:arrow-back-ios",class:"inline-block"})],8,Ht),s("span",Nt,n(a.value)+" of "+n(k.value),1),s("button",{onClick:t[9]||(t[9]=o=>a.value=Math.min(k.value,a.value+1)),disabled:a.value===k.value,class:"btn btn-outline btn-sm"},[v(l,{name:"material-symbols:arrow-forward-ios",class:"inline-block"})],8,Bt)])]),s("div",Ft,[s("button",{class:"btn btn-error btn-sm",onClick:t[10]||(t[10]=o=>y.value=!0)},[v(l,{name:"radix-icons:reset"}),t[23]||(t[23]=b(" Reset Your Statistics "))])]),s("div",{class:I(["modal",{"modal-open":y.value}])},[s("div",Wt,[t[26]||(t[26]=s("h3",{class:"text-lg font-bold mb-4"},"ยืนยันการ Reset",-1)),t[27]||(t[27]=s("p",null,"คุณต้องการ Reset ประวัติการเล่นของคุณ ใช่หรือไม่?",-1)),s("div",qt,[s("button",{class:"btn btn-error",onClick:K},[v(l,{name:"material-symbols:delete-outline"}),t[24]||(t[24]=b(" ยืนยัน "))]),s("button",{class:"btn",onClick:t[11]||(t[11]=o=>y.value=!1)},[v(l,{name:"bitcoin-icons:cross-filled"}),t[25]||(t[25]=b(" ยกเลิก "))])])]),s("div",{class:"modal-backdrop",onClick:t[12]||(t[12]=o=>y.value=!1)})],2)]),s("div",{class:I(["modal",{"modal-open":V.value}])},[s("div",At,[s("h3",Et,n((r=_.value)==null?void 0:r.word),1),s("p",{class:"mb-4",innerHTML:(f=_.value)==null?void 0:f.meaning.replace(/\n/g,"<br>")},null,8,It),s("div",Qt,[s("div",Yt,[j(s("select",{"onUpdate:modelValue":t[13]||(t[13]=o=>$.value=o),class:"select select-bordered w-full"},[(d(!0),u(R,null,U(Q.value,o=>(d(),u("option",{key:o.code,value:o.code},n(o.name),9,Gt))),128))],512),[[nt,$.value]])]),s("button",{class:"btn",onClick:Z},[v(l,{name:"material-symbols:volume-up"}),t[29]||(t[29]=b(" อ่านออกเสียง "))]),s("button",{class:"btn btn-error",onClick:W},[v(l,{name:"bitcoin-icons:cross-filled"}),t[30]||(t[30]=b(" ปิด "))])])]),s("div",{class:"modal-backdrop",onClick:W})],2)],64)}}});export{Zt as default};
