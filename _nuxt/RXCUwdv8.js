import{f as ut,r as i,g as _,B as rt,h as vt,c as g,a as e,m as mt,i as M,b as f,d as R,F,k as G,C as q,t as c,D as K,E as V,q as ft,l as J,w as pt,p as bt,e as _t,o as v,j as gt}from"./0JQB6iLr.js";import{_ as wt}from"./CilOyA4i.js";import{P as ht}from"./BYoDscgR.js";import{p as yt}from"./C9ZjJIze.js";const xt={class:"text-lg"},kt={class:"flex justify-end items-center mb-6"},St={class:"flex flex-wrap justify-end gap-4 items-center"},Ct={class:"dropdown dropdown-sm"},Mt={tabindex:"0",class:"btn m-1"},Rt={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},It={class:"label cursor-pointer justify-start gap-2"},Tt=["value"],Lt={class:"label-text"},jt={class:"w-full flex flex-col items-center justify-center"},$t={class:"stats shadow mb-2 w-full lg:w-1/2"},Ht={class:"stat"},Bt={class:"stat-value"},Dt={class:"stat"},Nt={class:"stat-value text-success"},Vt={class:"stat"},Wt={class:"stat-value text-error"},Et={class:"stat"},Ot={class:"stat-value"},Ut={class:"w-full flex justify-end items-center pb-4"},Pt={class:"flex items-center gap-2 ml-4"},zt=["disabled"],At=["disabled"],Ft={class:"card-body items-center text-center"},Gt={class:"card-title text-6xl mb-4 py-6"},qt=["innerHTML"],Kt={class:"flex gap-4"},Jt={key:1,class:"text-center py-12"},Qt={key:2,class:"text-center py-12"},Xt={key:3,class:"flex justify-center gap-2 my-4"},Yt={class:"dropdown"},Zt=["value"],te={class:"modal"},ee={class:"modal-box relative"},se={class:"mb-2"},ae={class:"mb-2 text-success"},le={class:"mb-4 text-error"},oe={class:"modal-box w-full"},ne={class:"w-2/3 mx-center stats stats-vertical shadow"},ie={class:"stat"},ce={class:"stat-value"},de={class:"stat"},ue={class:"stat-value text-success"},re={class:"stat-desc"},ve={class:"stat"},me={class:"stat-value text-error"},fe={class:"stat-desc"},pe={class:"stat"},be={class:"stat-value"},_e={class:"modal-action"},ke=ut({__name:"practice",setup(ge){const I=new ht("flashcards"),Q=i(yt.languages),T=i("th-TH"),X=i({pronunciationLanguage:"th-TH"}),w=i([]),m=i(0),u=i(!1),p=i(!0),S=i([]),y=i(!1),b=i([]),x=i(0);i(!1),i("");const $=i(!1),H=i(void 0);i(!1),i(!1);const W=i({word:"",meaning:"",tagsInput:""}),r=i({}),L=_(()=>w.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.correct)||0)},0)),B=_(()=>w.value.reduce((a,t)=>{var s;return a+(((s=t.stats)==null?void 0:s.incorrect)||0)},0)),D=_(()=>L.value+B.value),N=_(()=>{const a=D.value;return a>0?Math.round(L.value/a*100):0}),j=_(()=>{const a=Object.values(r.value);return{totalPlayed:a.reduce((t,s)=>t+s.played,0),totalCorrect:a.reduce((t,s)=>t+s.correct,0),totalIncorrect:a.reduce((t,s)=>t+s.incorrect,0),avgSuccessRate:a.length>0?Math.round(a.reduce((t,s)=>t+s.successRate,0)/a.length):0}}),Y=_(()=>[...new Set(w.value.flatMap(a=>a.tags))]),k=_(()=>w.value.filter(a=>S.value.length===0||S.value.some(t=>a.tags.includes(t)))),d=_(()=>k.value[m.value]||null),Z=_(()=>{var a;return((a=d.value)==null?void 0:a.meaning.replace(/\n/g,"<br>"))||""});async function tt(){const t=(await I.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var o;return s.word&&!((o=s._id)!=null&&o.startsWith("_design"))});w.value=t.map(s=>{var o,n,l;return{...s,tags:s.tags||[],stats:{correct:((o=s.stats)==null?void 0:o.correct)||0,incorrect:((n=s.stats)==null?void 0:n.incorrect)||0,lastSeen:((l=s.stats)==null?void 0:l.lastSeen)||Date.now()}}}),p.value&&C()}function C(){m.value=0,u.value=!1,w.value=[...k.value].sort(()=>Math.random()-.5)}function et(){p.value=!p.value,u.value=!1,p.value?C():m.value=0}function st(){u.value||(u.value=!0)}async function E(a){var l,h,P,z,A;if(!((l=d.value)!=null&&l._id))return;const t=await I.get(d.value._id),s={correct:((h=t.stats)==null?void 0:h.correct)||0,incorrect:((P=t.stats)==null?void 0:P.incorrect)||0,lastSeen:((z=t.stats)==null?void 0:z.lastSeen)||Date.now()},o=a?"correct":"incorrect";s[o]=(Number(s[o])||0)+1,s.lastSeen=Date.now(),await I.put({...t,stats:s}),d.value.stats&&(d.value.stats[a?"correct":"incorrect"]++,d.value.stats.lastSeen=s.lastSeen),d.value._id&&!b.value.includes(d.value._id)&&b.value.push(d.value._id);const n=((A=d.value)==null?void 0:A._id)||"";r.value[n]||(r.value[n]={played:0,correct:0,incorrect:0,successRate:0}),r.value[n].played++,a?r.value[n].correct++:r.value[n].incorrect++,r.value[n].successRate=r.value[n].played>0?Math.round(r.value[n].correct/r.value[n].played*100):0,u.value=!1,at()}function at(){p.value&&(Math.random()<.75?(console.log("shuffle"),C()):(console.log("getLowestSuccessRateWords"),lt())),m.value<k.value.length-1?m.value++:m.value=0,u.value=!1,x.value=-1}function lt(a=5){const t=Object.entries(r.value).filter(([s,o])=>o.played>0&&o.successRate<80).sort((s,o)=>s[1].successRate-o[1].successRate).slice(0,a).map(([s,o])=>{var n;return{wordId:s,word:((n=w.value.find(l=>l._id===s))==null?void 0:n.word)||s,successRate:o.successRate}});if(t.length>0){const s=t[0],o=w.value.find(n=>n._id===s.wordId);if(o){const n=k.value.filter(l=>l._id!==s.wordId).toSpliced(m.value+1,0,o);k.value=[...n]}}return console.log("lowestWords",t),t}function ot(a){var l;if(typeof window>"u"||!window.speechSynthesis)return;const t=new SpeechSynthesisUtterance(((l=d.value)==null?void 0:l.word)||""),s={th:"th-TH",en:"en-US",zh:"zh-CN"};t.lang=s[a]??"en-US";const o=window.speechSynthesis.getVoices(),n=o.find(h=>h.lang===t.lang)||o.find(h=>h.lang.startsWith(t.lang.slice(0,2)));n&&(t.voice=n),window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}function nt(){y.value=!0}function O(){y.value=!1,u.value=!1,b.value=[],x.value=-1,p.value?C():m.value=0}function U(a){if(b.value.length===0)return;let t=x.value+a;if(t<0?t=b.value.length-1:t>=b.value.length&&(t=0),x.value=t,x.value>=0){const s=b.value[x.value],o=k.value.findIndex(n=>n._id===s);o>=0&&(m.value=o,u.value=!0)}}rt(S,()=>{m.value=0,u.value=!1,p.value&&C()});async function it(){try{const a=await I.get("app_settings");X.value={pronunciationLanguage:a.pronunciationLanguage||"th-TH"},T.value=a.pronunciationLanguage||"th-TH"}catch(a){console.error("Failed to load settings:",a)}}function ct(a){a?(H.value=a,W.value={word:a.word,meaning:a.meaning,tagsInput:a.tags.join(", ")}):(H.value=void 0,W.value={word:"",meaning:"",tagsInput:""}),setTimeout(()=>{dt("edit-modal")},40)}function dt(a=""){const t=document.getElementById(a);t==null||t.classList.add("modal-open")}return vt(()=>{tt(),it()}),(a,t)=>{const s=gt,o=_t,n=wt;return v(),g("div",xt,[e("div",kt,[e("div",St,[e("div",Ct,[e("label",Mt,[f(s,{name:"material-symbols:label-important-rounded"}),t[11]||(t[11]=R(" Tags "))]),e("ul",Rt,[(v(!0),g(F,null,G(Y.value,l=>(v(),g("li",{key:l},[e("label",It,[M(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=h=>S.value=h),value:l,class:"checkbox"},null,8,Tt),[[J,S.value]]),e("span",Lt,c(l),1)])]))),128))])]),e("button",{class:"btn btn-sm",onClick:et},[p.value?(v(),q(s,{key:0,name:"fe:random"})):(v(),q(s,{key:1,name:"lineicons:sort-amount-asc"})),R(" "+c(p.value?"Random":"A->B"),1)]),e("div",{onClick:t[1]||(t[1]=l=>$.value=!0)},[f(s,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto mb-1"})]),e("button",{class:"btn btn-error btn-xs",onClick:nt},[f(s,{name:"ic:baseline-stop-circle"}),t[12]||(t[12]=R(" End "))])])]),e("div",jt,[e("div",$t,[e("div",Ht,[t[13]||(t[13]=e("div",{class:"stat-title"},"à¹€à¸¥à¹ˆà¸™",-1)),e("div",Bt,c(j.value.totalPlayed),1)]),e("div",Dt,[t[14]||(t[14]=e("div",{class:"stat-title"},"à¸–à¸¹à¸",-1)),e("div",Nt,c(j.value.totalCorrect),1)]),e("div",Vt,[t[15]||(t[15]=e("div",{class:"stat-title"},"à¸œà¸´à¸”",-1)),e("div",Wt,c(j.value.totalIncorrect),1)]),e("div",Et,[t[16]||(t[16]=e("div",{class:"stat-title"},"à¸­à¸±à¸•à¸£à¸²à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ",-1)),e("div",Ot,c(j.value.avgSuccessRate)+"%",1)])])]),e("div",Ut,[e("div",Pt,[e("button",{class:"btn btn-sm btn-outline",disabled:b.value.length===0,onClick:t[2]||(t[2]=l=>U(-1))},[f(s,{name:"material-symbols:arrow-back"})],8,zt),e("button",{class:"btn btn-sm btn-outline",disabled:b.value.length===0,onClick:t[3]||(t[3]=l=>U(1))},[f(s,{name:"material-symbols:arrow-forward"})],8,At)])]),d.value&&!y.value?(v(),g("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:st},[e("div",{onClick:t[4]||(t[4]=l=>ct(d.value)),class:"absolute top-2 right-2"},[f(s,{name:"material-symbols:edit-square-outline"})]),e("div",Ft,[e("h2",Gt,c(d.value.word),1),M(e("p",{class:"text-xl mb-4",innerHTML:Z.value},null,8,qt),[[K,u.value]]),M(e("div",Kt,[e("button",{class:"btn btn-success",onClick:t[5]||(t[5]=V(l=>E(!0),["stop"]))},"OK"),e("button",{class:"btn btn-error",onClick:t[6]||(t[6]=V(l=>E(!1),["stop"]))},"Again")],512),[[K,u.value]])])])):y.value?(v(),g("div",Qt,t[18]||(t[18]=[e("p",null,"No cards available.",-1)]))):(v(),g("div",Jt,[t[17]||(t[17]=e("p",{class:"text-xl mb-4"},"No Words Selected",-1)),e("button",{class:"btn btn-primary",onClick:O},"Start")])),d.value&&!y.value?(v(),g("div",Xt,[e("div",Yt,[M(e("select",{"onUpdate:modelValue":t[7]||(t[7]=l=>T.value=l),class:"select select-bordered w-full"},[(v(!0),g(F,null,G(Q.value,l=>(v(),g("option",{key:l.code,value:l.code},c(l.name),9,Zt))),128))],512),[[ft,T.value]])]),e("button",{class:"btn",onClick:t[8]||(t[8]=V(l=>ot(T.value),["stop"]))},[f(s,{name:"material-symbols:volume-up"}),t[19]||(t[19]=R(" à¸­à¹ˆà¸²à¸™à¸­à¸­à¸à¹€à¸ªà¸µà¸¢à¸‡ "))])])):mt("",!0),M(e("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":t[9]||(t[9]=l=>y.value=l)},null,512),[[J,y.value]]),e("div",te,[e("div",ee,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold mb-4"},"à¸ˆà¸šà¹€à¸à¸¡à¹à¸¥à¹‰à¸§ ðŸŽ‰",-1)),e("p",se,"à¸„à¸³à¸—à¸µà¹ˆà¸—à¸²à¸¢à¹„à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: "+c(D.value),1),e("p",ae,"à¸ˆà¸³à¸™à¸§à¸™à¸„à¸³à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡: "+c(L.value),1),e("p",le,"à¸ˆà¸³à¸™à¸§à¸™à¸„à¸³à¸—à¸µà¹ˆà¸œà¸´à¸”à¸žà¸¥à¸²à¸”: "+c(B.value),1),e("div",{class:"modal-action"},[e("button",{class:"btn btn-primary",onClick:O},"à¹€à¸¥à¹ˆà¸™à¹ƒà¸«à¸¡à¹ˆ")])])]),e("dialog",{id:"stats_modal",class:bt(["modal",{"modal-open":$.value}])},[e("div",oe,[t[27]||(t[27]=e("h3",{class:"w-full flex justify-center items-center font-bold text-lg mb-4"},"Overall Statistics",-1)),e("div",ne,[e("div",ie,[t[21]||(t[21]=e("div",{class:"stat-title"},"Total Plays",-1)),e("div",ce,c(D.value),1)]),e("div",de,[t[22]||(t[22]=e("div",{class:"stat-title"},"Correct",-1)),e("div",ue,c(L.value),1),e("div",re,c(N.value)+"% ",1)]),e("div",ve,[t[23]||(t[23]=e("div",{class:"stat-title"},"Incorrect",-1)),e("div",me,c(B.value),1),e("div",fe,c(100-N.value)+"%",1)]),e("div",pe,[t[24]||(t[24]=e("div",{class:"stat-title"},"Success Rate",-1)),e("div",be,c(N.value)+"%",1),t[25]||(t[25]=e("div",{class:"stat-desc"},"Overall success rate",-1))])]),e("div",_e,[f(o,{to:"/stat",class:"btn btn-secondary"},{default:pt(()=>[f(s,{name:"material-symbols:bar-chart-4-bars"}),t[26]||(t[26]=R(" Stats "))]),_:1,__:[26]}),e("button",{class:"btn",onClick:t[10]||(t[10]=l=>$.value=!1)},"Close")])])],2),f(n,{id:"edit-modal",card:H.value},null,8,["card"])])}}});export{ke as default};
