import{f as ae,C as ne,r as d,g as M,h as le,c as y,a as e,i as oe,t as b,p as R,l as T,m as Q,q as G,d as B,F as X,j as Y,b as C,o as m,n as ce,k as ie,w as ve,D as te,v as me,s as se,e as pe}from"./CxFqhSA7.js";import{P as re}from"./BYoDscgR.js";import{u as ge}from"./BOpmqxdM.js";import{p as fe}from"./C9ZjJIze.js";const be={class:"modal",id:"edit-modal"},we={class:"modal-box relative max-w-2xl"},_e={key:0,role:"alert",class:"alert alert-info shadow-lg mb-6"},ye={class:"text-xl font-bold mb-6"},xe={class:"form-control"},he={class:"form-control"},ke={class:"label flex justify-between items-center"},Ce=["disabled"],Se={class:"form-control"},Ie={class:"flex flex-wrap gap-2 mb-4"},$e=["onClick"],Ae={class:"modal-action mt-2"},Me={type:"submit",class:"btn btn-primary"},Te=ae({__name:"addEdit",props:{card:{type:Object,default:()=>({})}},emits:["saveCard"],setup(Z,{emit:E}){var z,L,v,P;const{getMeaning:J}=ge(),D=E,c=Z;ne(()=>c.card,o=>{var a,i,r,f;l.value.word=((a=c.card)==null?void 0:a.word)||"",l.value.meaning=((i=c.card)==null?void 0:i.meaning)||"",l.value.tagsInput=Array.isArray((r=c.card)==null?void 0:r.tags)?c.card.tags.join(", "):((f=c.card)==null?void 0:f.tags)||""});const x=new re("flashcards"),l=d({word:((z=c.card)==null?void 0:z.word)||"",meaning:((L=c.card)==null?void 0:L.meaning)||"",tagsInput:Array.isArray((v=c.card)==null?void 0:v.tags)?c.card.tags.join(", "):((P=c.card)==null?void 0:P.tags)||""});function w(o){const i=(l.value.tagsInput||"").split(",").map(f=>f.trim()).filter(Boolean),r=i.indexOf(o);r===-1?i.push(o):i.splice(r,1),l.value.tagsInput=i.join(", ")}const p=d(!1),I=d(!1),S=d(""),_=d([]),$=M(()=>{const o=new Set;return _.value.forEach(a=>{var i;(i=a.tags)==null||i.forEach(r=>o.add(r))}),Array.from(o)});async function H(){const a=(await x.allDocs({include_docs:!0})).rows.map(i=>i.doc).filter(i=>{var r;return i.word&&!((r=i._id)!=null&&r.startsWith("_design"))});_.value=a.map(i=>{var r,f,V;return{...i,tags:i.tags||[],stats:{correct:((r=i.stats)==null?void 0:r.correct)||0,incorrect:((f=i.stats)==null?void 0:f.incorrect)||0,lastSeen:((V=i.stats)==null?void 0:V.lastSeen)||Date.now()}}})}async function O(){var W,q;const o=l.value.word.trim(),a=l.value.meaning.trim();if(!o||!a)return;if(_.value.find(k=>{var N,K;return((N=k==null?void 0:k.word)==null?void 0:N.toLowerCase())===(o==null?void 0:o.toLowerCase())&&k._id!==((K=c.card)==null?void 0:K._id)})){alert(`มีคำ "${o}" อยู่แล้วในรายการ`);return}console.log("cardForm",l.value);const r=l.value.tagsInput.split(",").map(k=>k.trim()).filter(Boolean),f=Date.now(),V={word:o,meaning:a,tags:r,createdAt:((W=c.card)==null?void 0:W.createdAt)||f,updatedAt:f};if((q=c.card)!=null&&q._id){const k=await x.get(c.card._id);await x.put({...V,_id:c.card._id,_rev:k._rev})}else await x.post(V);j(),H(),D("saveCard",!0)}async function U(){try{const o=await x.get("app_settings");if(!(o!=null&&o.openaiApiKey))throw new Error("OpenAI API Key is not set");if(!l.value.word||p.value)throw new Error("Please enter a word");p.value=!0,l.value.meaning=await J(l.value.word)}catch(o){F("เกิดข้อผิดพลาด : "+o),console.error(o);return}finally{p.value=!1}}function F(o){S.value=o,I.value=!0,setTimeout(()=>I.value=!1,5e3)}function j(){const o=document.getElementById("edit-modal");o==null||o.classList.remove("modal-open")}return le(()=>{H()}),(o,a)=>{const i=ie;return m(),y("div",be,[e("div",we,[e("button",{class:"btn btn-sm btn-circle absolute right-2 top-2",onClick:j},"✕"),I.value?(m(),y("div",_e,[a[3]||(a[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,b(S.value),1)])):oe("",!0),e("h3",ye,b(c.card?"แก้ไขคำศัพท์":"เพิ่มคำศัพท์"),1),e("form",{onSubmit:R(O,["prevent"]),class:"space-y-6"},[e("div",xe,[a[4]||(a[4]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"คำศัพท์")],-1)),T(e("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>l.value.word=r),type:"text",required:"",class:"input input-bordered input-lg w-full"},null,512),[[Q,l.value.word]])]),e("div",he,[e("label",ke,[a[5]||(a[5]=e("span",{class:"label-text font-medium"},"ความหมาย",-1)),e("button",{type:"button",class:"btn btn-sm btn-outline",disabled:!l.value.word||p.value,onClick:U},[p.value?(m(),G(i,{key:1,name:"svg-spinners:pulse-rings-3"})):(m(),G(i,{key:0,name:"material-symbols:magic-button"})),B(" "+b(p.value?"กำลังโหลด...":"ขอความหมายจาก AI"),1)],8,Ce)]),T(e("textarea",{"onUpdate:modelValue":a[1]||(a[1]=r=>l.value.meaning=r),required:"",class:"textarea textarea-bordered textarea-lg w-full h-48 resize-none"},null,512),[[Q,l.value.meaning]])]),e("div",Se,[a[6]||(a[6]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"แท็ก (คั่นด้วย ,)")],-1)),T(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>l.value.tagsInput=r),type:"text",placeholder:"tag1, tag2",class:"input input-bordered input-lg w-full"},null,512),[[Q,l.value.tagsInput]])]),e("div",Ie,[(m(!0),y(X,null,Y($.value,r=>(m(),y("span",{key:r,class:ce(["badge badge-lg cursor-pointer",{"badge-primary":l.value.tagsInput.includes(r)}]),onClick:f=>w(r)},b(r),11,$e))),128))]),e("div",Ae,[e("button",Me,[C(i,{name:"ri:save-3-line"}),a[7]||(a[7]=B(" บันทึก "))]),e("button",{type:"button",class:"btn",onClick:j},[C(i,{name:"bitcoin-icons:cross-filled"}),a[8]||(a[8]=B(" ยกเลิก "))])])],32)]),e("div",{class:"modal-backdrop",onClick:j})])}}}),je={class:"text-lg"},Le={class:"flex justify-end items-center mb-6"},Ve={class:"flex flex-wrap justify-end gap-4 items-center"},Be={class:"dropdown dropdown-sm"},Ee={tabindex:"0",class:"btn m-1"},De={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},He={class:"label cursor-pointer justify-start gap-2"},Ue=["value"],Fe={class:"label-text"},Ne={class:"w-full flex items-center justify-center"},Oe={class:"stats shadow mb-6 w-full lg:w-1/2"},ze={class:"stat"},Pe={class:"stat-value"},We={class:"stat"},qe={class:"stat-value text-success"},Ke={class:"stat"},Re={class:"stat-value text-error"},Ge={class:"w-full flex justify-end pb-4"},Je={class:"flex items-center gap-2 ml-4"},Qe=["disabled"],Xe=["disabled"],Ye={class:"card-body items-center text-center"},Ze={class:"card-title text-6xl mb-4 py-6"},et=["innerHTML"],tt={class:"flex gap-4"},st={key:1,class:"text-center py-12"},at={key:2,class:"text-center py-12"},nt={key:3,class:"flex justify-center gap-2 my-4"},lt={class:"dropdown"},ot=["value"],it={class:"modal"},rt={class:"modal-box relative"},ut={class:"mb-2"},dt={class:"mb-2 text-success"},ct={class:"mb-4 text-error"},ft=ae({__name:"practice",setup(Z){const E=new re("flashcards"),J=d(fe.languages),D=d("th-TH"),c=d({pronunciationLanguage:"th-TH"}),x=d([]),l=d(0),w=d(!1),p=d(!0),I=d([]),S=d(!1),_=d([]),$=d(0);d(!1),d("");const H=d(null);d(!1),d(!1);const O=d({word:"",meaning:"",tagsInput:""}),U=M(()=>x.value.reduce((n,t)=>{var s;return n+(((s=t.stats)==null?void 0:s.correct)||0)},0)),F=M(()=>x.value.reduce((n,t)=>{var s;return n+(((s=t.stats)==null?void 0:s.incorrect)||0)},0)),j=M(()=>U.value+F.value),z=M(()=>[...new Set(x.value.flatMap(n=>n.tags))]),L=M(()=>x.value.filter(n=>I.value.length===0||I.value.some(t=>n.tags.includes(t)))),v=M(()=>L.value[l.value]||null),P=M(()=>{var n;return((n=v.value)==null?void 0:n.meaning.replace(/\n/g,"<br>"))||""});async function o(){const t=(await E.allDocs({include_docs:!0})).rows.map(s=>s.doc).filter(s=>{var g;return s.word&&!((g=s._id)!=null&&g.startsWith("_design"))});x.value=t.map(s=>{var g,h,u;return{...s,tags:s.tags||[],stats:{correct:((g=s.stats)==null?void 0:g.correct)||0,incorrect:((h=s.stats)==null?void 0:h.incorrect)||0,lastSeen:((u=s.stats)==null?void 0:u.lastSeen)||Date.now()}}}),p.value&&a()}function a(){l.value=0,w.value=!1,x.value=[...L.value].sort(()=>Math.random()-.5)}function i(){p.value=!p.value,w.value=!1,p.value?a():l.value=0}function r(){w.value||(w.value=!0)}async function f(n){var h,u,A,ee;if(!((h=v.value)!=null&&h._id))return;const t=await E.get(v.value._id),s={correct:((u=t.stats)==null?void 0:u.correct)||0,incorrect:((A=t.stats)==null?void 0:A.incorrect)||0,lastSeen:((ee=t.stats)==null?void 0:ee.lastSeen)||Date.now()},g=n?"correct":"incorrect";s[g]=(Number(s[g])||0)+1,s.lastSeen=Date.now(),await E.put({...t,stats:s}),v.value.stats&&(v.value.stats[n?"correct":"incorrect"]++,v.value.stats.lastSeen=s.lastSeen),v.value._id&&!_.value.includes(v.value._id)&&_.value.push(v.value._id),w.value=!1,V()}function V(){l.value<L.value.length-1?l.value++:p.value?a():l.value=0,w.value=!1,$.value=-1}function W(n){var u;if(typeof window>"u"||!window.speechSynthesis)return;const t=new SpeechSynthesisUtterance(((u=v.value)==null?void 0:u.word)||""),s={th:"th-TH",en:"en-US",zh:"zh-CN"};t.lang=s[n]??"en-US";const g=window.speechSynthesis.getVoices(),h=g.find(A=>A.lang===t.lang)||g.find(A=>A.lang.startsWith(t.lang.slice(0,2)));h&&(t.voice=h),window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}function q(){S.value=!0}function k(){S.value=!1,w.value=!1,_.value=[],$.value=-1,p.value?a():l.value=0}function N(n){if(_.value.length===0)return;let t=$.value+n;if(t<0?t=_.value.length-1:t>=_.value.length&&(t=0),$.value=t,$.value>=0){const s=_.value[$.value],g=L.value.findIndex(h=>h._id===s);g>=0&&(l.value=g,w.value=!0)}}ne(I,()=>{l.value=0,w.value=!1,p.value&&a()});async function K(){try{const n=await E.get("app_settings");c.value={pronunciationLanguage:n.pronunciationLanguage||"th-TH"},D.value=n.pronunciationLanguage||"th-TH"}catch(n){console.error("Failed to load settings:",n)}}function ue(n){n?(H.value=n,O.value={word:n.word,meaning:n.meaning,tagsInput:n.tags.join(", ")}):(H.value=null,O.value={word:"",meaning:"",tagsInput:""}),setTimeout(()=>{de("edit-modal")},40)}function de(n=""){const t=document.getElementById(n);t==null||t.classList.add("modal-open")}return le(()=>{o(),K()}),(n,t)=>{const s=ie,g=pe,h=Te;return m(),y("div",je,[e("div",Le,[e("div",Ve,[e("div",Be,[e("label",Ee,[C(s,{name:"material-symbols:label-important-rounded"}),t[9]||(t[9]=B(" Tags "))]),e("ul",De,[(m(!0),y(X,null,Y(z.value,u=>(m(),y("li",{key:u},[e("label",He,[T(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=A=>I.value=A),value:u,class:"checkbox"},null,8,Ue),[[se,I.value]]),e("span",Fe,b(u),1)])]))),128))])]),e("button",{class:"btn btn-sm",onClick:i},[p.value?(m(),G(s,{key:1,name:"lineicons:sort-amount-asc"})):(m(),G(s,{key:0,name:"fe:random"})),B(" "+b(p.value?"A->B":"Random"),1)]),C(g,{to:"/stat"},{default:ve(()=>[C(s,{name:"material-symbols:bar-chart-4-bars",class:"mx-auto mb-1"})]),_:1}),e("button",{class:"btn btn-error btn-xs",onClick:q},[C(s,{name:"ic:baseline-stop-circle"}),t[10]||(t[10]=B(" End "))])])]),e("div",Ne,[e("div",Oe,[e("div",ze,[t[11]||(t[11]=e("div",{class:"stat-title"},"Played",-1)),e("div",Pe,b(j.value),1)]),e("div",We,[t[12]||(t[12]=e("div",{class:"stat-title"},"OK",-1)),e("div",qe,b(U.value),1)]),e("div",Ke,[t[13]||(t[13]=e("div",{class:"stat-title"},"Wrong",-1)),e("div",Re,b(F.value),1)])])]),e("div",Ge,[e("div",Je,[e("button",{class:"btn btn-sm btn-outline",disabled:_.value.length===0,onClick:t[1]||(t[1]=u=>N(-1))},[C(s,{name:"material-symbols:arrow-back"})],8,Qe),e("button",{class:"btn btn-sm btn-outline",disabled:_.value.length===0,onClick:t[2]||(t[2]=u=>N(1))},[C(s,{name:"material-symbols:arrow-forward"})],8,Xe)])]),v.value&&!S.value?(m(),y("div",{key:0,class:"card bg-base-200 max-w-2xl mx-auto cursor-pointer relative",onClick:r},[e("div",{onClick:t[3]||(t[3]=u=>ue(v.value)),class:"absolute top-2 right-2"},[C(s,{name:"material-symbols:edit-square-outline"})]),e("div",Ye,[e("h2",Ze,b(v.value.word),1),T(e("p",{class:"text-xl mb-4",innerHTML:P.value},null,8,et),[[te,w.value]]),T(e("div",tt,[e("button",{class:"btn btn-success",onClick:t[4]||(t[4]=R(u=>f(!0),["stop"]))},"OK"),e("button",{class:"btn btn-error",onClick:t[5]||(t[5]=R(u=>f(!1),["stop"]))},"Again")],512),[[te,w.value]])])])):S.value?(m(),y("div",at,t[15]||(t[15]=[e("p",null,"No cards available.",-1)]))):(m(),y("div",st,[t[14]||(t[14]=e("p",{class:"text-xl mb-4"},"No Words Selected",-1)),e("button",{class:"btn btn-primary",onClick:k},"Start")])),v.value&&!S.value?(m(),y("div",nt,[e("div",lt,[T(e("select",{"onUpdate:modelValue":t[6]||(t[6]=u=>D.value=u),class:"select select-bordered w-full"},[(m(!0),y(X,null,Y(J.value,u=>(m(),y("option",{key:u.code,value:u.code},b(u.name),9,ot))),128))],512),[[me,D.value]])]),e("button",{class:"btn",onClick:t[7]||(t[7]=R(u=>W(D.value),["stop"]))},[C(s,{name:"material-symbols:volume-up"}),t[16]||(t[16]=B(" อ่านออกเสียง "))])])):oe("",!0),T(e("input",{type:"checkbox",id:"end-modal",class:"modal-toggle","onUpdate:modelValue":t[8]||(t[8]=u=>S.value=u)},null,512),[[se,S.value]]),e("div",it,[e("div",rt,[t[17]||(t[17]=e("h3",{class:"text-lg font-bold mb-4"},"จบเกมแล้ว 🎉",-1)),e("p",ut,"คำที่ทายไปทั้งหมด: "+b(j.value),1),e("p",dt,"จำนวนคำที่ถูกต้อง: "+b(U.value),1),e("p",ct,"จำนวนคำที่ผิดพลาด: "+b(F.value),1),e("div",{class:"modal-action"},[e("button",{class:"btn btn-primary",onClick:k},"เล่นใหม่")])])]),C(h,{id:"edit-modal",card:H.value},null,8,["card"])])}}});export{ft as default};
